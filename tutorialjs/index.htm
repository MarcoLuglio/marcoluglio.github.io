<!DOCTYPE html>
<html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	>
<head>
	<title>JavaScript Orientado √† Objeto</title>
	<meta charset='utf-8' />
	<link rel='stylesheet' href='css/main.css' />
	<script type='module' src='../compartilhado/js/utils.js'></script>
	<script type='module' src='../compartilhado/js/index.js'></script>
	<script type='module' src='../compartilhado/js/highlighter.js'></script>
	<script type='module' src='../compartilhado/js/highlightEnhancer.js'></script>
	<script type='module' src='js/home.js'></script>
</head>
<body>



<h1>Tutorial JavaScript Orientado √† Objeto</h1>
<p>Bem-vindo ao tutorial politicamente incorreto de JavaScript orientado √† objeto.</p>


<section>

<h2>√çndice</h2>
<nav id='indice'>
</nav>

</section>



<section>

<h2 id='historia'>A pressa passa e a merda fica <span>Introdu√ß√£o Hist√≥rica (e li√ß√£o de vida)</span></h2>

<p>JavaScript foi criado e programado em 2 semanas pela Netscape para validar formul√°rios dentro dos navegadores, sem a necessidade de recarregar a p√°gina. Aparentemente na √©poca das conex√µes discadas medidas em BAUDS isso era muito importante (e com o 3G da tim tb ¬¨¬¨). Por√©m, este per√≠odo curto para desenvolvimento da linguagem gerou um produto com diversas quest√µes controversas. Seu nome foi puramente uma jogada de marketing, tentando se aproveitar da popularidade do Java, que na √©poca era muito usado para fazer applets para p√°ginas de internet. JavaScript teve v√°rias vers√µes ap√≥s isso, sendo que a vers√£o atual, padronizada como <abbr title='ECMAScript ou European Computer Manufacturers Association Script'>ES6</abbr>, √© bastante diferente da inicial.</p>

<p>Por enquanto, ela √© a √∫nica linguagem de programa√ß√£o capaz de interagir com todos os navegadores de internet. Existe uma <a rel='external nofollow' href='https://github.com/webassembly'>especifica√ß√£o em progresso</a> que criar√° um formato bin√°rio capaz de se comunicar com JavaScript, e que poder√° ser criado por outras linguagens. Mas ainda levar√° algum tempo para vermos isso acontecer. JavaScript tamb√©m pode ser utilizado para programa√ß√£o server side, atrav√©s do <a rel='external nofollow' href='http://nodejs.org/'>Node.js</a>, mas n√£o vou abordar isso por enquanto.</p>

<p>JavaScript j√° foi chamada de linguagem mais mal entendida do mundo. Grandes empresas como a Microsoft e o Google passaram bastante tempo desenvolvendo ferramentas para que n√£o seja necess√°rio escrever JavaScript. E o motivo de tudo isso... √© que JavaScript √© como espanhol.<p>

<blockquote>Hay um hombre <strong>tarado</strong> con el...</blockquote>
<p>Parece com portugu√™s, mas significa uma coisa completamente diferente.</p>

<blockquote>H√° um homem <strong>careca</strong> com o <strong>casaco</strong> na m√£o correndo atr√°s do <strong>√¥nibus.</strong></blockquote>

<p>PS: Essas palavras se chamam falsos cognatos.</p>

<p>A sintaxe do JavaScript parece com C e derivados, mas significa coisas diferentes. Por exemplo, <code class='javascript'>this</code> faz <a href='#oop'>coisas bem diferentes</a> dos seus equivalentes em C#. √â um <q>falso cognato</q></p>

<p>Vou enfatizar justamente as diferen√ßas ao longo desse tutorial. Mas antes cabe rapidamente rever um outro fato hist√≥rico, importante no desenvolvimento dessa linguagem.</p>

<p>A Netscape inicialmente n√£o tinha inten√ß√£o que a linguagem fosse padronizada ou aberta. Ela queria dominar o mercado, for√ßando as pessoas a fazerem p√°ginas que s√≥ funcionavam no Netscape, e abriam zoadas no seu concorrente, o internet explorer. Esse epis√≥dio √© conhecido como <a rel='external nofollow' href='http://en.wikipedia.org/wiki/Browser_wars'>Browser Wars</a>. O resultado disso foi uma grande divis√£o na linguagem, gerando incompatibilidades que temos que lidar at√© a vers√£o 8 do Internet Explorer. Este foi o principal motivo do sucesso de bibliotecas com jQuery, que escondem estas incompatibilidades atrav√©s de sua <abbr title='Application Programming Interface'>API</abbr>.</p>

<p>Como os smartphones j√° nasceram com navegadores posteriores ao <abbr title='Internet Explorer 8'>IE8</abbr>, sites e aplicativos para estes dispositivos n√£o precisam se preocupar com isso.</p>

</section>



<section>

<h2 id='helloworld'>JavaScript un zero un <span>¬°Hola Mundo!</span></h2>

<p>Sei que vc √© um programador fod√°stico e que n√£o precisa que ningu√©m te ensine nada de programa√ß√£o. Ent√£o n√£o vou mostrar nada al√©m do estritamente necess√°rio para explicar as diferen√ßas de JavaScript em compara√ß√£o com C e derivados. Ok?</p>

<p>A linguagem em si n√£o √© muito grande se voc√™ tirar toda velharia que ainda existe por causa de compatibilidade. E se voc√™ precisa suportar uma outra velharia chamada IE, suas incompatibilidades nesse caso s√£o poucas. <strong>Mas</strong>, existe uma API exposta pelos navegadores, comumente utilizada em conjunto com JavaScript, chamada Document Object Model (<abbr title='Document Object Model'>DOM</abbr>), que √© bem <strong>maior e mais incompat√≠vel</strong>. Ele serve para que o JavaScript acesse os elementos de um arquivo html, xml ou <abbr title='Scalable Vector Graphics'>svg</abbr>. Mas vamos ver uma coisa de cada vez.</p>

<p>JavaScript pode existir dentro de um arquivo .js, .htm ou .svg</p>

<p>Arquivos .js cont√©m apenas programa√ß√£o, ao passo que arquivos .htm e .svg misturam linguagens de marca√ß√£o com JavaScript.
Podemos usar o bloco de notas para criar e editar um arquivo .js.</p>

<p>O firefox tem uma ferramentinha bem √∫til pra testarmos pequenos blocos de JavaScript, sem precisar usar um arquivo .js externo. Ela se chama scratchpad.</p>

<p>Para o pr√≥ximo exemplo, vamos usar um arquivo .htm bem simples para fazer nossos testes. Copie o trecho abaixo no bloco de notas de sua prefer√™ncia, e salve como um arquivo .htm</p>

<div class='codeblock'>
<p>index.htm - ol√° mundo</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;
&lt;head&gt;
	&lt;title&gt;Html m√≠nimo aceit√°vel&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
	&lt;script src='tutorial.js'&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</code
>
</div>

<p>PS: Html tamb√©m tem vers√µes, que fazem com que a p√°gina pare√ßa e se comporte de maneira diferente de vers√£o para vers√£o. A primeira linha do arquivo:</p>

<div class='codeblock'>
<code class='html'
>&lt;!DOCTYPE html&gt;</code
>
</div>

<p>indica que estamos usando a <strong>vers√£o 5</strong> do html.</p>

<p>Depois cole o texto abaixo num arquivo novo, e salve com a extens√£o .js. Salve na mesma pasta que o arquivo .htm
Note que os arquivos deste exemplo s√£o salvos em utf-8.</p>

<div class='codeblock'>
<p>tutorial.js - ol√° mundo</p>
<code class='javascript'
>'use strict';

console.log('Utilizadores de alert ter√£o seus dedos cortados fora.');</code
>
</div>

<p>Abra o arquivo .htm no seu navegador. Se vc fez tudo certo, observe atentamente que n√£o vai acontecer absolutamente porra nenhuma. Por√©m, se for IE 10-, vai gerar um erro! Come√ßamos bem hein! Disse que n√£o ia mostrar nada al√©m do estritamente necess√°rio para explicar as diferen√ßas de JavaScript. E o prop√≥sito desse exemplo √© explicar algumas coisas sobre o ambiente de execu√ß√£o da linguagem e das ferramentas de desenvolvimento dos navegadores.</p>

<p>Pra ver o resultado de nossa programa√ß√£o precisamos abrir as ferramentas de desenvolvimento, que todos os navegadores possuem (o Firefox possui duas, uma nativa e uma em forma de extens√£o). Para abrir fa√ßa:</p>

<ul>
	<li>Chrome, Firefox (nativo), Opera e Safari: Ctrl + Shift + i</li>
	<li>Firefox (extens√£o firebug), Edge e IE: F12</li>
</ul>

<p>Procure por uma aba chamada console. <strong>√â para o console que as mensagens de debug v√£o.</strong> Recarregue a p√°gina e voc√™ dever√° ver nossa mensagem instrutiva, inclusive no IE. As ferramentas de desenvolvimento tamb√©m possibilitam inserir breakpoints no meio do c√≥digo e avan√ßar linha por linha, como outras IDEs.</p>

<p>Vamos agora explicar nosso exemplo inicial linha por linha.</p>

<div class='codeblock'>
<code class='javascript'
>'use strict';</code
>
</div>

<p>A vers√£o ES5 do JavaScript possui um modo, chamado <a rel='external nofollow' href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions_and_function_scope/Strict_mode#Changes_in_strict_mode'>modo estrito</a>. Ao incluir <code class='javascript'>'use strict';</code> como a primeira linha do arquivo, voc√™ est√° habilitando este modo. Ele garante compatibilidade futura com novas vers√µes da linguagem, al√©m de reduzir as chances de introduzir erros na programa√ß√£o. Este modo pode ser <strong>habilitado para o arquivo inteiro, ou apenas para determinadas fun√ß√µes.</strong> Veremos esta <a href='#funcaoestrita'>segunda forma</a> mais adiante.</p>

<div class='codeblock'>
<code class='javascript'
>console.log('Utilizadores de alert ter√£o seus dedos cortados fora.');</code
>
</div>

<p><code class='javascript'>console</code> √© um objeto, mas n√£o pertence √† linguagem. Ele faz parte da API do navegador, o <abbr title='Document Object Model'>DOM</abbr>. Na pr√°tica isso significa que <strong>nem sempre ele est√° dispon√≠vel para n√≥s utilizarmos. Cada navegador exp√µe m√©todos diferentes deste objeto, e os interpreta de maneiras diversas.</strong> O m√©todo <code class='javascript'>log</code> existe em todos eles, e possui in√∫meras vantagens sobre m√©todos anteriores de debug.</p>

<p>Note que <strong>n√£o existe um m√©todo <code class='c'>main</code>.</strong> Uma p√°gina pode conter diversos blocos separados de JavaScript, portanto n√£o existe o conceito do ponto √∫nico de entrada do seu c√≥digo. Assim que o navegador identifica um trecho de c√≥digo JavaScript, ele o interpreta e executa linha por linha (o que efetivamente acontece √© um pouco mais sofisticado, mas vou deixar este assunto por aqui). Se o mesmo arquivo for inserido duas vezes, ele ser√° executado duas vezes. N√£o existem <em>include guards</em> em JavaScript, como em C ou PHP.(<code class='c'>#ifndef</code> <code class='c'>#define</code> <code class='c'>#endif</code>, <code class='php'>include_once</code>...).</p>

<p>Em .net, existe algo similar em funcionalidade aos <em>include guards</em>. O m√©todo <code class='generic'><span class='symbol'>RegisterStartupScript</span></code>, recebe uma id ao registrar um script. Se for registrado um novo script com a mesma id, o script anterior √© descartado.</p>

</section>



<section>

<h2 id='tipos'>Como declarar uma vari√°vel <span>S√©rio mesmo, como declarar uma vari√°vel!</span></h2>

<p><strong>Existem duas maneiras de declarar uma vari√°vel em JavaScript.</strong> A maneira mais antiga, que utiliza a palavra-chave <code class='javascript'>var</code>, e tem v√°rias pegadinhas que veremos mais para frente. E a maneira mais nova, com a palavra-chave <code class='javascript'>let</code>, que se comporta de maneira mais similar √† que estamos acostumados em outras linguagens. Existe tamb√©m a possibilidade de declararmos constantes com <code class='javascript'>const</code>.</p>

<p>Declaramos uma constante com a palavra-chave <code class='javascript'>const</code>, seguida pelo nome da constante, e obrigatoriamente o sinal de igual e um valor a ser atribu√≠do √† constante.</p>

<div class='codeblock'>
<p>declara√ß√£o de constantes</p>
<code class='javascript'
>'use strict';

const naoPodeMudar = 'o valor';
const vaiLancarErro; // √© obrigat√≥rio atribuir o valor √†s constantes assim que as declaramos</code
>
</div>

<p>Declaramos uma vari√°vel com a palavra-chave <code class='javascript'>let</code> ou com <code class='javascript'>var</code>, seguidas do nome da vari√°vel. Opcionalmente atribu√≠mos um valor para ela. Se n√£o atribuirmos, ela ter√° o valor padr√£o <code class='javascript'>undefined</code>.</p>

<div class='codeblock'>
<p>declara√ß√£o de vari√°veis</p>
<code class='javascript'
>'use strict';

let naoInicializada; // possui valor undefined
let dica = 'JavaScript n√£o √© "fortemente tipado"';

var naoInicializada2; // possui valor undefined
var dica2 = 'Use "let" ao inv√©s de "var"';</code
>
</div>

<p>N√£o declaramos o tipo da vari√°vel, pois JavaScript n√£o pro√≠be que o tipo dela mude (n√£o √© fortemente tipada). O tipo √© <strong>inferido</strong> atrav√©s do valor <strong>atualmente atribu√≠do</strong> √† vari√°vel. Note por√©m que se mantivermos o mesmo tipo da vari√°vel ao longo da execu√ß√£o de nosso c√≥digo, o compilador consegue aplicar <strong>otimiza√ß√µes de performance.</strong> Se necess√°rio, √© poss√≠vel verificar de <strong>maneira limitada</strong> o tipo da vari√°vel usando o operador <code class='javascript'>typeof</code> ou <strong>outros m√©todos</strong> como <code class='javascript'>Array.isArray</code>.</p>

<p>A lista completa dos <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference'>tipos das vari√°veis pode ser vista no <abbr title='Mozilla Developer Network'>MDN</abbr></a>, que √© o portal de desenvolvimento da Mozilla. Vamos ver apenas os tipos que diferem de alguma maneira de seus primos em outras linguagens.</p>

<p>Note que podemos chamar m√©todos de inst√¢ncias atrav√©s das literais como veremos em alguns exemplos.</p>


<h3 id='falsy'>Convers√£o de tipos e falsy values</h3>

<p>Al√©m de n√£o proibir que o tipo das vari√°veis mude ao longo da execu√ß√£o do c√≥digo, <strong>JavaScript converte tipos automaticamente em <code class='javascript'>true</code> e <code class='javascript'>false</code> quando necess√°rio.</strong> Isso nos proporciona uma sintaxe reduzida para verificar estes valores e a exist√™ncia de vari√°veis.</p>

<p>Os valores que s√£o convertidos para <code class='javascript'>false</code> s√£o chamados de <em>falsy</em>. s√£o eles <code class='javascript'>''</code> (string vazia), <code class='javascript'>0</code>, <code class='javascript'>null</code>, <code class='javascript'>undefined</code> e <abbr title='Not a Number'><code class='javascript'>NaN</code></abbr>. Todos os demais s√£o convertidos para <code class='javascript'>true</code>.</p>

<div class='codeblock'>
<code class='javascript'
>var objeto = {};

// a verifica√ß√£o reduzida
if (objeto) {
	//
}

// equivale a verifica√ß√£o
if (objeto === true) {
	//
}

// e ainda √† verifica√ß√£o
if (objeto !== false &amp;&amp; objeto !== '' &amp;&amp; objeto !== 0 &amp;&amp; objeto !== null &amp;&amp; objeto !== undefined &amp;&amp; objeto !== NaN) {
	//
}</code
>
</div>

<p>Note que <strong>existem dois comparadores de igualdade em JavaScript.</strong> <code class='javascript'>==</code> e <code class='javascript'>===</code>, assim como seus opostos <code class='javascript'>!=</code> e <code class='javascript'>!==</code>. A primeira forma converte automaticamente os tipos, enquanto que a outra n√£o.</p>


<h3 id='null'>Null e nullable</h3>

<p>Como podemos possivelmente mudar livremente os tipos das var√°veis que declaramos (embora n√£o seja recomendado), <strong>n√£o existe uma sintaxe especial para indicar que as vari√°veis podem ser <em>nullable</em>.</strong> Basta n√£o atribuir valor nenhum, e nesse caso a vari√°vel ter√° o valor especial <code class='javascript'>undefined</code>. Ou atribuir o valor <code class='javascript'>null</code> a elas. Em algumas linguagens existe um <strong>operador espec√≠fico para lidar com tipos nulos,</strong> chamado <em>null coalescing operator</em> (geralmente representado como <code class='generic'><span class='operator'>??</span></code> ou ainda uma forma abreviada do operador <code class='generic'><span class='operator'>?:</span></code>, tamb√©m chamado de operador Elvis). <strong>Em JavaScript, quem faz as vezes desse operador √© o OR l√≥gico <code class='javascript'>||</code>.</strong></p>

<p>TODO mostrar em outras linguagens quando pode ser nullable</p>

<div class='codeblock'>
<p>tipos null com let</p>
<code class='javascript'
>'use strict';

let k; // undefined
let l = null; // null

// || funciona como null coalescing operator
// isso quer dizer que se k for undefined ou null, m recebe o valor 2 ao inv√©s de k
// o mesmo vale para n, que recebe o valor 2 se l for undefined ou null

let m = k || 2; // 2
let n = l || 2; // 2

// existem outros valores que podem ser entendidos como null, como mencionei anteriormente no t√≥pico falsy values

let o = '';
let p = o || 2; // 2, pois '' √© falsy</code
>
</div>

<h4>Namespaces</h4>

<p>Essa funcionalidade, juntamente com <code class='javascript'>var</code>, costumava ser utilizada para <strong>simular namespaces,</strong> j√° que JavaScript n√£o os possui nativamente. Note que atualmente a utiliza√ß√£o de um <strong>padr√£o de m√≥dulos chamados <a hef='#amd'><abbr title='Asynchronous Module Definition'>AMD</abbr></a> √© mais recomendada</strong> por motivos de uso de mem√≥ria. Existe tamb√©m uma <a href='http://www.ecma-international.org/ecma-262/6.0/#sec-imports' rel='external nofollow'>expecifica√ß√£o para cria√ß√£o de m√≥dulos</a> usando as palavras <code class='javascript'>import</code> e <code class='javascript'>export</code>, que ainda n√£o foi implementada em nenhum navegador.</p>

<div class='codeblock'>
<p>tipos null com var</p>
<code class='javascript'
>'use strict';

var a = 1;
var b = null;

// var permite que se declare a mesma vari√°vel mais de uma vez
// ent√£o se a ou b j√° existirem, utilizamos o valor das vari√°veis existentes
// se n√£o, atribu√≠mos o valor 2

var a = a || 2; // 1
var b = b || 2; // 2</code
>
</div>

<p>Num mesmo arquivo a utilidade disso n√£o parece muito grande, mas em dois arquivos, este padr√£o se mostrava mais atrativo.</p>

<div class='codeblock'>
<p>sanfona.js - namespaces</p>
<code class='javascript'
>'use strict'

// namespace widgets
var widgets = widgets || {}; // garantimos que widgets exista antes de adicionarmos propriedades a ele

// namespace sanfona
widgets.sanfona = {};</code
>
</div>

<div class='codeblock'>
<p>calendario.js - namespaces</p>
<code class='javascript'
>'use strict'

// namespace widgets
var widgets = widgets || {}; // garantimos que widgets exista antes de adicionarmos propriedades a ele

// namespace calendario
widgets.calendario = {};</code
>
</div>

<div class='codeblock'>
<code class='javascript'
>var console = console || {}; // cria um objeto somente se console n√£o existir</code
>
</div>

<p>Vimos anteriormente que utilizando fun√ß√µes an√¥nimas autoexecut√°veis isolamos um escopo. Por√©m, n√£o conseguimos acess√°-lo de fora. Para tanto, precisamos simular um namespace. Aproveitamos que JavaScript permite adicionar dinamicamente propriedades em objetos para fazer isso.</p>

<div class='codeblock'>
<p>simula√ß√£o de namespaces</p>
<code class='javascript'
>var namespace = namespace || {};
namespace.subnamespace = namespace.subnamespace || {};

namespace.subnamespace.meuObjeto = {
	metodo: function() {
		//
	}
};

(function() {
	// "import"
	var meuObjeto = namespace.subnamespace.meuObjeto;

	meuObjeto.metodo();
})();</code
>
</div>

<p>O primeiro nivel do namescape ocupa o espa√ßo global, que como j√° vimos, √© compartilhado por todos os arquivos e blocos de script da p√°gina. Portanto, podemos acrescentar mais coisas posteriormente ao mesmo namespace em um arquivo diferente.</p>

<div class='codeblock'>
<p>simula√ß√£o de namespaces, outro arquivo</p>
<code class='javascript'
>var namespace = namespace || {};
namespace.subnamespace = namespace.subnamespace || {};

namespace.subnamespace.meuOutroObjeto = {
	metodo: function() {
		//
	}
};

(function() {
	// "import"
	var meuObjeto = namespace.subnamespace.meuObjeto;
	var meuOutroObjeto = namespace.subnamespace.meuOutroObjeto;

	meuObjeto.metodo();
	meuOutroObjeto.metodo();
})();</code
>
</div>


<h3 id='number'>Number</h3>

<p>√â o <strong>√∫nico tipo num√©rico</strong> existente em JavaScript. <strong>Sempre √© um <em>double</em></strong> <em>(double-precision 64-bit binary format IEEE 754-2008)</em> independente da nota√ß√£o que usamos. Pode tamb√©m conter os valores especiais <code class='javascript'>NaN</code>, infinito positivo (<code class='javascript'>Number.POSITIVE_INFINITY</code>) e infinito negativo (<code class='javascript'>Number.NEGATIVE_INFINITY</code>).</p>

<div class='codeblock'>
<p>formatos n√∫meros</p>
<code class='javascript'
>'use strict';

let i = 1; // √© um double!
let area = 4.527; // tamb√©m √© um double
const negativo = -2; // sem nota√ß√£o especial para n√∫meros negativos
let abreviado = .7; // 0.7

// nota√ß√£o cient√≠fica usa e ou E
let c1 = 1e0; // 1 √ó 10^0 = 1 √ó 1 = 1
let c2 = 1E-1; // 1 √ó 10^-1 = 1 √ó 0.1 = 0.1
let c3 = -.7e-2; // -0.7 √ó 10^-2 = -0.7 √ó 0.01 = -0.007

// nota√ß√£o bin√°ria usa b ou B
// tamb√©m s√£o double
let binario = 0b01;
let bipolarOtimista = 0B11010;
let bipolarNegativo = -0b11010;

// nota√ß√£o octal usa o (letra √≥ min√∫sculo) ou O (letra √≥ mai√∫sculo)
// vc adivinhou, eles tamb√©m s√£o double
let octal = 0o01234567;
let entreMeusDedos = 0O12345670;

// nota√ß√£o hexadecimal usa x ou X
// isso mesmo, voc√™ √© quase um expert
// os n√∫meros que utilizam essa nota√ß√£o tamb√©m s√£o double
let hexadecimal = 0x0123456789ABCDEF;
let cor = 0Xff0000;

// NOTA√á√ÉO DECIMAL
// ===============
// JavaScript permite que os n√∫meros
// sejam precedidos por 0 sem
// que isso influencie em seu valor
int i1 = 10;
int p1 = 01;

let impossible1 = 1 / 0; /// Infinity

let impossible2 = Math.sqrt(-1); // NaN
let impossible3 = Number.parseInt('wrong format'); // NaN

area.toFixed(1); // retorna '4.5'

1.9.toFixed(); // retorna '2'</code
>
</div>

<p><strong>N√∫meros n√£o sofrem <em>overflow</em> nem <em>underflow</em>, mas n√£o d√£o aviso se voc√™ tentar passar dos limites.</strong></p>

<div class='codeblock'>
<p>formatos n√∫meros</p>
<code class='javascript'
>'use strict';

let i = Number.MAX_VALUE;
let j = Number.MAX_VALUE + 1; // n√£o d√° aviso
if (i === j) {
	console.log('j foi limitado');
}

i = -i
j = -j - 1; // n√£o d√° aviso
if (i === j) {
	console.log('j foi limitado');
}</code
>
</div>

<h3 id='string'>String</h3>

<p>√â um objeto <strong>imut√°vel.</strong> Pode usar como delimitador <strong>aspas simples ou duplas</strong> dependendo da necessidade. Para quebr√°-la em mais de uma linha, escapamos a quebra de linha com uma barra invertida. Podemos escapar caracteres especiais assim como em outras linguagens.</p>

<div class='codeblock'>
<p>tipos de strings</p>
<code class='javascript'
>'use strict';

let simples = 'A primeira faz "tchan"';
let dupla = "A segunda faz 'tchun'";

const iara = "m√£e d'√°gua";
const modoDificil = 'O\'Reilly';
let html = '&lt;em class="especial"&gt;√™nfase&lt;/em&gt;';

let calvinHarris = 'how deep\nis your love'; // 2 linhas

let pareceMasNaoE = 'come√ßa e \
termina na mesma linha?'; // 1 linha apenas

// v√°rias linhas
let josePauloPaes = 'Meu amor √© simples, Dora,\n\
Como a √°gua e o p√£o.\n\
\n\
Como o c√©u refletido\n\
Nas pupilas de um c√£o.';

let emoji = 'üòç';
let es5 = '\uD83D\uDE0D'; // code units / surrogates
let es6 = '\u{1F60D}'; // code point

// string √© imut√°vel, ent√£o seus m√©todos retornam novas inst√¢ncias
let beeGees = calvinHarris.replace('love', 'looove'); // pq um tutorial de programa√ß√£o n√£o √© completo sem uma homenagem aos bee gees ;)

'Gritando'.toUpperCase(); // retorna 'GRITANDO'</code
>
</div>

<p>Existem strings um pouco <strong>mais poderosas</strong> √† partir da vers√£o ES6, chamadas <em>Template Strings</em>. Elas permitem ser quebradas em mais de uma linha. Seu <strong>demilitador √© a crase.</strong></p>

<div class='codeblock'>
<p>template strings</p>
<code class='javascript'
>'use strict';

let duplaTemplate = `A primeira faz "tchan". A segunda faz 'tchun'`;

// v√°rias linhas
let leminskiTemplate = `Merda √© veneno.
No entanto, n√£o h√° nada
que seja mais bonito
que uma bela cagada.
Cagam ricos, cagam pobres,
cagam reis e cagam fadas.
N√£o h√° merda que se compare
√† bosta da pessoa amada.`;</code
>
</div>

<p>A representa√ß√£o interna das strings √© UTF-16. Nas vers√µes ES6+, podemos iterar pelos <em>code points</em> das strings, isto √©, ler caractere por caractere independente do n√∫mero de bytes que eles usam. Nas vers√µes ES5-, apenas <em>code units</em> s√£o suportadas. O site 2ality tem um artigo bem completo sobre <a rel='external nofollow' href='http://www.2ality.com/2013/09/javascript-unicode.html'>codifica√ß√£o de strings</a> e outro <a rel='external nofollow' href='http://www.2ality.com/2015/01/es6-strings.html'>atualizado para ES6</a>.</p>

<div class='codeblock'>
<p>code points</p>
<code class='javascript'
>'use strict';

const multibyte = 'düòçb';
for (let caractere of multibyte) {
	console.log(caractere);
	console.log(caractere.length);
}

// d
// 1
// üòç
// 2
// b
// 1</code
>
</div>

<h4>Interpola√ß√£o de vari√°veis</h4>

<p>O real motivo das <em>template strings</em> existirem √© para facilitar a <strong>utiliza√ß√£o de vari√°veis junto com strings.</strong></p>

<div class='codeblock'>
<p>strings simples e template strings com vari√°veis</p>
<code class='javascript'
>'use strict';

let nome = 'Paf√∫ncio';
let respostaSimples = 'Oi ' + nome + '. J√° te ligo ok?';
let respostaTemplate = `Oi ${nome}. J√° te ligo ok?`;
// ambos geram Oi Paf√∫ncio. J√° te ligo ok?</code
>
</div>

<p>Existe ainda um <a href='#reticencias'>uso mais avan√ßado de templates</a> que veremos em na parte sobre fun√ß√µes.</p>


<h3 id='array'>Array</h3>

<p>Mistura de <code class='c'>Array</code> e <code class='c'>ArrayList&lt;Object&gt;</code>, isto √©, <strong>muda de tamanho conforme a necessidade, e pode armazenar tipos misturados.</strong> Podemos inicializar com um tamanho inicial por motivos de performance. Acessamos os elementos dela com o operador <code class='javascript'>[]</code>. Note que n√£o √© feito <strong>nenhum tipo de restri√ß√£o</strong> para acessar <strong>√≠ndices inexistentes</strong> na <code class='javascript'>Array</code>!</p>
<p>Assim como ganhamos performance ao <strong>manter</strong> sempre o mesmo tipo para uma vari√°vel, <strong>ganhamos performance ao armazenar</strong> sempre o mesmo tipo de vari√°veis numa <code class='javascript'>Array</code>.</p>

<div class='codeblock'>
<p>arrays</p>
<code class='javascript'
>'use strict';

let noticias = []; // array vazia

console.log(noticias.length); // mostra 0
console.log(noticias[56]); // mostra undefined e continua normalmente

// array √© mut√°vel, ent√£o seus m√©todos modificam a array
noticias.push('not√≠cia extremamente curta :P'); // insere um elemento ao final da Array
noticias[5] = 'e outra reduzida tamb√©m'; // insere um elemento no √≠ndice 5
noticias.push('ao vivo'); // insere um elemento no √≠ndice 6, que √© o final da Array

let noticias2 = new Array(10); // array vazia com espa√ßo pr√©-alocado para 10 elementos.

console.log(noticias2.length); // mostra 10
console.log(noticias2[4]); // mostra undefined, pois n√£o atribu√≠mos um valor para este √≠ndice
console.log(noticias2[20]); // mostra undefined, pois n√£o atribu√≠mos um valor para este √≠ndice

noticias2.push('vai no √≠ndice 11'); // os 10 primeiros s√£o undefined

let bagunca = [38, 'texto']; // perfeitamente legal, embora seja lento</code
>
</div>

<p>A <code class='javascript'>Array</code> possui alguns m√©todos nativos √∫teis, como <code class='javascript'>forEach</code>, <code class='javascript'>filter</code>, <code class='javascript'>map</code> e <code class='javascript'>reduce</code>. Mas devido ao <a href='#async'>modelo de paralelismo</a> da linguagem, creio que a otimiza√ß√£o desses m√©todos <strong>n√£o seja</strong> t√£o grande assim.</p>

<p>Os exemplos abaixo s√£o um pouco mais complicados, ent√£o talvez voc√™ queira ler a parte sobre fun√ß√µes e objetos e voltar aqui depois se n√£o entender alguma coisa.</p>

<div class='codeblock'>
<p>bonus m√©todos array</p>
<code class='javascript'
>'use strict';

// retorna uma nova array sem os elementos das posi√ß√µes pares
// se lembre que o √≠ndice come√ßa em 0, e n√£o em 1
[21, 72, 3, 34, 55, 60].filter(function(element, index) {
	if(index % 2 === 0) {
		return true;
	}
	return false;
});

// cria uma array literal
[1, 2]

	// executa o callback em cada elemento da array
	.map(function(currentValue) {
		return currentValue + 1;
	}) // [2, 3]

	// executa o callback em cada elemento da array
	// e vai acumulando o resultado
	.reduce(function(previousValue, currentValue) {
		return previousValue + currentValue;
	}); // o retorno de reduce √© 5</code
>
</div>


<h3 id='regex'>RegExp</h3>

<p>Al√©m do objeto <code class='javascript'>RegExp</code>, JavaScript possui express√µes regulares em forma de literal, delimitadas por barras, e opcionalmente com <em>flags</em> ap√≥s a barra final.</p>

<div class='codeblock'>
<p>formatos de express√µes regulares</p>
<code class='javascript'
>'use strict';

const regex = /a+/gi; // express√£o na forma literal com flags g (n√£o parar no primeiro match) e i (case insensitive)
const regex2 = new RegExp('a+', 'gi'); // mesma express√£o na forma de objeto

regex.test('abobrinha'); // retorna true
/why don't you/.test('me now\?'); // retorna false</code
>
</div>


<h3 id='function'>Function</h3>

<p>Em JavaScript, m√©todos e fun√ß√µes <strong>sempre s√£o <a rel='external nofollow' href='https://en.wikipedia.org/wiki/Function_object'>objetos</a>!</strong> Isso significa que elas possuem propriedades e m√©todos como o <code class='javascript'>call</code> por exemplo.</p>

<p>Nunca declaramos o tipo de retorno de uma fun√ß√£o. Uma vez que JavaScript n√£o pro√≠be que os tipos das vari√°veis mude, √© permitido que a fun√ß√£o retorne qualquer coisa, misture os tipos de retorno, etc. O n√∫mero de par√¢metros tamb√©m <strong>n√£o precisa</strong> ser declarado, ou seja, todas as fun√ß√µes em JavaScript s√£o <a href='https://en.wikipedia.org/wiki/Variadic_function' rel='external nofollow'>vari√°dicas</a>. Esta funcionalidade costumava ser usada para simular <strong>sobrecarga de fun√ß√£o</strong>, juntamente com o objeto <code class='javascript'>arguments</code> que toda a fun√ß√£o <strong>recebe implicitamente.</strong> Por√©m esta √© uma <strong>pr√°tica n√£o mais recomendada.</strong> Para a solu√ß√£o atual recomendada, veja <a href='#reticencias'>operador rest</a>.</p>

<p>Note que embora a chamada de fun√ß√µes da maneira descrita acima seja permitida, o compilador ainda pode lan√ßar exce√ß√µes ao tentar utilizar vari√°veis que n√£o foram devidamente passadas ao m√©todo.</p>

<div class='codeblock'>
<p>chamadas v√°lidas de m√©todos</p>
<code class='javascript'
>'use strict';

function comum() {
	console.log(arguments); // objeto arguments iniciado automaticamente, contendo os par√¢metros utilizados na chamada
}

function normal(texto) {
	console.log(arguments); // objeto arguments iniciado automaticamente, contendo os par√¢metros utilizados na chamada
}

function retornoMisturado(numero) {
	if (numero > 0) {
		return 'texto';
	}
	return 25;
}

// chamadas perfeitamente v√°lidas
comum(); // arguments ser√° []
comum('lala'); // arguments ser√° ['lala']
comum('lala', 'lolo'); // arguments ser√° ['lala', 'lolo']
normal('lolo'); // texto ser√° 'lolo' e  arguments ser√° ['lolo']

// chamada v√°lida
normal(); // o par√¢metro texto ter√° o valor undefined e arguments ser√° []

normal.call(this, 'dada√≠smo'); // o par√¢metro texto ter√° o valor 'dada√≠smo' e arguments ser√° ['dada√≠smo']

retornoMisturado(-1); // retorna 25
retornoMisturado(1); // retorna 'texto'</code
>
</div>

<p>Como mencionei, a possibilidade de chamar fun√ß√µes com par√¢metros diferentes dos definidos costumava ser usada para simular sobrecarga de fun√ß√£o. Se voc√™ precisa dar manuten√ß√£o em c√≥digos antigos, saiba que em Javascript, os <strong>m√©todos s√£o diferenciados pelo seu nome exclusivamente,</strong> e sua sobrecarga antigamente era feita da seguinte maneira:</p>

<div class='codeblock'>
<p>sobrecarga de fun√ß√£o</p>
<code class='javascript'
>'use strict';

function efetuarRequisicaoAjax(endereco) {

	const url = endereco;

	<strong>// SINTAXE ANTIGA!!! N√ÉO COPIE!!!</strong>

	if (arguments[1]) {

		if (typeof arguments[1] === 'number') { // segundo par√¢metro passado para a fun√ß√£o
			url += '?pagina=' + arguments[1];
		} else if (typeof arguments[1] === 'string') {
			url += '?token=' + arguments[1];
		}

	}

	<strong>// SINTAXE ANTIGA!!! N√ÉO COPIE!!!</strong>

	if (arguments[2]) {
		url += '&amp;pagina=' + arguments[2]; // terceiro par√¢metro passado para a fun√ß√£o
	}

	console.log(url); // vamos ver um exemplo real de ajax l√° no final ;)

}

<strong>// SINTAXE ANTIGA!!! N√ÉO COPIE!!!</strong>

efetuarRequisicaoAjax('webservicedagrecia.ashx');
efetuarRequisicaoAjax('webservicedagrecia.ashx', 2);
efetuarRequisicaoAjax('webserviceseguro.ashx', '987dcb987d6b96a9d5ab');
efetuarRequisicaoAjax('webserviceseguro.ashx', '987dcb987d6b96a9d5ab', 2);</code
>
</div>

<p id='funcaoestrita'>Como mencionei l√° no come√ßo, fun√ß√µes podem ser selecionadas individualmente para utilizar o modo estrito. Isso √© √∫til nos casos em que precisamos dar manuten√ß√£o em c√≥digos antigos, ou quando inserimos c√≥digo <strong>dentro de tags</strong> <code class='html'>&lt;script /&gt;</code>, ao inv√©s de em arquivos externos.</p>

<div class='codeblock'>
<p>fun√ß√µes estritas</p>
<code class='javascript'
>function funcaoNormal() {
	console.log(varNaoDeclarada); // mostra undefined em navegadores antigos, nos novos lan√ßa exce√ß√£o
}

function funcaoEstrita() {
	'use strict';

	console.log(varNaoDeclarada); // lan√ßa exce√ß√£o
}</code
>
</div>

<p>JavaScript suporta <strong>fun√ß√µes an√¥nimas, ou express√µes lambda.</strong> Express√µes lambda s√£o utilizados frequentemente em JavaScript, por isso √© importante compreender o que s√£o.</p>

<p>Express√µes lambda s√£o declara√ß√µes de fun√ß√µes an√¥nimas diretamente no meio do c√≥digo. Basicamente em qualquer lugar onde podemos passar uma refer√™ncia para uma fun√ß√£o, podemos criar uma express√£o lambda. Seguem exemplos em outras linguagens de express√µes lambdas.</p>

<div class='codeblock'>
<p>c√≥digo C</p>
<code class='generic'
><span class='comment'>// lambda em C</span>
<span class='comment'>// pegadinha do malandro! C n√£o tem isso.</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo Swift</p>
<code class='generic'
><span class='comment'>// lambda em Swift</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong><span class='operator'>{() -></span> <span class='type'>TipoDoRetorno</span> <span class='keyword'>in</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>)</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo Objective-C</p>
<code class='generic'
><span class='comment'>// lambda em Objective-C (OS X v10.6+ e iOS 4+) - chamado de Block</span>

<span class='operator'>[</span><span class='symbol'>superior</span> <span class='symbol'>usando</span><span class='operator'>:</span><strong><span class='operator'>^() {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>];</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo C#</p>
<code class='generic'
><span class='comment'>// lambda em C# 4 - id√™ntico a JavaScript</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong><span class='operator'>() =&gt; {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>);</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo Java</p>
<code class='generic'
><span class='comment'>// lambda em Java 8</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong><span class='operator'>() -&gt; {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>);</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo C++</p>
<code class='generic'
><span class='comment'>// lambda em C++11</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong><span class='operator'>[] () {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>);</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo Rust</p>
<code class='generic'
><span class='comment'>// lambda em Rust</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong><span class='operator'>|| {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>);</span></code
>
</div>

<div class='codeblock'>
<p>c√≥digo PHP</p>
<code class='generic'
><span class='comment'>// lambda em PHP - id√™ntico a JavaScript</span>

<span class='symbol'>superior</span><span class='operator'>(</span><strong>function<span class='operator'>() {</span></strong>
	<span class='comment'>// corpo da fun√ß√£o</span>
<strong><span class='operator'>}</span></strong><span class='operator'>);</span></code
>
</div>

<p>E as duas formas poss√≠veis em JavaScript.</p>

<div class='codeblock'>
<p>c√≥digo JavaScript - fun√ß√µes de ordem superior</p>
<code class='javascript'
>'use strict';

// fun√ß√£o normal
function normal() {
	//
}

// fun√ß√£o de ordem superior
function superior(funcao) {
	funcao(); // executa a fun√ß√£o passada
}

<strong>// fun√ß√£o normal sendo passado como par√¢metro - note que usamos apenas o nome, sem executar com ()</strong>
superior(<strong class='small'>normal</strong>);

<strong>// express√£o lambda sendo passada como par√¢metro</strong>
superior(<strong class='small'>function() {</strong>
	//
<strong>}</strong>);

<strong>// express√£o lambda com nova sintaxe de flecha (ES6) sendo passada como par√¢metro</strong>
<strong>// dependendo do que a express√£o lambda fizer, alguns caracteres podem ser omitidos</strong>
superior(<strong class='small'>() =&gt; {</strong>
	//
<strong>}</strong>);</code
>
</div>

<p>Fun√ß√µes definidas com a flecha gorda, possuem novas regras espec√≠ficas para a palavra-chave this utilizada dentro de seu corpo. Vale conferir as <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions#Lexical_this' rel='external nofollow'>regras na MDN</a>.</p>

<p>Al√©m de express√µes lambda, JavaScript suporta um modo de declara√ß√£o chamado <strong><q>express√£o de fun√ß√£o</q>.</strong> Mais adiante veremos <a href='#funcaoanonimaescopo'>outro uso para este tipo de declara√ß√£o</a>.</p>

<div class='codeblock'>
<p>express√µes de fun√ß√£o</p>
<code class='javascript'
>'use strict';

// declara√ß√£o de fun√ß√£o
function normal() {
	//
}

// express√£o de fun√ß√£o - tratamos a fun√ß√£o como um valor
const surpresa = function() {
	//
};

// express√£o de fun√ß√£o
const outraSurpresa = normal;

normal();
surpresa();
outraSurpresa();

// express√£o de fun√ß√£o an√¥nima - note os () em volta dela
// veremos mais adiante <a href='#funcaoanonimaescopo'>outros usos para essa forma</a>
(function() {
	//
});
</code
>
</div>

<h3 id='reticencias'>Operadores rest e spread</h3>

<p>Agora que conhecemos fun√ß√µes, strings e arrays, podemos ver um exemplo mais completo dessas partes. Existem dois operadores em JavaScript que s√£o representados por <code class='javascript'>...</code>, chamados rest e spread. A fun√ß√£o deles √© respectivamente transformar uma sequ√™ncia de elementos em uma <code class='javascript'>Array</code>, e expandir uma <code class='javascript'>Array</code> em uma sequ√™ncia de elementos. Como ambos usam <code class='javascript'>...</code>, o que diferencia um do outro √© o local de uso.</p>

<p>Num local onde fa√ßa sentido expandir a <code class='javascript'>Array</code>, teremos o operador spread.</p>

<div class='codeblock'>
<p>operador spread</p>
<code class='javascript'
>'use strict';

let comeco = [1, 2, 3];
let completo = [...comeco, 4, 5]; // [1, 2, 3, 4, 5]

function tresArgumentos(primeiro, segundo, terceiro) {
	//
}

// expandindo argumentos passados
tresArgumentos(...comeco); // primeiro = 1, segundo = 2, terceiro = 3</code
>
</div>

<p>E portanto, num local onde fa√ßa mais sentido juntar os elementos, teremos o operador rest.</p>

<div class='codeblock'>
<p>operador rest</p>
<code class='javascript'
>'use strict';

let a, b, outros;
[a, b] = [1, 2]; // a = 1, b = 2
[a, b, ...outros] = [1, 2, 3, 4, 5]; // a = 1, b = 2, outros = [3, 4, 5]

// agrupando argumentos que se espera receber
// ou fun√ß√µes vari√°dicas
function variosArgumentos(primeiro, segundo, ...outros) {
	//
}

variosArgumentos(1, 2, 3, 4, 5); // primeiro = 1, segundo = 2, outros = [3, 4, 5]</code
>
</div>

<p>Este operador √© o recomendado atualmente para a programa√ß√£o de <strong>sobrecarga de m√©todos,</strong> ao inv√©s de utilizar o objeto legado <code class='javascript'>arguments</code>. Suas vantagens incluem a maior facilidade de misturar par√¢metros nomeados e n√£o nomeados, percorrer os par√¢metros n√£o nomeados como uma <code class='javascript'>Array</code> (ao passo que <code class='javascript'>arguments</code> √© um objeto com propriedades numeradas) e servir exclusivamente para gerenciar par√¢metros, sendo que <code class='javascript'>arguments</code> possui propriedades depreciadas como <code class='javascript'>arguments.caller</code> e <code class='javascript'>arguments.callee</code>.</p>

 <p>Em linguagens mais estritas, os m√©todos s√£o diferenciados pela sua assinatura, que √© composta pelo nome e pela quantidade e tipos de par√¢metros. Portanto, podemos declarar fun√ß√µes e m√©todos com nomes diferentes desde que seus par√¢metros tamb√©m sejam diferentes.</p>

<div class='codeblock'>
<p>sobrecarga de fun√ß√£o em C# / Java</p>
<code class='generic'
><span class='comment lineComment'>// Sobrecarga de m√©todo em C# / Java</span>

<span class='keyword'>public</span> <span class='keyword'>class</span> <span class='symbol'>Overloaded</span> <span class='operator'>{</span>
	<span class='keyword'>public</span> <span class='keyword'>void</span> <span class='symbol'>skip</span><span class='operator'>()</span> <span class='operator'>{</span> <span class='comment blockComment'>/**/</span> <span class='operator'>}</span>
	<span class='keyword'>public</span> <span class='keyword'>void</span> <span class='symbol'>skip</span><span class='operator'>(</span><span class='type nativeType'>int</span> <span class='symbol'>amount</span><span class='operator'>)</span> <span class='operator'>{</span> <span class='comment blockComment'>/**/</span> <span class='operator'>}</span>
<span class='operator'>}</span>
</code
>
</div>

<div class='codeblock'>
<p>sobrecarga de fun√ß√£o em C++</p>
<code class='generic'
><span class='comment lineComment'>// Sobrecarga de m√©todo em C++</span>

<span class='keyword'>public</span> <span class='keyword'>class</span> <span class='symbol'>Overloaded</span> <span class='operator'>{</span>
	<span class='keyword'>public</span>:
	<span class='keyword'>void</span> <span class='symbol'>skip</span><span class='operator'>()</span> <span class='operator'>{</span> <span class='comment blockComment'>/**/</span> <span class='operator'>}</span>
	<span class='keyword'>void</span> <span class='symbol'>skip</span><span class='operator'>(</span><span class='type nativeType'>int</span> <span class='symbol'>amount</span><span class='operator'>)</span> <span class='operator'>{</span> <span class='comment blockComment'>/**/</span> <span class='operator'>}</span>
}
</code
>
</div>

<p>Em JavaScript tal diferencia√ß√£o n√£o existe. As fun√ß√µes s√£o diferenciadas exclusivamente pelo seu nome. Portanto, a maneira mais pr√≥xima de obtermos o que queremos, √© utilizando outro recurso, tamb√©m presente em diversas outras linguagens. Podemos permitir uma quantidade vari√°vel de par√¢metros nas fun√ß√µes, e depois escolhermos o que fazer baseados nos tipos dos argumentos.</p>

<p>Das linguagens mais utilizadas atualmente que suportam esse recurso, C e Objective-C possuem uma sintaxe pr√≥pria com macros. C++ usa templates, que s√£o ligeiramente mais verbosos. As demais s√£o bastante parecidas como podemos ver a seguir.</p>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em Swift</p>
<code class='generic'
><span class='comment lineComment'>// fun√ß√µes vari√°dicas em Swift</span>

<strong class='comment'><span class='comment lineComment'>// argumentos do mesmo tipo</span></strong>

<strong><span class='keyword'>func</span> <span class='symbol'>imprimirSimples</span><span class='operator'>(</span></strong><span class='symbol'>titulo titulo</span><span class='operator'>:</span><span class='type'>String</span><span class='operator'>,</span> <strong><span class='symbol'>paginas</span><span class='operator'>:</span><span class='type'>Int</span><span class='operator'>...) {</span></strong>
	<strong><span class='keyword'>for</span> <span class='symbol'>pagina</span> <span class='keyword'>in</span> <span class='symbol'>paginas</span> <span class='operator'>{</span></strong>
		<span class='symbol'>print</span><span class='operator'>(</span><span class='string'>"Imprimindo p√°gina \(pagina) num total de \(paginas.count)"</span><span class='operator'>)</span>
	<strong><span class='operator'>}</span></strong>
<strong><span class='operator'>}</span></strong>

<span class='symbol'>imprimirSimples</span><span class='operator'>(</span><span class='symbol'>titulo</span><span class='operator'>:</span> <span class='string'>"resumo"</span><span class='operator'>,</span> <span class='symbol'>paginas</span><span class='operator'>:</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span>

<strong class='comment'><span class='comment lineComment'>// argumentos de todos os tipos</span></strong>

<span class='keyword'>func</span> <span class='symbol'>imprimir</span><span class='operator'>(</span><span class='symbol'>titulo titulo</span><span class='operator'>:</span><span class='type'>String</span><span class='operator'>,</span> <strong><span class='symbol'>paginas</span><span class='operator'>:</span><span class='type'>Any</span><span class='operator'>...</span></strong><span class='operator'>) {</span>
	<span class='keyword'>for</span> <span class='symbol'>valor</span> <span class='keyword'>in</span> <span class='symbol'>paginas</span> <span class='operator'>{</span>
		<strong><span class='keyword'>switch</span> <span class='symbol'>valor</span> <span class='operator'>{</span></strong>
		<strong><span class='keyword'>case</span></strong> <span class='keyword'>let</span> <span class='symbol'>pagina</span> <strong><span class='keyword'>as</span> <span class='type'>Int</span><span class='operator'>:</span></strong>
			<span class='symbol'>print</span><span class='operator'>(</span><span class='string'>"Imprimindo p√°gina \(pagina)"</span><span class='operator'>)</span>
		<strong><span class='keyword'>case</span></strong> <span class='keyword'>let</span> <span class='symbol'>faixa</span> <strong><span class='keyword'>as</span> <span class='type'>Range&lt;Int&gt;</span><span class='operator'>:</span></strong>
			<span class='symbol'>print</span><span class='operator'>(</span><span class='string'>"Imprimindo p√°ginas \(faixa.first!) at√© \(faixa.last!)"</span><span class='operator'>)</span>
		<strong><span class='keyword'>default</span><span class='operator'>:</span></strong>
			<span class='symbol'>print</span><span class='operator'>(</span><span class='string'>"Imprimindo outra coisa"</span><span class='operator'>)</span>
		<strong><span class='operator'>}</span></strong>
	<span class='operator'>}</span>
<span class='operator'>}</span>

<span class='symbol'>imprimir</span><span class='operator'>(</span><span class='symbol'>titulo</span><span class='operator'>:</span> <span class='string'>"resumo"</span><span class='operator'>,</span> <span class='symbol'>paginas</span><span class='operator'>:</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>...</span><span class='number'>5</span><span class='operator'>,</span> <span class='string'>"cap√≠tulo 2"</span><span class='operator'>)</span></code
>
</div>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em C#</p>
<code class='generic'
><span class='comment lineComment'>// fun√ß√µes vari√°dicas em C#</span>
<span class='comment lineComment'>// a prop√≥sito, o estilo padr√£o de { e } em C# √© que eles fiquem em linhas separadas</span>
<span class='comment lineComment'>// mas ia ocupar muito espa√ßo desnecess√°rio nesse exemplo</span>

<strong class='comment'><span class='comment lineComment'>// argumentos do mesmo tipo</span></strong>

<strong><span class='keyword'>void</span> <span class='symbol'>ImprimirSimples</span><span class='operator'>(</span></strong><span class='type'>string</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='keyword'>params</span> <span class='type'>int[]</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
	<strong><span class='keyword'>foreach</span> <span class='operator'>(</span><span class='type'>int</span> <span class='symbol'>pagina</span> <span class='keyword'>in</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
		<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>Console</span><span class='operator'>.</span><span class='symbol'>WriteLine</span><span class='operator'>(</span><span class='string'>@"Imprimindo pagina {0} num total de {1}"</span><span class='operator'>,</span> <span class='symbol'>pagina</span><span class='operator'>,</span> <span class='symbol'>paginas</span><span class='operator'>.</span><span class='symbol'>Length</span><span class='operator'>)</span><span class='operator'>;</span>
	<strong><span class='operator'>}</span></strong>
<strong><span class='operator'>}</span></strong>

<span class='symbol'>ImprimirSimples</span><span class='operator'>(</span><span class='string'>@"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>;</span>

<strong class='comment'><span class='comment lineComment'>// argumentos de todos os tipos</span></strong>

<span class='keyword'>void</span> <span class='symbol'>Imprimir</span><span class='operator'>(</span><span class='type'>string</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='keyword'>params</span> <span class='type'>object[]</span> <span class='symbol'>paginas</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='keyword'>foreach</span> <span class='operator'>(</span><span class='type'>object</span> <span class='symbol'>valor</span> <span class='keyword'>in</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span>
		<strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><span class='symbol'>valor</span> <strong><span class='keyword'>is</span> <span class='type'>int</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>Console</span><span class='operator'>.</span><span class='symbol'>WriteLine</span><span class='operator'>(</span><span class='string'>@"Imprimindo p√°gina {0}"</span><span class='operator'>,</span> <span class='symbol'>valor</span><span class='operator'>)</span><span class='operator'>;</span>
		<span class='operator'>}</span> <span class='keyword'>else</span> <strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><span class='symbol'>valor</span> <strong><span class='keyword'>is</span> <span class='type'>IEnumerable&lt;int&gt;</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>Console</span><span class='operator'>.</span><span class='symbol'>WriteLine</span><span class='operator'>(</span>
				<span class='string'>@"Imprimindo p√°ginas {0} at√© {1}"</span><span class='operator'>,</span>
				<span class='operator'>(</span><span class='symbol'>valor</span> <span class='keyword'>as</span> <span class='type'>IEnumerable&lt;int&gt;</span><span class='operator'>)</span><span class='operator'>.</span><span class='symbol'>First</span><span class='operator'>(</span><span class='operator'>)</span><span class='operator'>,</span>
				<span class='operator'>(</span><span class='symbol'>valor</span> <span class='keyword'>as</span> <span class='type'>IEnumerable&lt;int&gt;</span><span class='operator'>)</span><span class='operator'>.</span><span class='symbol'>Last</span><span class='operator'>(</span><span class='operator'>)</span>
			<span class='operator'>)</span><span class='operator'>;</span>
		<span class='operator'>}</span> <strong><span class='keyword'>else</span></strong> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>Console</span><span class='operator'>.</span><span class='symbol'>WriteLine</span><span class='operator'>(</span><span class='string'>@"Imprimindo outra coisa"</span><span class='operator'>)</span><span class='operator'>;</span>
		<span class='operator'>}</span>
	<span class='operator'>}</span>
<span class='operator'>}</span>

<span class='symbol'>Imprimir</span><span class='operator'>(</span><span class='string'>@"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='symbol'>Enumerable</span><span class='operator'>.</span><span class='symbol'>Range</span><span class='operator'>(</span><span class='number'>2</span><span class='operator'>,</span> <span class='number'>4</span><span class='operator'>)</span><span class='operator'>,</span> <span class='string'>@"cap√≠tulo 2"</span><span class='operator'>)</span><span class='operator'>;</span></code
>
</div>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em Java</p>
<code class='generic'
><span class='comment lineComment'>// m√©todos vari√°dicos em Java</span>
<span class='comment lineComment'>// algumas coisas foram omitidas propositalmente como main</span>

<strong class='comment'><span class='comment lineComment'>// argumentos do mesmo tipo</span></strong>

<strong><span class='keyword'>void</span> <span class='symbol'>imprimirSimples</span><span class='operator'>(</span></strong><span class='type'>String</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='type'>int</span><span class='operator'>...</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
	<strong><span class='keyword'>for</span> <span class='operator'>(</span><span class='type'>int</span> <span class='symbol'>pagina</span> <span class='operator'>:</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
		<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>out</span><span class='operator'>.</span><span class='symbol'>println</span><span class='operator'>(</span><span class='symbol'>String</span><span class='operator'>.</span><span class='symbol'>format</span><span class='operator'>(</span><span class='string'>"Imprimindo p√°gina %1"</span><span class='operator'>,</span> <span class='symbol'>pagina</span><span class='operator'>)</span><span class='operator'>)</span><span class='operator'>;</span>
	<strong><span class='operator'>}</span></strong>
<strong><span class='operator'>}</span></strong>

<span class='symbol'>imprimirSimples</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>;</span>

<strong class='comment'><span class='comment lineComment'>// argumentos de todos os tipos</span></strong>

<span class='keyword'>void</span> <span class='symbol'>imprimir</span><span class='operator'>(</span><span class='type'>String</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='type'>Object</span><span class='operator'>...</span> <span class='symbol'>paginas</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='keyword'>for</span> <span class='operator'>(</span><span class='type'>Object</span> <span class='symbol'>valor</span> <span class='operator'>:</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span>
		<strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><span class='symbol'>valor</span> <strong><span class='keyword'>instanceof</span> <span class='type'>Integer</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>out</span><span class='operator'>.</span><span class='symbol'>println</span><span class='operator'>(</span><span class='symbol'>String</span><span class='operator'>.</span><span class='symbol'>format</span><span class='operator'>(</span><span class='string'>"Imprimindo p√°gina %d"</span><span class='operator'>,</span> <span class='symbol'>valor</span><span class='operator'>)</span><span class='operator'>)</span><span class='operator'>;</span>
		<span class='operator'>}</span> <span class='keyword'>else</span> <strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><span class='symbol'>valor</span> <strong><span class='keyword'>instanceof</span> <span class='type'>Range&lt;Integer&gt;</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>out</span><span class='operator'>.</span><span class='symbol'>println</span><span class='operator'>(</span><span class='symbol'>String</span><span class='operator'>.</span><span class='symbol'>format</span><span class='operator'>(</span>
				<span class='string'>"Imprimindo p√°ginas %d at√© %d"</span><span class='operator'>,</span>
				<span class='operator'>((</span><span class='symbol'>Range</span><span class='operator'>&lt;</span><span class='symbol'>Integer</span><span class='operator'>&gt;</span><span class='operator'>)</span><span class='symbol'>valor</span><span class='operator'>)</span><span class='operator'>.</span><span class='symbol'>getMinimum</span><span class='operator'>()</span><span class='operator'>,</span>
				<span class='operator'>((</span><span class='symbol'>Range</span><span class='operator'>&lt;</span><span class='symbol'>Integer</span><span class='operator'>&gt;</span><span class='operator'>)</span><span class='symbol'>valor</span><span class='operator'>)</span><span class='operator'>.</span><span class='symbol'>getMaximum</span><span class='operator'>()</span>
			<span class='operator'>));</span>
		<span class='operator'>}</span> <strong><span class='keyword'>else</span></strong> <span class='operator'>{</span>
			<span class='symbol'>System</span><span class='operator'>.</span><span class='symbol'>out</span><span class='operator'>.</span><span class='symbol'>println</span><span class='operator'>(</span><span class='string'>"Imprimindo outra coisa"</span><span class='operator'>);</span>
		<span class='operator'>}</span>
	<span class='operator'>}</span>
<span class='operator'>}</span>

<span class='symbol'>imprimir</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='symbol'>Range</span><span class='operator'>.</span><span class='symbol'>between</span><span class='operator'>(</span><span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>,</span> <span class='string'>"cap√≠tulo 2"</span><span class='operator'>)</span><span class='operator'>;</span></code
>
</div>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em PHP 5.6+</p>
<code class='generic'
><span class='comment lineComment'>// fun√ß√µes vari√°dicas em PHP</span>

<strong class='comment'><span class='comment lineComment'>// argumentos do mesmo tipo</span></strong>

<strong><span class='keyword'>function</span> <span class='symbol'>imprimirSimples</span><span class='operator'>(</span></strong><span class='type'>string</span> <span class='symbol'>$titulo</span><span class='operator'>,</span> <strong><span class='type'>int</span> <span class='operator'>...</span><span class='symbol'>$paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
	<strong><span class='keyword'>foreach</span> <span class='operator'>(</span><span class='symbol'>$paginas</span> <span class='keyword'>as</span> <span class='symbol'>$pagina</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
		<span class='keyword'>echo</span> <span class='string'>"Imprimindo p√°gina $pagina\n"</span><span class='operator'>;</span>
	<strong><span class='operator'>}</span></strong>
<strong><span class='operator'>}</span></strong>

<span class='symbol'>imprimirSimples</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>;</span>

<strong class='comment'><span class='comment lineComment'>// argumentos de todos os tipos</span></strong>

<span class='keyword'>function</span> <span class='symbol'>imprimir</span><span class='operator'>(</span><span class='type'>string</span> <span class='symbol'>$titulo</span><span class='operator'>,</span> <strong><span class='operator'>...</span><span class='symbol'>$valores</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='keyword'>foreach</span> <span class='operator'>(</span><span class='symbol'>$valores</span> <span class='keyword'>as</span> <span class='symbol'>$valor</span><span class='operator'>)</span> <span class='operator'>{</span>
		<strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><strong><span class='symbol'>is_int</span><span class='operator'>(</span><span class='symbol'>$valor</span><span class='operator'>)</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='keyword'>echo</span> <span class='string'>"Imprimindo p√°gina $valor\n"</span><span class='operator'>;</span>
		<span class='operator'>}</span> <span class='keyword'>else</span> <strong><span class='keyword'>if</span></strong> <span class='operator'>(</span><strong><span class='symbol'>is_array</span><span class='operator'>(</span><span class='symbol'>$valor</span><span class='operator'>)</span></strong><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='keyword'>echo</span> <span class='string'>'Imprimindo p√°ginas'</span> <span class='operator'>.</span> <span class='symbol'>$valor</span><span class='operator'>[</span><span class='number'>0</span><span class='operator'>]</span> <span class='operator'>.</span> <span class='string'>' at√© '</span> <span class='operator'>.</span> <span class='symbol'>$valor</span><span class='operator'>[</span><span class='symbol'>count</span><span class='operator'>(</span><span class='symbol'>$valor</span><span class='operator'>)</span> <span class='operator'>-</span> <span class='number'>1</span><span class='operator'>]</span> <span class='operator'>.</span> <span class='string'>"\n"</span><span class='operator'>;</span>
		<span class='operator'>}</span> <strong><span class='keyword'>else</span></strong> <span class='operator'>{</span>
			<span class='keyword'>echo</span> <span class='string'>"Imprimindo outra coisa\n"</span><span class='operator'>;</span>
		<span class='operator'>}</span>
	<span class='operator'>}</span>
<span class='operator'>}</span>

<span class='symbol'>imprimir</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='symbol'>range</span><span class='operator'>(</span><span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>,</span> <span class='string'>"cap√≠tulo 2"</span><span class='operator'>)</span><span class='operator'>;</span></code
>
</div>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em C++</p>
<code class='generic'
><span class='comment lineComment'>// fun√ß√µes vari√°dicas em C++</span>

<strong class='comment'><span class='comment lineComment'>// argumentos do mesmo tipo</span></strong>

<span class='directive'>#include &lt;iostream&gt;</span>

<strong><span class='keyword'>template</span><span class='operator'>&lt;</span><span class='keyword'>typename</span><span class='operator'>...</span> <span class='type'>Tipos</span><span class='operator'>&gt;</span></strong>
<strong><span class='keyword'>void</span> <span class='symbol'>imprimirSimples</span><span class='operator'>(</span></strong><span class='type'>std::string</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='type'>Tipos</span><span class='operator'>...</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>

	<span class='keyword'>const</span> <span class='type'>unsigned short int</span> <span class='symbol'>quantidadeDeParametros</span> <span class='operator'>{</span><span class='symbol'>sizeof...</span><span class='operator'>(</span><span class='symbol'>paginas</span><span class='operator'>)</span><span class='operator'>}</span><span class='operator'>;</span>

	<span class='comment lineComment'>// n√£o pode criar uma array com 0 elementos</span>
	<span class='keyword'>if</span> <span class='operator'>(</span><span class='symbol'>quantidadeDeParametros</span> <span class='operator'>==</span> <span class='number'>0</span><span class='operator'>)</span> <span class='operator'>{</span>
		<span class='keyword'>return</span><span class='operator'>;</span>
	<span class='operator'>}</span>

	<span class='comment lineComment'>// expande os argumentos</span>
	<strong><span class='type'>int</span> <span class='symbol'>paginasArray</span><span class='operator'>[</span><span class='symbol'>quantidadeDeParametros</span><span class='operator'>]</span> <span class='operator'>{</span><span class='symbol'>paginas</span><span class='operator'>...</span><span class='operator'>}</span><span class='operator'>;</span></strong>

	<strong><span class='keyword'>for</span> <span class='operator'>(</span><span class='keyword'>auto</span> <span class='symbol'>pagina</span> <span class='operator'>:</span> <span class='symbol'>paginasArray</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
		<span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>cout</span> <span class='operator'>&lt;&lt;</span> <span class='string'>"Imprimindo p√°gina "</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>pagina</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>endl</span><span class='operator'>;</span>
	<strong><span class='operator'>}</span></strong>

<strong><span class='operator'>}</span></strong>

<span class='symbol'>imprimirSimples</span><span class='operator'>(</span><span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>;</span>

<span class='comment lineComment'>// ou com macros n√£o seguras estilo C</span>
<span class='comment lineComment'>// Objective-C tem que fazer igual</span>

<span class='directive'>#include &lt;iostream&gt;</span>
<strong><span class='directive'>#include &lt;cstdarg&gt;</span></strong>

<strong><span class='keyword'>void</span> <span class='symbol'>imprimirSimplesMacro</span><span class='operator'>(</span></strong><span class='keyword'>const</span> <span class='type'>std::string</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong><span class='operator'>...</span><span class='operator'>)</span> <span class='operator'>{</span></strong>

	<span class='comment lineComment'>// va_list argumentos recebe o que vir depois do par√¢metro titulo</span>
	<strong><span class='type'>va_list</span> <span class='symbol'>argumentos</span><span class='operator'>;</span></strong>
	<strong><span class='symbol'>va_start</span><span class='operator'>(</span><span class='symbol'>argumentos</span><span class='operator'>,</span> <span class='symbol'>titulo</span><span class='operator'>)</span><span class='operator'>;</span></strong>

	<span class='type'>int</span> <span class='symbol'>pagina</span><span class='operator'>;</span>
	<strong><span class='keyword'>while</span> <span class='operator'>(</span><span class='keyword'>true</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
		<strong><span class='symbol'>pagina</span> <span class='operator'>=</span> <span class='symbol'>va_arg</span><span class='operator'>(</span><span class='symbol'>argumentos</span><span class='operator'>,</span> <span class='type'>int</span><span class='operator'>)</span><span class='operator'>;</span></strong>
		<span class='keyword'>if</span> <span class='operator'>(</span><span class='symbol'>pagina</span> <span class='operator'>==</span> <span class='number'>-1</span><span class='operator'>)</span> <span class='operator'>{</span>
			<span class='keyword'>break</span><span class='operator'>;</span>
		<span class='operator'>}</span>
		<span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>cout</span> <span class='operator'>&lt;&lt;</span> <span class='string'>"Imprimindo "</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>pagina</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>endl</span><span class='operator'>;</span>
	<strong><span class='operator'>}</span></strong>

	<strong><span class='symbol'>va_end</span><span class='operator'>(</span><span class='symbol'>argumentos</span><span class='operator'>)</span><span class='operator'>;</span></strong>

<strong><span class='operator'>}</span></strong>

<span class='comment lineComment'>// preciso sempre passar -1 no final como terminador</span>
<span class='comment lineComment'>// se n√£o d√° overflow e l√™ peda√ßo de mem√≥ria al√©m do que deveria</span>
<span class='symbol'>imprimirSimplesMacro</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>,</span> <span class='number'>-1</span><span class='operator'>)</span><span class='operator'>;</span>

<strong class='comment'><span class='comment lineComment'>// argumentos de todos os tipos</span></strong>

<span class='directive'>#include &lt;iostream&gt;</span>
<span class='directive'>#include &lt;boost/range/irange.hpp&gt;</span>

<span class='comment lineComment'>/// imprimirHelper template gen√©rico</span>
<span class='keyword'>template</span><span class='operator'>&lt;</span><span class='keyword'>typename</span> <span class='type'>T</span><span class='operator'>&gt;</span>
<span class='keyword'>void</span> <span class='symbol'>imprimirHelper</span><span class='operator'>(</span><span class='type'>T</span> <span class='symbol'>pagina</span><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='comment lineComment'>// poderia usar a linha abaixo para descobrir o tipo de T</span>
	<span class='comment lineComment'>// por√©m, melhor usar o template especializado</span>
	<span class='comment lineComment'>// if (std::is_same&lt;T, int&gt;::value) { /* ... */ }  // optimizable...</span>
	<span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>cout</span> <span class='operator'>&lt;&lt;</span> <span class='string'>"Imprimindo outra coisa"</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>endl</span><span class='operator'>;</span>
<span class='operator'>}</span>

<span class='comment lineComment'>/// imprimirHelper template especializado para int</span>
<span class='keyword'>template</span><span class='operator'>&lt;&gt;</span>
<span class='keyword'>void</span> <span class='symbol'>imprimirHelper</span><span class='operator'>&lt;</span><span class='type'>int</span><span class='operator'>&gt;</span><span class='operator'>(</span><span class='type'>int</span> <span class='symbol'>pagina</span><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>cout</span> <span class='operator'>&lt;&lt;</span> <span class='string'>"Imprimindo p√°gina "</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>pagina</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>endl</span><span class='operator'>;</span>
<span class='operator'>}</span>

<span class='comment lineComment'>/// imprimirHelper template especializado para boost::irange</span>
<span class='keyword'>template</span><span class='operator'>&lt;&gt;</span>
<span class='keyword'>void</span> <span class='symbol'>imprimirHelper</span><span class='operator'>&lt;</span><span class='type'>boost::irange</span><span class='operator'>&gt;</span><span class='operator'>(</span><span class='type'>boost::irange</span> <span class='symbol'>faixa</span><span class='operator'>)</span> <span class='operator'>{</span>
	<span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>cout</span> <span class='operator'>&lt;&lt;</span> <span class='string'>"Imprimindo p√°gina "</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>begin</span><span class='operator'>(</span><span class='symbol'>faixa</span><span class='operator'>)</span> <span class='operator'>&lt;&lt;</span> <span class='string'>" at√© "</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>end</span><span class='operator'>(</span><span class='symbol'>faixa</span><span class='operator'>)</span> <span class='operator'>&lt;&lt;</span> <span class='symbol'>std</span><span class='operator'>::</span><span class='symbol'>endl</span><span class='operator'>;</span>
<span class='operator'>}</span>


<span class='comment lineComment'>// foward declaration imprimir template?? N√£o estou certo da fun√ß√£o disso :/</span>
<span class='keyword'>void</span> <span class='symbol'>imprimir</span><span class='operator'>(</span><span class='type'>std::string</span> <span class='symbol'>titulo</span><span class='operator'>)</span> <span class='operator'>{}</span>

<span class='comment lineComment'>// implementa√ß√£o imprimir template</span>
<strong><span class='keyword'>template</span><span class='operator'>&lt;</span><span class='keyword'>typename</span> <span class='type'>Tipo</span><span class='operator'>,</span> <span class='keyword'>typename</span><span class='operator'>...</span> <span class='type'>Tipos</span><span class='operator'>&gt;</span></strong>
<strong class='small'><span class='keyword'>void</span> <span class='symbol'>imprimir</span><span class='operator'>(</span></strong><span class='type'>std::string</span> <span class='symbol'>titulo</span><span class='operator'>,</span> <strong class='small'><span class='type'>Tipo</span> <span class='symbol'>pagina</span><span class='operator'>,</span> <span class='type'>Tipos</span><span class='operator'>...</span> <span class='symbol'>paginas</span><span class='operator'>)</span> <span class='operator'>{</span></strong>
	<strong class='comment'><span class='comment lineComment'>// executa o helper especializado e chama recursivamente a si mesmo</span></strong>
	<span class='symbol'>imprimirHelper</span><span class='operator'>(</span><span class='symbol'>pagina</span><span class='operator'>)</span><span class='operator'>;</span>
	<span class='symbol'>imprimir</span><span class='operator'>(</span><span class='symbol'>titulo</span><span class='operator'>,</span> <span class='symbol'>paginas</span><span class='operator'>...</span><span class='operator'>)</span><span class='operator'>;</span>
<strong><span class='operator'>}</span></strong>

<span class='symbol'>imprimir</span><span class='operator'>&lt;</span><span class='type'>int</span><span class='operator'>,</span> <span class='type'>boost::irange</span><span class='operator'>,</span> <span class='type'>std::string</span><span class='operator'>&gt;</span><span class='operator'>(</span><span class='string'>"resumo"</span><span class='operator'>,</span> <span class='number'>1</span><span class='operator'>,</span> <span class='symbol'>boost::irange</span><span class='operator'>(</span><span class='number'>2</span><span class='operator'>,</span> <span class='number'>5</span><span class='operator'>)</span><span class='operator'>,</span> <span class='string'>"cap√≠tulo 2"</span><span class='operator'>)</span><span class='operator'>;</span></code
>
</div>

<p>A forma em JavaScript √© bastante parecida com a maioria. Note que n√£o existe nenhum auxilio nativo para criar ranges, como nos outros exemplos. Optei por usar um objeto simples apenas para demonstrar a sintaxe.</p>

<div class='codeblock'>
<p>fun√ß√µes vari√°dicas em JavaScript com operador rest operator</p>
<code class='javascript'
>'use strict';

// fun√ß√µes vari√°dicas em JavaScript com operador rest

<strong>// argumentos do mesmo tipo</strong>

<strong>function imprimirSimples(</strong>titulo, <strong>...paginas) {</strong>
	<strong>for (let pagina of paginas) {</strong>
		console.log(`Imprimindo p√°gina ${pagina}`);
	<strong>}</strong>
<strong>}</strong>

imprimirSimples("resumo", 1, 2, 5);

<strong>// argumentos de todos os tipos</strong>

function imprimir(titulo, <strong>...valores</strong>) {
	for (let valor of valores) {
		<strong>if</strong> (<strong>Number.isInteger(valor)</strong>) {
			console.log(`Imprimindo p√°gina ${valor}`);
		} else <strong>if</strong> (<strong>(valor.begin || valor.begin === 0)</strong>
			<strong>&amp;&amp; valor.end</strong>
			) {
			console.log(`Imprimindo p√°ginas ${valor.begin} at√© ${valor.end}`);
		} <strong>else</strong> {
			console.log('Imprimindo outra coisa');
		}
	}
}

imprimir("resumo", 1, {begin: 2, end: 5}, "cap√≠tulo 2");</code
>
</div>

<p>O operador rest tamb√©m √© √∫til quando utilizado em conjunto com <em>template strings,</em> permitindo recursos mais avan√ßados na manipula√ß√£o do <em>template</em>.</p>

<div class='codeblock'>
<p>misturando fun√ß√µes, template strings e arrays</p>
<code class='javascript'
>'use strict';

function template(strings, ...values) {

	// as strings s√£o recebidas nornalmente atrav√©s do primeiro argumento
	strings[0]; // a soma de
	strings[1]; // com
	strings[2]; // resulta em
	strings[3]; // .

	// os valores s√£o agrupados numa array atrav√©s do operador rest
	values[0]; // 1
	values[1]; // 2
	values[2]; // 3, que √© a soma de valor1 e valor2

	// √© poss√≠vel retornar qualquer coisa, string, fun√ß√£o, objeto, etc.

}

const valor1 = 1;
const valor2 = 2;

template<span style='display: none;'>+</span> `a soma de ${valor1} com ${valor2} resulta em ${valor1 + valor2}.`;</code
>
</div>

</section>



<section>

<h2 id='objetos'>Como declarar objetos <span>Se vc j√° achou as vari√°veis confusas...</span></h2>

<p>Foram feitas v√°rias tentativas at√© chegarmos a sintaxe atual para declararmos objetos. Espero que n√£o adicionem nenhuma nova sinceramente. Se vc precisar, incluo tamb√©m as antigas como refer√™ncia.</p>

<h3 id='object'>Object</h3>

<p>J√° estivemos utilizando o objeto <code class='javascript'>console</code>, que o navegador nos fornece. Al√©m disso, os tipos de vari√°veis que vimos tamb√©m s√£o objetos, pois conseguimos chamar m√©todos deles como <code class='javascript'>toFixed</code> ou <code class='javascript'>filter</code>. Ou seja, estivemos escrevendo JavaScript orientado √† objeto desde o come√ßo! Mais um motivo pra n√£o usar <code class='javascript'>alert</code>.</p>

<div class='codeblock'>
<p>c√≥digo</p>
<code class='javascript'
>console.log('console √© um objeto. log √© um m√©todo');</code
>
</div>

<p>JavaScript √© bastante diferente de outras linguagens quanto √† cria√ß√£o de objetos novos. <strong>Vamos nos ater ao b√°sico por enquanto. Declaramos um objeto usando <code class='javascript'>{}</code>. Sim, um objeto literal. N√£o √© necess√°rio criarmos uma defini√ß√£o de objeto de antem√£o</strong> (como uma <code class='generic'><span class='keyword'>class</span></code> ou <code class='generic'><span class='keyword'>struct</span></code>), criamos o objeto diretamente.</p>
<p>Acessamos as propriedades e m√©todos usando ponto, como fazemos com <code class='javascript'>console</code>. Por conveni√™ncia, tamb√©m existe a possibilidade de acess√°-las usando a <strong>nota√ß√£o de <code class='javascript'>Array</code>.</strong> Esta nota√ß√£o √© √∫til quando queremos passar o <strong>nome do campo dinamicamente.</strong></p>

<p>Propriedades pode ter atributosr <em>writable, enumerable</em> e <em>configurable</em>, indicando que podem ser escritas, que s√£o mostradas em la√ßos <code class='javascript'>for in</code> e seus atributos podem ser modificados ou n√£o, respectivamente.</p>

<p>Da maneira abaixo, todas as propriedades e m√©todos s√£o p√∫blicos. Se voc√™ mal pode esperar pra saber <a href='#proxyNativo'>como definir campos privados,</a> fique √† vontade para ir e voltar.</p>

<div class='codeblock'>
<p>declara√ß√£o de objetos com propriedades e m√©todos p√∫blicos</p>
<code class='javascript'
>'use strict';

let objetoVazio = {};

const retangulo = {

	// define os m√©todos do objeto
	area() { // nas vers√µes ES5- tinha que escrever area: function() {
		return this.largura * this.altura;
	},

	// define as propriedades e valores padr√£o
	largura: 1,
	altura: 1

};

// o objeto j√° est√° constru√≠do
// j√° podemos chamar seus m√©todos e especificar valores para suas propriedades
// todas as propriedades s√£o writable, configurable e enumerable

retangulo.largura = 2;
console.log(retangulo.altura); // mostra 1
console.log(retangulo['altura']); // nota√ß√£o de Array, mostra 1
let propriedade = 'largura';
console.log(retangulo[propriedade]); // nota√ß√£o de Array, mostra 2
console.log(retangulo.area()); // mostra 2

{}.hasOwnProperty('prototype'); // retorna true</code
>
</div>

<p>Existe tamb√©m uma <strong>sintaxe mais parecida</strong> com a de outras linguagens, utilizando a palavra-chave <code class='javascript'>class</code>, para facilitar a cria√ß√£o de objetos similares. Notem que √© uma tentativa de mostrar um ambiente mais familiar a programadores de outras linguagens, uma vez que <strong>JavaScript n√£o possui classes</strong> de verdade, seu <strong>modelo de heran√ßa √© baseado em prot√≥tipos,</strong> onde um objeto herda diretamente de outro objeto. Explico mais detalhadamente os <a href='#herancaprototipo'>problemas que isso pode trazer</a> na parte de OOP.</p>
<p>Note novamente que no exemplo abaixo os campos e m√©todos <strong>continuam sendo todos p√∫blicos.</strong></p>

<div class='codeblock'>
<p>declara√ß√£o de objetos com getters e setters</p>
<code class='javascript'
>'use strict';

class Retangulo {

	// construtor

	constructor(largura, altura) {

		// define as propriedades e seus valores iniciais
		// defineProperties nos d√° controle sobre os atributos writable, configurable e enumerable
		// se n√£o especificados, o padr√£o √© false
		Object.defineProperties(this, {
			_largura: {value: largura, writable: true},
			_altura: {value: altura, writable: true}
		});

		Object.seal(this); // mais sobre isso na parte de OOP

	}

	// m√©todos
	// diferente da sintaxe de objeto, os m√©todos aqui n√£o s√£o enumerable por padr√£o

	area() {
		return this.largura * this.altura;
	}

	// getters e setters

	get largura() {
		return this._largura;
	}

	set largura(largura) {
		this._largura = largura;
	}

	get altura() {
		return this._altura;
	}

	set altura(largura) {
		this._altura = altura;
	}

}

// cria um objeto que herda de Retangulo
const retangulo = new Retangulo(10, 20);
console.log(retangulo.largura); // mostra 10
console.log(retangulo.area()); // mostra 200
console.log(retangulo['largura']); // mostra 10</code
>
</div>


<h3 id='legacyobject'>Objetos antigos</h3>

<p>Como mencionei, JavaScript teve <strong>outras sintaxes</strong> para criar objetos, que ainda s√£o suportadas at√© hoje, por√©m <strong>n√£o mais recomendadas.</strong> A alternativa vigente antes da sintaxe de classes utilizava o m√©todo <code class='javascript'>Object.create</code>. Esta maneira de criar objetos expunha o m√©todo de heran√ßa que JavaScript usa, baseado em prot√≥tipos.</p>

<div class='codeblock'>
<p>declara√ß√£o de objetos com getters e setters</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// cria um objeto que herda de Object para servir como base
const retangulo = Object.create(Object.prototype, {

	// m√©todo qualquer usado para inicializar o objeto
	// a pr√°tica comum √© cham√†-lo de init
	// √© quase como um construtor, mas esta sintaxe n√£o necessita de construtores
	// o objeto j√° √© us√°vel antes de chamar init
	init: {
		value: function(largura, altura) {
			this.largura = largura;
			this.altura = altura;
		},
		writable: false
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	// define os m√©todos
	area: {
		value: function() {
			return this.largura * this.altura;
		},
		writable: false
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	// define os getters e setters

	largura: {
		get: function() {
			return this._largura;
		},
		set: function(largura) {
			this._largura = largura;
		}
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	altura: {
		get: function() {
			return this._altura;
		},
		set: function(altura) {
			this._altura = altura;
		}
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	// define as propriedades

	largura: {
		value: 0,
		writable: true
	},

	altura: {
		value: 0,
		writable: true
	},

});

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// cria uma inst√¢ncia de retangulo
const meuRetangulo = Object.create(retangulo);
meuRetangulo.init(10, 20);
Object.seal(meuRetangulo);

// cria outra inst√¢ncia de retangulo
const outroRetangulo = Object.create(retangulo);
outroRetangulo.init(15, 17);
Object.seal(outroRetangulo);

console.log(outroRetangulo.largura); // mostra 15
console.log(outroRetangulo.area()); // mostra 255
console.log(outroRetangulo['largura']); // mostra 17</code
>
</div>

<p>Existe <strong>ainda outra sintaxe</strong> para criar objetos, que foi a <strong>primeira disponibilizada.</strong> Ela utiliza fun√ß√µes e a palavra-chave <code class='javascript'>new</code>. Assim como com <code class='javascript'>class</code>, foi uma tentativa de n√£o causar estranheza aos programadores vindos de outras linguagens, <strong>simulando</strong> o comportamento que eles j√° estavam acostumados nas linguagens baseadas em classes. Novamente, isso <strong>escondia o verdadeiro funcionamento</strong> dos objetos em JavaScript. <a rel='external nofollow' href='http://javascript.crockford.com/'>Douglas Crockford</a>, que √© um guru e um dos redatores da linguagem <strong>n√£o recomenda</strong> a utiliza√ß√£o desta sintaxe antiga. Vou mostrar apenas a t√≠tulo de curiosidade uma das variantes da sintaxe antiga.</p>

<p>Outra desvantagem deste m√©todo √© ter que se lembrar de declarar os m√©todos no prot√≥tipo do objeto, sendo que as propriedades s√£o declaradas diretamente dentro do construtor. As sintaxes mais novas s√£o mais uniformes quanto √† isso.</p>

<div class='codeblock'>
<p>declara√ß√£o de objetos com sintaxe antiga, n√£o use!</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

const objetoVazio = new Object();

// define o objeto base
function Retangulo(largura, altura) {
	// define as propriedades e valores padr√£o
	this.largura = largura;
	this.altura = altura;
}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define os m√©todos do objeto
Retangulo.prototype.area = function() {
	return this.largura * this.altura;
};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// cria uma inst√¢ncia de retangulo
const meuRetangulo = new Retangulo(10, 20);

// cria outra inst√¢ncia de retangulo
const outroRetangulo = new Retangulo(15, 17);

console.log(outroRetangulo.largura); // mostra 15
console.log(outroRetangulo.area()); // mostra 255
console.log(outroRetangulo['largura']); // mostra 17</code
>
</div>

<h3 id='for'>Os muitos la√ßos for</h3>

<p>Al√©m do la√ßo <code class='javascript'>for</code> cl√°ssico presente em outras linguagens, existem duas outras formas de itera√ß√£o r√°pida pelas propriedades de um objeto. A mais recente delas, <code class='javascript'>for of</code> funciona de maneira similar ao <code class='generic'><span class='keyword'>foreach</span></code> ou <code class='generic'><span class='keyword'>for</span> <span class='operator'>:</span></code> de outras linguagens. Ele ir√° iterar pelos √≠ndices de uma <code>Array</code> ou pelas propriedades expostas por um objeto que implemente <code class='javascript'>[Symbol.iterator]</code>.Estas s√£o as duas maneiras recomendadas de realizar este tipo de itera√ß√£o.</p>

<div class='codeblock'>
<p>tipos de la√ßos for</p>
<code class='javascript'
>'use strict';

const lala = [1, 2, 486];

// nova, tamb√©m suporta <a href='#generator'>iterators</a>
<strong>for</strong> (let propriedade <strong>of</strong> lala) {
	// 1, 2, 486
}

// cl√°ssica manual
<strong>for</strong> (<strong>let i = 0; i &lt; lala.length; i++</strong>) {
	// 1, 2, 486
}</code
>
</div>

<p>A outra forma, intermedi√°ria, possui comportamento mais complexo e inconsistente, e portanto n√£o se tornou muito popular. Ela itera n√£o s√≥ pelos √≠ndices da <code class='javascript'>Array</code>, mas tamb√©m pelas propriedades dela e de seus prot√≥tipos. Para evitar este comportamento indesejado, √© necess√°rio incluir uma verificac√£o extra dentro do la√ßo. Por√©m, a ordem de itera√ß√£o n√£o √© garantida, e n√£o h√° meios de reparar isso.</p>

<div class='codeblock'>
<p>tipos de la√ßos for</p>
<code class='javascript'
>'use strict';

const lala = [1, 2, 486];

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!</strong>

// zoada
<strong>for</strong> (let propriedade <strong>in</strong> lala) {
	<strong>if</strong> (lala<strong>.hasOwnProperty</strong>(propriedade)) {
		// qualquer ordem √© v√°lida segundo a especifica√ß√£o
	}
}</code
>
</div>

<p>As <em>arrays</em> contam ainda com mais uma op√ß√£o, que √© o m√©todo <code class='javascript'>forEach</code>, e que pode estar presente mesmo em navegadores que n√£o suportam <code class='javascript'>for of</code>. A desvantagem dessa abordagem √© que a itera√ß√£o n√£o pode ser interrompida pela instru√ß√£o <code class='javascript'>break</code>.</p>

<div class='codeblock'>
<p>tipos de la√ßos for</p>
<code class='javascript'
>'use strict';

const lala = [1, 2, 486];

lala<strong>.forEach((currentValue, index, array) => {</strong>
	// 1, 2, 486
	// sem a possibilidade de usar break :(
<strong>});</strong></code
>
</div>

</section>



<section>

<h2>Ado, a ado, cada um no seu quadrado</h2>

<p>Quando eu escrevi esse t√≠tulo originalmente, era come√ßo de 2014 e essa m√∫sica era menos trash, mas n√£o muito :P</p>

<h3 id='escopo'>Escopo das vari√°veis</h3>

<p>L√° no come√ßo disse que haviam duas maneiras de declarar uma vari√°vel, a mais recente, usando <code class='javascript'>let</code> e a mais antiga usando <code class='javascript'>var</code>. Agora √© o momento de vermos suas diferen√ßas, as pegadinhas e boas pr√°ticas.</p>

<p><strong>Dependendo da palavra-chave</strong> que voc√™ utiliza, a vari√°vel obedecer√° <strong>regras de escopo diferentes</strong>. N√£o conhe√ßo nenhuma outra linguagem que tenha essa caracter√≠stica. O motivo disto ter sido feito desta maneira em JavaScript √© que a introdu√ß√£o de <code class='javascript'>let</code> foi um puxadinho feito depois na linguagem, para n√£o quebrar a compatibilidade com c√≥digos j√° existentes que utilizavam <code class='javascript'>var</code>.

<p>Primeiro, o comportamento de <code class='javascript'>let</code>.</p>

<div class='codeblock'>
<p>escopo de vari√°veis let</p>
<code class='javascript'
>'use strict';

let todosVe = '\o/';
let i = 0;

for (i = 0; i &lt; 5; i++) {
	//
}

console.log(i); // 5

<strong>for (let dentroDoFor</strong> = 0; dentroDoFor &lt; 7; dentroDoFor++<strong>)</strong> {
	//
}

console.<strong>log(dentroDoFor);</strong> <strong>// ReferenceError, dentroDoFor n√£o est√° definido</strong>

<strong>if</strong> (i &gt; 0) <strong>{</strong>
	<strong>let dentroDoIf</strong> = true;
<strong>}</strong>

console.<strong>log(dentroDoIf);</strong> <strong>// ReferenceError, dentroDoIf n√£o est√° definido</strong></code
>
</div>

<p>Nada de muito extraordin√°rio aqui certo? O comportamento √© <strong>similar ao de outras linguagens.</strong> Mas <code class='javascript'>let</code> <strong>nem sempre esteve dispon√≠vel</strong> nos navegadores, ent√£o precisamos ver a alternativa legada.</p>

<p>Para <code class='javascript'>var</code>, o <strong>√∫nico</strong> delimitador de escopo √© a fun√ß√£o. Vari√°veis fora de fun√ß√µes est√£o no espa√ßo global, e vari√°veis declaradas em <strong>blocos <code class='javascript'>script</code> ou arquivos diferentes compartilham o mesmo espa√ßo global.</strong> Isso foi feito assim porque o programador original da linguagem n√£o tinha tempo de fazer um <em>linker</em>.</p>

<div class='codeblock'>
<p>escopo de vari√°veis var</p>
<code class='javascript'
>'use strict';

var todosVe = '\o/';
var i = 0;

for (i = 0; i &lt; 5; i++) {
	//
}

console.log(i); // 5

<strong>for (var dentroDoFor</strong> = 0; dentroDoFor &lt; 7; dentroDoFor++<strong>)</strong> {
	//
}

console.<strong>log(dentroDoFor);</strong> <strong>// 7. Surpresa. dentroDoFor foi declarado no espa√ßo global.</strong>

<strong>if</strong> (i &gt; 0) <strong>{</strong>
	<strong>var dentroDoIf</strong> = true;
<strong>}</strong>

console.<strong>log(dentroDoIf);</strong> <strong>// true. Mais surpresa.</strong></code
>
</div>

<p>Este √© <strong>um dos motivos</strong> pelos quais declaramos todas as var√≠aveis no <strong>topo do arquivo ou no come√ßo da fun√ß√£o.</strong> De qualquer maneira, vamos ver como resolver parte desse problema quando abordarmos <a href='#closures'><em>closures</em></a>.</p>

<h3 id='hoisting'>Variable Hoisting</h3>

<p>Outro motivo para se <strong>declarar as vari√°veis no come√ßo do escopo</strong> √© uma caracter√≠stica do compilador JavaScript, chamada <em>variable hoisting</em>.</p>
<p>O que isso significa √© que, <strong>apenas para vari√°veis declaradas com <code class='javascript'>var</code></strong>,<strong>independente</strong> de onde voc√™ declarar sua vari√°vel, o compilador vai <strong>mover a declara√ß√£o de forma transparente</strong> para o topo do escopo e deix√°-la com valor <code class='javascript'>undefined</code>. A linha onde um valor √© atribu√≠do √† vari√°vel n√£o √© afetada. Isso pode causar problemas se o c√≥digo depender de uma verifica√ß√£o da exist√™ncia da vari√°vel. Isso n√£o ocorre para vari√°veis declaradas com <code class='javascript'>let</code>.</p>

<div class='codeblock'>
<p>variable hoisting</p>
<code class='javascript'
>'use strict';

// o que vc escreveu

console.log(estranha); // mostra undefined e continua normalmente
var estranha = 11;
console.log(estranha); // mostra 11</code
>
</div>

<p>Ou seja, o que o compilador vai fazer de modo transparente √©:</p>

<div class='codeblock'>
<p>variable hoisting explicado</p>
<code class='javascript'
>'use strict';

// o que o compilador v√™

var estranha; // o compilador moveu a declarac√£o que usa var (let n√£o √© afetado), para o topo do arquivo
console.log(estranha);
estranha = 11; // e manteve a atribu√ß√£o do valor na mesma linha
console.log(estranha);</code
>
</div>

<h3 id='funcaoanonimaescopo'>M√≥dulos simples</h3>

<p>Se quisermos evitar poluir o espa√ßo global, temos que usar uma <strong>fun√ß√£o an√¥nima (lambda) autoexecut√°vel</strong>. Projetos de aplicativos windows 8 escritos em JavaScript j√° utilizam por padr√£o esse procedimento.</p>

<p>Vamos ver primeiramente um exemplo em que nada entra nem sai do escopo, pois √© mais simples de entender.</p>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel definindo escopo</p>
<code class='javascript'
>(() =&gt; {
	var segredo = '******';
})();
console.log(segredo); // lan√ßa exce√ß√£o

// ou

(function(){
	var segredo = '******';
})();
console.log(segredo); // undefined em navegadores mais antigos ou lan√ßa exce√ß√£o se modo estrito ou em navegadores novos</code
>
</div>

<p>Para memorizar isso eu geralmente escrevo assim:</p>

<p>Declaro a fun√ß√£o.</p>
<div class='codeblock'>
<code class='javascript'
><strong>() =&gt; {</strong> /**/ <strong>}</strong>
// ou
<strong>function(){</strong> /**/ <strong>}</strong></code
>
</div>

<p>Transformo ela em express√£o como vimos l√° na parte sobre fun√ß√µes.</p>
<div class='codeblock'>
<code class='javascript'
><strong>(</strong> () =&gt; { /**/ } <strong>)</strong>;
// ou
<strong>(</strong> function(){ /**/ } <strong>)</strong>;</code
>
</div>

<p>Executo ela.</p>
<div class='codeblock'>
<code class='javascript'
>(() =&gt; { /**/ })<strong>();</strong>
// ou
(function(){ /**/ })<strong>();</strong></code
>
</div>

<h3 id='closures'>Closures</h3>

<p>Resumidamente, uma <em>closure</em> √© uma fun√ß√£o mais seu contexto, isto √©, as vari√°veis que ela consegue acessar (ou captura se voc√™ preferir) presentes no escopo em que ela foi criada. Essa defini√ß√£o n√£o diz muito sobre as consequ√™ncias dessa funcionalidade, ent√£o vamos desenvolver essa ideia em c√≥digo em algumas etapas.</p>

<h4>Colocando coisas dentro do escopo e <em>type aliasing</em></h4>

<p>Estamos prontos para complicar um pouquinho mais os exemplos de m√≥dulos simples acima, <strong>passando valores para dentro do escopo.</strong> √â bem comum fazer isso em conjunto com jQuery. Note que esse padr√£o tamb√©m permite que n√≥s habilitemos o modo estrito num determinado escopo.</p>

<p>Mas para n√£o no embolarmos na sintaxe necess√°ria para isso, que quase lembra Lisp, vamos fazer antes um pequeno exerc√≠cio mental antes sobre fun√ß√µes e nomes de par√¢metros.</p>

<div class='codeblock'>
<p>nomes de par√¢metros</p>
<code class='javascript'
>'use strict';

// a fun√ß√£o "mostrar" n√£o conhece os nomes das vari√°veis que s√£o passadas para ela
// tudo o que ela sabe √© que ela pode acess√°-los genericamente chamando-os de "numero"
function mostrar(numero) {
	console.log(numero);
}

const um = 1;
const dois = 2;
const tres = 3;

// ou seja, as vari√°veis "um", "dois" e "tres" s√£o referenciadas temporariamente
// como "numero" na execu√ß√£o da fun√ß√£o, como consequ√™ncia do funcionamento normal
// da programa√ß√£o que escrevemos
mostrar(um);
mostrar(dois);
mostrar(tres);</code
>
</div>

<p>Este ocorrido da mudan√ßa de nomes possui um segundo uso menos frequente, que √© o de podermos atribuir <em>aliases</em> (outros nomes) √†s nossas vari√°veis. De maneira gen√©rica, temos:</p>

<div class='codeblock'>
<p>nomes de par√¢metros</p>
<code class='javascript'
>'use strict';

function cabineTelefonica(superHomem) {
	// superHomem √© o nome que damos ao par√¢metro passado para esta fun√ß√£o
	// se chamarmos esta fun√ß√£o passando clarkKent como par√¢metro
	// dentro dela podemos chamar clarkKent pelo nome de superHomem
	// referenciamos o mesmo objeto por dois nomes distintos
}

let clarkKent = '\o/';

cabineTelefonica(clarkKent);</code
>
</div>

<p>Estamos acostumados a fazer isso frequentemente quando programamos com a sintaxe acima. Outra maneira seria usando a sintaxe de flecha.</p>

<div class='codeblock'>
<p>nomes de par√¢metros</p>
<code class='javascript'
>'use strict';

const cabineTelefonica = (superHomem) => {
	// mesma coisa que o exemplo acima, por√©m usando a sintaxe de flecha
};

let clarkKent = '\o/';

cabineTelefonica(clarkKent);</code
>
</div>

<p>E finalmente, usando uma fun√ß√£o an√¥nima autoexecut√°vel.</p>

<div class='codeblock'>
<p>nomes de par√¢metros</p>
<code class='javascript'
>'use strict';

let clarkKent = '\o/';

((superHomem) => {
	// mesma coisa que os exemplos anteriores
	// chamamos esta fun√ß√£o passando clarkKent como par√¢metro
	// e chamamos esse par√¢metro de superHomem enquanto estivermos dentro do escopo da fun√ß√£o
})(clarkKent);</code
>
</div>

<p>Vejamos ent√£o o exemplo completo envolvendo jQuery.</p>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel com par√¢metros</p>
<code class='javascript'
><strong>// noConflict() determina que n√£o vamos usar jQuery com $ globalmente</strong>
<strong>// vamos referenci√°-los apenas por jQuery para evitar colis√µes com outras</strong>
<strong>// bibliotecas que eventualmente usem $ tamb√©m</strong>
<strong class='small'>jQuery.noConflict();</strong>

// criamos um escopo atrav√©s de um lambda
// indicamos que esse lambda vai receber um par√¢metro, e que vamos cham√°-lo de $
(($) =&gt; {
	'use strict'; // habilita modo estrito s√≥ para este escopo

	// podemos usar jQuery como $ aqui dentro sem interferir com o espa√ßo global que continua usando jQuery
	$('body').html('&lt;p&gt;padr√£o para plug-ins jQuery&lt;/p&gt;');

})(jQuery); // executamos o lambda, passando jQuery como par√¢metro

console.log($); // ReferenceError, $ est√° definido apenas dentro do escopo definido pelo lambda</code
>
</div>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel com par√¢metros</p>
<code class='javascript'
>// noConflict() determina que n√£o vamos usar jQuery com $ globalmente
// vamos referenci√°-los apenas por jQuery para evitar colis√µes com outras
// bibliotecas que eventualmente usem $ tamb√©m
jQuery.noConflict();

<strong>// criamos um escopo atrav√©s de um lambda</strong>
<strong>// indicamos que esse lambda vai receber um par√¢metro, e que vamos cham√°-lo de $</strong>
<strong class='small'>(($) =&gt; {</strong>
	'use strict'; // habilita modo estrito s√≥ para este escopo

	// podemos usar jQuery como $ aqui dentro sem interferir com o espa√ßo global que continua usando jQuery
	$('body').html('&lt;p&gt;padr√£o para plug-ins jQuery&lt;/p&gt;');

<strong>})</strong>(jQuery); // executamos o lambda, passando jQuery como par√¢metro

console.log($); // ReferenceError, $ est√° definido apenas dentro do escopo definido pelo lambda</code
>
</div>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel com par√¢metros</p>
<code class='javascript'
>// noConflict() determina que n√£o vamos usar jQuery com $ globalmente
// vamos referenci√°-los apenas por jQuery para evitar colis√µes com outras
// bibliotecas que eventualmente usem $ tamb√©m
jQuery.noConflict();

// criamos um escopo atrav√©s de um lambda
// indicamos que esse lambda vai receber um par√¢metro, e que vamos cham√°-lo de $
(($) =&gt; {
	'use strict'; // habilita modo estrito s√≥ para este escopo

	// podemos usar jQuery como $ aqui dentro sem interferir com o espa√ßo global que continua usando jQuery
	$('body').html('&lt;p&gt;padr√£o para plug-ins jQuery&lt;/p&gt;');

})<strong>(jQuery);</strong> <strong>// executamos o lambda, passando jQuery como par√¢metro</strong>

console.log($); // ReferenceError, $ est√° definido apenas dentro do escopo definido pelo lambda</code
>
</div>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel com par√¢metros</p>
<code class='javascript'
>// noConflict() determina que n√£o vamos usar jQuery com $ globalmente
// vamos referenci√°-los apenas por jQuery para evitar colis√µes com outras
// bibliotecas que eventualmente usem $ tamb√©m
jQuery.noConflict();

// criamos um escopo atrav√©s de um lambda
// indicamos que esse lambda vai receber um par√¢metro, e que vamos cham√°-lo de $
(<strong>($)</strong> =&gt; {
	'use strict'; // habilita modo estrito s√≥ para este escopo

	<strong>// podemos usar jQuery como $ aqui dentro sem interferir com o espa√ßo global que continua usando jQuery</strong>
	<strong class='small'>$('body').html('&lt;p&gt;padr√£o para plug-ins jQuery&lt;/p&gt;');</strong>

})<strong>(jQuery);</strong> // executamos o lambda, passando jQuery como par√¢metro

console.log($); // ReferenceError, $ est√° definido apenas dentro do escopo definido pelo lambda</code
>
</div>

<div class='codeblock'>
<p>fun√ß√£o an√¥nima autoexecut√°vel com par√¢metros</p>
<code class='javascript'
>// noConflict() determina que n√£o vamos usar jQuery com $ globalmente
// vamos referenci√°-los apenas por jQuery para evitar colis√µes com outras
// bibliotecas que eventualmente usem $ tamb√©m
jQuery.noConflict();

// criamos um escopo atrav√©s de um lambda
// indicamos que esse lambda vai receber um par√¢metro, e que vamos cham√°-lo de $
(($) =&gt; {
	'use strict'; // habilita modo estrito s√≥ para este escopo

	// podemos usar jQuery como $ aqui dentro sem interferir com o espa√ßo global que continua usando jQuery
	$('body').html('&lt;p&gt;padr√£o para plug-ins jQuery&lt;/p&gt;');

})(jQuery); // executamos o lambda, passando jQuery como par√¢metro

<strong>console.log($);</strong> <strong>// ReferenceError, $ est√° definido apenas dentro do escopo definido pelo lambda</strong></code
>
</div>

<h4 id='forclosure'>Resolvendo var e corrigindo closures</h4>

<p>Quando passamos objetos para as fun√ß√µes que queremos executar fun√ß√µes, estes objetos s√£o passados por refer√™ncia. Se passarmos tipos simples como <code class='javascript'>Boolean</code> e <code class='javascript'>Number</code>, eles ser√£o <strong>passados por valor.</strong> Isto √©, teremos uma <strong>c√≥pia do valor passado.</strong></p>

<p>Este comportamento costuma ser usado para <strong>resolver problemas que o comportamento de <code class='javascript'>var</code> causa em la√ßos</strong> e outras situa√ß√µes. Por exemplo, vamos revisitar este trecho problem√°tico de c√≥digo:</p>

<div class='codeblock'>
<p>escopo de vari√°veis var</p>
<code class='javascript'
>'use strict';

for (var dentroDoFor = 0; dentroDoFor &lt; 7; dentroDoFor++) {
	// executa console.log daqui 100 milissegundos, depois que o la√ßo terminou
	setTimeout(() => { console.log(dentroDoFor); }, 100); // sempre vai ser 7. dentroDoFor foi declarado no espa√ßo global
}

console.log(dentroDoFor); // 7. Surpresa. dentroDoFor foi declarado no espa√ßo global.</code
>
</div>

<p>Neste caso, <strong>criamos inadvertidamente uma <em>closure</em>.</strong> O lambda que passamos para a fun√ß√£o <code class='javascript'>setTimeout</code> tamb√©m √© uma fun√ß√£o, e seu contexto de cria√ß√£o √© tudo o que est√° no espa√ßo global. Portanto ela captura a vari√°vel global <code class='javascript'>dentroDoFor</code>, e a encherga com seu valor atual 7 quando executada.</p>

<p>Caso estejamos num navegador em que seja poss√≠vel usar <code class='javascript'>let</code>, a corre√ß√£o √© bastante simples, pois o uso desta palavra-chave restringe  o escopo de <code class='javascript'>dentroDoFor</code> para cada itera√ß√£o do la√ßo.</p>

<div class='codeblock'>
<p>escopo de vari√°veis var</p>
<code class='javascript'
>'use strict';

for (<strong>let dentroDoFor = 0;</strong> dentroDoFor &lt; 7; dentroDoFor++) {
	// executa console.log daqui 100 milissegundos, depois que o la√ßo terminou
	<strong>setTimeout(() => { console.log(dentroDoFor); }, 100);</strong> <strong>// 0, 1, 2... 6 como desejado</strong>
}

console.log(dentroDoFor); // 7. Surpresa. dentroDoFor foi declarado no espa√ßo global.</code
>
</div>

<p>Caso o navegador seja mais antigo e n√£o seja poss√≠vel o uso de <code class='javascript'>let</code>, ainda podemos corrigir o comportamento indesejado por meio de uma <em>closure</em> da seguinte maneira:</p>

<div class='codeblock'>
<p>resolvendo problemas de escopo de var com closures</p>
<code class='javascript'
>'use strict';

<strong>// dentroDoFor √© passado por valor para o escopo que a fun√ß√£o forBody cria</strong>
<strong>// ou seja, o escopo recebe uma c√≥pia no momento em que a fun√ß√£o foi chamada dentro do la√ßo</strong>
<strong>// dentroDoFor local ofusca dentroDoFor global</strong>
<strong class='small'>function forBody(dentroDoFor) {</strong>
	// executa console.log daqui 100 milissegundos, depois que o la√ßo terminou
	<strong>setTimeout(() => { console.log(dentroDoFor); }, 100);</strong> <strong>// 0, 1, 2... 6 como desejado</strong>
<strong>}</strong>

var i = 0;

<strong>for (</strong>i = 0; i &lt; 8; i++<strong>) {</strong>
	<strong>forBody(i);</strong>
<strong>}</strong>

console.log(i); // ainda √© 7, pois i foi declarado no espa√ßo global.
console.log(dentroDoFor); // ReferenceError, dentroDoFor s√≥ existe dentro da fun√ß√£o forBody</code
>
</div>

<p>O lambda <strong>continua sendo uma closure, mas agora encherga apenas a c√≥pia local da vari√°vel <code class='javascript'>dentroDoFor</code>, pois a <strong>vari√°vel global foi obfuscada</strong> por utilizar o mesmo nome da local, que tem maior prioridade.</strong> A vari√°vel local nunca √© incrementada, e o lambda ent√£o, se comporta como o esperado.</p>

<p>N√£o √© necess√°rio ofuscar a vari√°vel global utilizando o mesmo nome para a vari√°vel local. Poder√≠amos utilizar um nome distinto, desde que garant√≠ssemos que sempre referenciar a vari√°vel local pelo nome distinto que escolhemos. Por√©m, usar o mesmo ajuda a evitar erros.</p>

<h4>Tirando coisas de dentro do escopo</h4>

<p>Agora que vimos o que s√£o closures, vamos aprender mais uma coisa sobre elas. <strong>Se elas forem movidas para fora do seu contexto de cria√ß√£o, permanecem com a habilidade de acessar as vari√°veis e fun√ß√µes do escopo original.</strong></p>

<div class='codeblock'>
<p>closures</p>
<code class='javascript'
>'use strict';

// cria um escopo
function externa() {

	let informacao = 'wikileaks';

	let interna = function() {
		console.log('vazou ' + informacao);
	}

	return interna; // exp√µe a fun√ß√£o para fora do escopo

}

let dedoDuroInterno = externa(); // dedoDuroInterno √© igual √† fun√ß√£o retornada do escopo, √© um alias para ela
dedoDuroInterno(); // exp√µes os segredos dentro do escopo!</code
>
</div>

<p>Essa sintaxe √© √≥tima para ser utilizada com o padr√£o <em>facade</em>. Ou seja:</p>

<div class='codeblock'>
<p>padr√£o de projeto facade</p>
<code class='javascript'
>'use strict';

function facade() {
	// criar tudo o que n√£o deve ser acessado diretamente de fora do escopo aqui
	// retornar o objeto ou fun√ß√£o que tem permiss√£o para acessar o escopo
	return function() {
		//
	};
}

let acesso = facade();</code
>
</div>

<p>E mais resumidamente, usando o m√≥dulo simples que vimos anteriormente:</p>

<div class='codeblock'>
<p>padr√£o de projeto facade</p>
<code class='javascript'
>'use strict';

let acesso = (function() {
	// criamos tudo o que n√£o deve ser acessado diretamente de fora do escopo aqui
	// retornamos o objeto ou fun√ß√£o que tem permiss√£o para acessar o escopo
	// sim, fun√ß√µes an√¥nimas autoexecut√°veis podem retornar valores!
	return {};
})();

// ou

let acesso = (() => {
	// mesma coisa que a alternativa acima ;)
	return {};
})();</code
>
</div>

<p>Recapitulando, uma <em>closure</em> √© uma fun√ß√£o mais o contexto em que foi criada, isto √©, as vari√°veis que ela consegue acessar (ou capturar se voc√™ preferir). No caso do problema com o la√ßo <code class='javascript'>for</code>, criamos uma <em>closure</em> sem querer, e ent√£o precisamos adicionar uma fun√ß√£o a mais para resolver o problema que a <em>closure</em> criou. No caso padr√£o <em>facade</em> criamos uma <em>closure</em> propositalmente e movemos ela para fora do seu contexto, mantendo o restande dele  privado, podendo ser acessado apenas atrav√©s da <em>closure</em>.</p>

<h3>Os <q>m√≥dulos</q> do jQuery</h3>

<p>O framework jQuery mistura v√°rios dos conceitos apresentados aqui. Ainda n√£o apresentei o conceito de eventos para entendermos todas as partes do jQuery, mas podemos identificar os j√° vistos no c√≥digo abaixo.</p>

<div class='codeblock'>
<p>uso simples de jQuery</p>
<code class='javascript'
>'use strict';

jQuery(document).ready((evento) => {
	// escopo isolado, n√£o polui o espa√ßo global
});</code
>
</div>

<p>O primeiro dos conceitos utilizados √© que jQuery √© uma fun√ß√£o. Por isso podemos cham√°-la utilizando <code class='javascript'>jQuery()</code>. Esta fun√ß√£o sempre retorna uma refer√™ncia para ela mesma, ou seja, sempre retorna <code class='javascript'>jQuery</code>. Esta organiza√ß√£o de c√≥digo se chama interface fluida. O m√©todo recebe como par√¢metro um seletor <abbr title='Cascading Style Sheets'>CSS</abbr> ou objeto do <abbr title='Document Object Model'>DOM</abbr>, neste caso o objeto <code class='javascript'>document</code>.</p>

<div class='codeblock'>
<code class='javascript'
><strong>jQuery(document)</strong>.ready((evento) => {
	// escopo isolado, n√£o polui o espa√ßo global
});</code
>
</div>

<p>A seguir temos o m√©todo <code class='javascript'>ready</code>, que √© chamado quando o evento correspondente √© disparado. Por enquanto basta saber que este m√©todo s√≥ ser√° chamado quando a p√°gina estiver pronta para manipula√ß√£o por JavaScript. Nem tudo que usamos em JavaScript precisa ser colocado dentro deste m√©todo. Apenas a parte que ir√° interagir imediatamente com o DOM. Por exemplo, podemos definir nossas bibliotecas anteriormente num outro local, e s√≥ cham√°-las dentro de <code class='javascript'>ready</code> quando elas precisarem interagir com o DOM. O motivo disso √© performance.</p>

<div class='codeblock'>
<code class='javascript'
>jQuery(document)<strong>.ready(</strong>(evento) => {
	// escopo isolado, n√£o polui o espa√ßo global
}<strong>);</strong></code
>
</div>

<p>Mas se <code class='javascript'>jQuery()</code> sempre retorna outra fun√ß√£o <code class='javascript'>jQuery</code>, como acessamos o m√©todo <code class='javascript'>ready</code>? Lembre-se em JavaScript fun√ß√µes s√£o objetos, e portanto podem ter propriedades e outros m√©todos, como o <code class='javascript'>ready</code>.</p>

<p>Por √∫ltimo, passamos ao m√©todo <code class='javascript'>ready</code> uma <strong>fun√ß√£o an√¥nima</strong> que cont√©m o c√≥digo que queremos executar. Esta sintaxe <strong>reduz</strong> a quantidade de vari√°veis e m√©todos no <strong>espa√ßo global.</strong></p>

<div class='codeblock'>
<code class='javascript'
>jQuery(document).ready(<strong class='small'>(evento) => {</strong>
	<strong>// escopo isolado, n√£o polui o espa√ßo global</strong>
<strong>}</strong>);</code
>
</div>

<h3 id='amd'>M√≥dulos avan√ßados - Padr√£o AMD</h3>

<p>Como JavaScript escrito sem cuidado pode poluir rapidamente o espa√ßo global, devemos procurar maneiras de evitar a sobrescrita de vari√°veis. O framework <strong>jQuery pode n√£o ser uma boa alternativa</strong> para uma quantidade maior de c√≥digo, uma vez que <strong>sempre carrega todos seus <em>plug-ins</em> na mem√≥ria,</strong> mesmo o que n√£o estiver usando.</p>

<p>Vimos que <strong>fun√ß√µes podem ser usadas para criar escopos nomeados e an√¥nimos,</strong> como nos exemplos de express√µes de fun√ß√£o e do la√ßo e <code class='javascript'>var</code>, e que essas <strong><q>fun√ß√µes escopo</q> podem receber e retornar valores.</strong> Essas s√£o as bases para chegarmos ao que queremos.</p>

<p>Como os <strong>recursos da linguagem s√£o poucos</strong> para uma organiza√ß√£o mais efetiva do c√≥digo, foi criado um <strong>padr√£o mais bem acabadinho, amplamente utilizado, inclusive em diversos frameworks, chamado <abbr title='Asynchronous Module Definition'>AMD</abbr>.</strong> Caso voc√™ n√£o esteja usando um framework que j√° possua suporte (como Angular ou Ember), √© poss√≠vel baixar uma biblioteca exclusivamente para isso, chamada <a href='http://requirejs.org/' rel='external nofollow'>RequireJS</a>. Esse padr√£o √© utilizado atrav√©s de uma fun√ß√£o, chamada <code class='javascript'>define</code>, que pode ser utilizada da seguinte maneira:</p>

<div class='codeblock'>
<p>Padr√£o AMD para defini√ß√£o de escopo</p>
<code class='javascript'
>'use strict';

define('nomeDoModulo', () =&gt; {
	// escopo isolado, n√£o polui o espa√ßo global
	// retornar aqui o valor do m√≥dulo
	// isto √©, a classe, objeto, fun√ß√£o etc.
	// que poder√° ser acessada pelo identificador 'nomeDoModulo'
});

define('nomeOpcional', ['nomeDoModulo', 'dependencia2', 'etc'], (nomeDoModulo, dependencia2, etc) =&gt; {
	// escopo isolado, n√£o polui o espa√ßo global
	// podemos utilizar as depend√™ncias importadas
});</code
>
</div>

<p>Ou seja, se quisermos criar objetos que possam ser reaproveitados apenas em determinados escopos, fazemos da seguinte maneira:</p>

<div class='codeblock'>
<p>Isolando depend√™ncias com AMD</p>
<code class='javascript'
>'use strict';

// cria a classe num escopo isolado
define('MinhaClasse', () =&gt; {

	const MinhaClasse = class MinhaClasse() {
		constructor() { /**/ }
	}

	// lembre-se de sempre retornar um valor do m√≥dulo, para que ele seja associado ao identificador
	return MinhaClasse;

});

// cria a fun√ß√£o num escopo isolado
define('minhaFuncao', () => {
	const minhaFuncao = function() { /**/ };
	return minhaFuncao;
});

// utiliza a classe importada, optei por n√£o nomear esse m√≥dulo
define(['MinhaClasse'], (MinhaClasse) => {
	const meuObjeto = new MinhaClasse(); // Ok
	minhaFuncao(); // Erro, pois n√£o importamos minhaFun√ß√£o
});</code
>
</div>

<p>A primeira vista isso tudo pode assustar, ent√£o vamos ver passo a passo. O m√©todo <code class='javascript'>define</code> associa escopos com identificadores.</p>

<div class='codeblock'>
<p>Isolando depend√™ncias com AMD</p>
<code class='javascript'
>'use strict';

// cria a classe num escopo isolado
<strong>define('MinhaClasse', () =&gt; {</strong>

	const MinhaClasse = class MinhaClasse() {
		constructor() { /**/ }
	}

	// lembre-se de sempre retornar um valor do m√≥dulo, para que ele seja associado ao identificador
	return MinhaClasse;

<strong>});</strong>

// cria a fun√ß√£o num escopo isolado
<strong>define('minhaFuncao', () => {</strong>
	const minhaFuncao = function() { /**/ };
	return minhaFuncao;
<strong>});</strong>

// utiliza a classe importada, optei por n√£o nomear esse m√≥dulo
define(['MinhaClasse'], (MinhaClasse) => {
	const meuObjeto = new MinhaClasse(); // Ok
	minhaFuncao(); // Erro, pois n√£o importamos minhaFun√ß√£o
});</code
>
</div>

<p>Retornando valores dentro destes escopos, podemos associ√°-los ao identificador do escopo.</p>

<div class='codeblock'>
<p>Isolando depend√™ncias com AMD</p>
<code class='javascript'
>'use strict';

// cria a classe num escopo isolado
define('MinhaClasse', <strong>() =&gt; {</strong>

	const MinhaClasse = class MinhaClasse() {
		constructor() { /**/ }
	}

	// lembre-se de sempre retornar um valor do m√≥dulo, para que ele seja associado ao identificador
	<strong>return MinhaClasse;</strong>

<strong>}</strong>);

// cria a fun√ß√£o num escopo isolado
define('minhaFuncao', <strong>() => {</strong>
	const minhaFuncao = function() { /**/ };
	<strong>return minhaFuncao;</strong>
<strong>}</strong>);

// utiliza a classe importada, optei por n√£o nomear esse m√≥dulo
define(['MinhaClasse'], (MinhaClasse) => {
	const meuObjeto = new MinhaClasse(); // Ok
	minhaFuncao(); // Erro, pois n√£o importamos minhaFun√ß√£o
});</code
>
</div>

<p>E ent√£o podemos importar estes valores atrav√©s dos identificadores.</p>

<div class='codeblock'>
<p>Isolando depend√™ncias com AMD</p>
<code class='javascript'
>'use strict';

// cria a classe num escopo isolado
define('MinhaClasse', () =&gt; {

	const MinhaClasse = class MinhaClasse() {
		constructor() { /**/ }
	}

	// lembre-se de sempre retornar um valor do m√≥dulo, para que ele seja associado ao identificador
	return MinhaClasse;

});

// cria a fun√ß√£o num escopo isolado
define('minhaFuncao', () => {
	const minhaFuncao = function() { /**/ };
	return minhaFuncao;
});

// utiliza a classe importada, optei por n√£o nomear esse m√≥dulo
<strong>define(['MinhaClasse'], (MinhaClasse) => {</strong>
	const meuObjeto = <strong>new MinhaClasse();</strong>// Ok
	minhaFuncao(); // Erro, pois n√£o importamos minhaFun√ß√£o
<strong>});</strong></code
>
</div>

<p>O padr√£o <abbr title='Asynchronous Module Definition'>AMD</abbr> foi formulado para suportar minifica√ß√£o do c√≥digo fonte, e portanto acaba sendo um pouco redundante.</p>

</section>



<section>

<h2 id='dom'><abbr title='Document Object Model'>DOM</abbr> - El Poderoso Jef√≥n</h2>

<p>Se voc√™ leu o cap√≠tulo anterior (e deveria), pode ter visto que o IE10- lan√ßou um erro em nosso exemplo simples, quando as ferramentas de desenvolvimento n√£o estavam abertas. Isso ocorre porque nestes navegadores, o objeto <code class='javascript'>console</code>, pertencente ao DOM, n√£o √© acess√≠vel pelo JavaScript enquanto as ferramentas n√£o estiverem abertas. Vou mostrar mais adiante como corrigir esta <q>funcionalidade</q> do IE10-.</p>

<p>Embora por caminhos tortos, isso nos ensina um conceito importante. O conceito de que <strong>JavaScript e o <abbr title='Document Object Model'>DOM</abbr> s√£o mundos diferentes,</strong> e nem sempre JavaScript consegue acessar tudo do <abbr title='Document Object Model'>DOM</abbr> a toda a hora. Existem <strong>momentos espec√≠ficos em que isso pode ser feito.</strong></p>

<p>Vamos ver isso e outros conceitos com um segundo exemplo mais complexo.</p>

<div class='codeblock'>
<p>seosoquenao.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;

<strong>&lt;head&gt;</strong>
	&lt;title&gt;Google est√° olhando&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
	<strong>&lt;!-- script interrompe a leitura da p√°gina e executa imediatamente --&gt;</strong>
	<strong class='small'>&lt;script src='seosoquenao.js'&gt;&lt;/script&gt;</strong>
<strong>&lt;/head&gt;</strong>

<strong>&lt;body&gt;</strong>

	<strong>&lt;h1 id='tagTitulo'&gt;</strong>Acessibilidade e SEO<strong>&lt;/h1&gt;</strong>

	<strong>&lt;p id='tagParagrafo'&gt;</strong>
		Sim pequeno gafanhoto, html tem mais de &lt;strong&gt;100 tags&lt;/strong&gt;
		diferentes al√©m de table e div.
	<strong>&lt;/p&gt;</strong>

<strong>&lt;/body&gt;</strong>

&lt;/html&gt;</code
>
</div>

<div class='codeblock'>
<p>seosoquenao.js</p>
<code class='javascript'
>'use strict';

<strong>// tenta pegar elementos da p√°gina Html pela id</strong>
<strong>// e os tornar manipul√°veis dentro do JavaScript</strong>
let titulo = document<strong class='small'>.getElementById('tagTitulo');</strong>
let paragrafo = document<strong>.getElementById('tagParagrafo');</strong>

<strong>// titulo e paragrafo s√£o null?!</strong>

titulo.innerHTML = 'Black hat SEO'; //erro
paragrafo.attributes.add('style', 'display: none'); // erro</code
>
</div>

<p>Ao abrir este arquivo diretamente do seu computador, com o console aberto, talvez voc√™ note mais erros. Ao abrir este arquivo atrav√©s de um servidor, mesmo que local, com certeza voc√™ notar√° mais erros.</p>

<p>Por√©m a programa√ß√£o acima est√° perfeitamente correta, e o arquivo .htm tamb√©m. <strong>O problema que ocorre</strong> neste caso n√£o existe em linguagens C e similares, e <strong>se d√° quando combinamos os arquivos .htm e .js de uma determinada maneira</strong> que provoca uma intera√ß√£o inadequada entre o JavaScript e o <abbr title='Document Object Model'>DOM</abbr> (Notou a eleg√¢ncia da frase? Ela √© √≥tima para impressionar seu chefe quando vc tiver que explicar pq aquele site est√° funcionando perfeitamente no seu pc mas quando vc publicou pipocaram erros em todo o lugar).</p>

<p>Lembre-se que JavaScript n√£o possui o conceito de √∫nico ponto de entrada (m√©todo <code class='c'>main</code>). Quando o navegador encontra uma tag <code class='html'>&lt;script&gt;</code> na p√°gina, ele p√°ra de processar o restante do documento, baixa o arquivo js, roda seu conte√∫do, e s√≥ depois continua o processamento normalmente. Em nosso exemplo, como a tag <code class='html'>&lt;script&gt;</code> est√° antes do conte√∫do, <strong>o navegador carrega e roda a programa√ß√£o antes de tomar ci√™ncia do resto do documento.</strong> Nas primeiras linhas de nosso c√≥digo, estamos pedindo para o navegador pegar determinados elementos na p√°gina, mas ele ainda n√£o sabe que esses elementos existem. Isso talvez n√£o ocorra sempre ao abrir o arquivo local devido diferen√ßas que existem ao ler o arquivo diretamente do hd, por√©m sempre ir√° acontecer atrav√©s de um servidor http.</p>

<p>E porque n√£o tivemos esse problema no primeiro exemplo? Porque l√° n√£o est√°vamos acessando nenhum elemento da p√°gina. Nunca sa√≠mos do mundinho JavaScript para o mundo <abbr title='Document Object Model'>DOM</abbr>.</p>

<p><strong>Podemos corrigir nosso problema de tr√™s maneiras pelo menos.</strong></p>

<ol>
	<li>Mover nossa tag <code class='html'>&lt;script&gt;</code> para o final da p√°gina, ap√≥s o conte√∫do;</li>
	<li>Pedir para o navegador s√≥ executar nossa programa√ß√£o ap√≥s o carregamento da p√°gina, na pr√≥pria tag;</li>
	<li>Fazer a mesma coisa que a alternativa anterior, mas dentro do c√≥digo JavaScript.</li>
</ol>

<p>A terceira eu vou deixar pra mais adiante, pois precisar√≠amos saber o que s√£o eventos. Vamos ver os 2 primeiros casos e explicar o que acontece.</p>

<h3>Solu√ß√£o 1 - Movendo a tag script</h3>

<div class='codeblock'>
<p>seosoquenaoS1.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;

&lt;head&gt;
	&lt;title&gt;Google est√° olhando&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
&lt;/head&gt;

<strong>&lt;body&gt;</strong>

	<strong>&lt;h1 id='tagTitulo'&gt;</strong>Acessibilidade e SEO<strong>&lt;/h1&gt;</strong>

	<strong>&lt;p id='tagParagrafo'&gt;</strong>
		Sim pequeno gafanhoto, html tem mais de 100 tags
		diferentes al√©m de table e div.
	<strong>&lt;/p&gt;</strong>

	<strong>&lt;!-- script executa depois que o corpo de body foi lido --&gt;</strong>
	<strong class='small'>&lt;script src='seosoquenao.js'&gt;&lt;/script&gt;</strong>

	<strong>&lt;!--</strong>
	<strong class='comment'>Segura a empolga√ß√£o, a especifica√ß√£o n√£o permite colocar mais nada</strong>
	<strong class='comment'>depois de &lt;/body&gt; e &lt;/html&gt;. Mas isso nunca √© necess√°rio.</strong>
	<strong class='comment'>--&gt;</strong>

<strong>&lt;/body&gt;</strong>

&lt;/html&gt;</code
>
</div>

<p>Essa solu√ß√£o talvez seja a mais simples. Quando o navegador rodar o JavaScript, j√° vai ter lido todos os elementos da p√°gina, e pode pegar qualquer um deles sem problema. A desvantagem deste m√©todo √© que o navegador n√£o poder√° otimizar o download dos arquivos que a p√°gina ir√° usar (baixando em paralelo por exemplo), pois ele s√≥ vai saber que precisar√° deles no final do documento.</p>

<h3 id='defer'>Solu√ß√£o 2 - Postergando a execu√ß√£o na tag</h3>

<div class='codeblock'>
<p>seosoquenaoS2.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;

<strong>&lt;head&gt;</strong>
	&lt;title&gt;Google est√° olhando&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
	<strong>&lt;!-- defer faz o script executar depois que toda a p√°gina foi lida --&gt;</strong>
	<strong class='small'>&lt;script</strong> src='seosoquenao.js' <strong class='small'>defer&gt;</strong>&lt;/script&gt;
<strong>&lt;/head&gt;</strong>

<strong>&lt;body&gt;</strong>

	<strong>&lt;h1 id='tagTitulo'&gt;</strong>Acessibilidade e SEO<strong>&lt;/h1&gt;</strong>

	<strong>&lt;p id='tagParagrafo'&gt;</strong>
		Sim pequeno gafanhoto, html tem mais de 100 tags
		diferentes al√©m de table e div.
	<strong>&lt;/p&gt;</strong>

<strong>&lt;/body&gt;</strong>

&lt;/html&gt;</code
>
</div>

<p>Essa solu√ß√£o √© bastante elegante, por√©m n√£o √© suportada nos IEs mais antigos. Al√©m disso, ela s√≥ funciona para arquivos .js externos. N√£o √© poss√≠vel utiliz√°-la quando colocamos a programa√ß√£o entre as tags <code class='html'>&lt;script&gt;</code> e <code class='html'>&lt;/script&gt;</code>. Atrav√©s do atributo <code class='html'>defer</code> da tag, indicamos nosso desejo de executar a programa√ß√£o dentro dela s√≥ ap√≥s o carregamento da p√°gina.</p>

<h3>Se familiarizando com a <em>Cosa Nostra</em></h3>

<p>Utilizamos o m√©todo <code class='javascript'>document.getElementById</code> para trazer o elemento da p√°gina para dentro do nosso c√≥digo. Esta solu√ß√£o n√£o √© a mais antiga para fazermos tal coisa, por√©m √© a <strong>recomendada pela performance e compatibilidade</strong> com os navegadores.</p>

<p>Mas e se precisamos pegar elementos que n√£o possuem id? A API disponibiliza outros m√©todos que retornam valores diferentes dependendo da sua necessidade, sendo que o √∫ltimo deles, <code class='javascript'>document.querySelectorAll</code> foi inspirado ap√≥s o surgimento do jQuery.</p>

<div class='codeblock'>
<p>cosanostra.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;
&lt;head&gt;
	&lt;title&gt;1001 maneiras de falar com o DOM&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
&lt;/head&gt;
<strong>&lt;body&gt;</strong>
	&lt;header&gt;
		&lt;nav&gt;
			<strong>&lt;ul&gt;</strong>
				&lt;li&gt;<strong>&lt;a href='pag1'&gt;link 1&lt;/a&gt;</strong>&lt;/li&gt;
				&lt;li&gt;<strong>&lt;a href='pag2'&gt;link 2&lt;/a&gt;</strong>&lt;/li&gt;
				&lt;li&gt;<strong>&lt;a href='pag3'&gt;link 3&lt;/a&gt;</strong>&lt;/li&gt;
				&lt;li&gt;<strong>&lt;a href='pag4'&gt;link 4&lt;/a&gt;</strong>&lt;/li&gt;
			<strong>&lt;/ul&gt;</strong>
		&lt;/nav&gt;
	&lt;/header&gt;
	...
	&lt;footer&gt;
		&lt;div&gt;Ir para o <strong>&lt;a href='#'&gt;topo&lt;/a&gt;</strong>&lt;/div&gt;
	&lt;/footer&gt;
	<strong>&lt;script src='cosanostra.js'&gt;&lt;/script&gt;</strong>
<strong>&lt;/body&gt;</strong>
&lt;/html&gt;</code
>
</div>

<div class='codeblock'>
<p>cosanostra.js</p>
<code class='javascript'
>'use strict';

<strong>// retorna os links do menu e o ir para o topo</strong>
let links = document<strong class='small'>.getElementsByTagName('a');</strong>

// filtra os links fora da lista
let linksFiltrados = [];
let nodeName;
for (let link of links) {
	nodeName = link.parentNode.nodeName.toLowerCase();
	if (nodeName === 'li') {
		linksFiltrados.push(link);
	}
}

<strong>// retorna os links do menu apenas. √± funciona em IE8-</strong>
let linksMenu = document<strong class='small'>.querySelectorAll('ul a');</strong>

<strong>// retorna os links do menu apenas.</strong>
<strong>// vers√µes do jQuery 1.10.x funcionam em todos os navegadores</strong>
let linksMenuJ = <strong class='small'>jQuery('ul a');</strong></code
>
</div>

<p>Notem que cada chamada de m√©todo para trazer um elemento do <abbr title='Document Object Model'>DOM</abbr> para dentro do JavaScript leva um certo tempo para realizar esta opera√ß√£o. Por motivos de <strong>performance,</strong> devemos sempre que poss√≠vel <strong>guardar a refer√™ncia</strong> para estes elementos e reutiliz√°-la, ao inv√©s de chamar continuamente m√©todos que busquem no <abbr title='Document Object Model'>DOM</abbr>. Vejam por exemplo este trecho da pr√≥pria documenta√ß√£o do jQuery UI (<a rel='external nofollow' href='http://jqueryui.com/datepicker/#date-formats'>http://jqueryui.com/datepicker/#date-formats</a>):</p>

<div class='codeblock'>
<p>intera√ß√£o pobre com o DOM</p>
<code class='javascript'
>'use strict';

<strong>// busca o mesmo item 2x desnecessariamente</strong>
<strong>// buscar coisas no DOM √© uma opera√ß√£o despendiosa</strong>
$(function() {
	<strong>$('#datepicker')</strong>.datepicker();
	$('#format').change(function() {
		<strong>$('#datepicker')</strong>.datepicker('option', 'dateFormat', $(this).val());
	});
});</code
>
</div>

<p>Note que o mesmo elemento foi buscado <strong>duas vezes denecessariamente.</strong> Se quisermos deixar o c√≥digo mais perform√°tico, podemos fazer a seguinte altera√ß√£o:</p>

<div class='codeblock'>
<p>intera√ß√£o correta com o DOM</p>
<code class='javascript'
>'use strict';

$(function() {
	<strong>// salvamos a refer√™ncia ao elemento na vari√°vel</strong>
	<strong class='small'>let meuDatePicker = $('#datepicker');</strong>

	<strong>// e usamos quantas vezes quisermos sem sermos penalizados</strong>

	<strong class='small'>meuDatePicker</strong>.datepicker();
	$('#format').change(function() {
		<strong>meuDatePicker</strong>.datepicker('option', 'dateFormat', $(this).val());
	});
});</code
>
</div>

<h3 id='seo'>Google - O Grande Irm√£o</h3>

<p>Acabamos de aprender como alterar html atrav√©s de JavaScript. Igualmente importante √© sabermos quando n√£o devemos fazer isso. Via de regra, Google e outros bots <strong>n√£o indexam conte√∫do criado ou alterado por javascript.</strong> Por√©m, pode penalizar voc√™ se ele achar que voc√™ est√° tentando trapacear, mostrando um conte√∫do muito diferente do que foi indexado. Para aplicativos web isso talvez n√£o seja um problema, mas para p√°ginas de internet com conte√∫do com certeza √©. Aqui vale o bom senso. Podemos fazer um ou outro dropdown, mas se abusarmos deste recursos, escondermos coisas sem um m√©todo de mostr√°-las novamente, podemos ser <strong>punidos pelo Google</strong> com posi√ß√µes mais baixas nos resultados, e at√© mesmo banimento tempor√°rio.</p>

<p>O fato de bots n√£o rodarem javascript em sua maioria tamb√©m pode ser usado em nossa <strong>vantagem.</strong> √â poss√≠vel por exemplo proteger endere√ßos de emails ou evitar envio autom√°tico de formul√°rios alterando certas propriedades por JavaScript.</p>

<div class='codeblock'>
<p>semcaptcha.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;
&lt;head&gt;
	&lt;title&gt;Google est√° olhando&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
&lt;/head&gt;
<strong>&lt;body&gt;</strong>
	<strong>&lt;form action='#'&gt;</strong>
		&lt;dl&gt;
			&lt;dt&gt;&lt;label for='nome'&gt;nome&lt;/label&gt;&lt;/dt&gt;
			&lt;dd&gt;&lt;input id='nome' type='text' /&gt;&lt;/dd&gt;
		&lt;/dl&gt;
		&lt;p&gt;&lt;input type='submit' /&gt;&lt;/p&gt;
	<strong>&lt;/form&gt;</strong>
	<strong>&lt;script src='semcaptcha.js'&gt;&lt;/script&gt;</strong>
<strong>&lt;/body&gt;</strong>
&lt;/html&gt;</code
>
</div>

<div class='codeblock'>
<p>semcaptcha.js</p>
<code class='javascript'
>'use strict';

let formulario = document.getElementsByTagName('form')[0];
<strong>formulario.action = 'cadastrar.cgi';</strong> <strong>// n√£o vai ser lido pela maioria dos bots</strong></code
>
</div>

<h3 id='serverside'>Desacoplando JavaScript das linguagens server-side</h3>

<p>Se estruturarmos nossa programa√ß√£o de modo que as bibliotecas com os objetos estejam em arquivos externos, podemos apenas chamar os <q>construtores</q> de nossos objetos nas p√°ginas com programa√ß√£o <em>server-side</em>, passando os par√¢metros com valores din√¢micos.</p>

<div class='codeblock'>
<p>serverside.php</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;
&lt;head&gt;
	&lt;title&gt;Html m√≠nimo aceit√°vel&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
	<strong>&lt;script src='dropdown.js'&gt;&lt;/script&gt;</strong>
	&lt;script&gt;
		(function() {
			'use strict';

			dropdown.init(<strong>&lt;%= // valor calculado server side %&gt;</strong>);
		})();
	&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;/body&gt;
&lt;/html&gt;</code
>
</div>

<div class='codeblock'>
<p>dropdown.js</p>
<code class='javascript'
>'use strict';

let dropdown = {

	init: function(idConteiner) {
		this.idConteiner = idConteiner;
		this.conteiner = document.getElementById(this.idConteiner);
		this.rotulo = this.conteiner.querySelector('button');
		this.lista = this.conteiner.querySelector('ul');
		this.rotulo.addEventListener('click', this.clickHandler.bind(this));
	},

	clickHandler: function(evento) {
		this.visivel = !this.visivel;
		this.atualizar();
	},

	atualizar: function() {
		if (this.visible) {
			this.lista.style.display = 'block';
			return;
		}
		this.lista.style.display = 'none';
	},

	idConteiner: null,

	conteiner: null

	rotulo: null,

	lista: null,

	visivel: false

};</code
>
</div>

</section>



<section>

<h2 id='oop'>This doesn't makes sense - <abbr title='Object Oriented Programming'>OOP</abbr> <span>Ou WTF is this??? :P</span></h2>

<p>J√° vimos acima como declarar objetos simples, utilizando literais de objeto <code class='javascript'>{}</code>. Estes objetos s√£o din√¢micos, n√£o possuindo uma no√ß√£o de classe como em outras linguagens. Relembrando que de fato <strong>n√£o existem classes em JavaScript</strong>, apenas recursos da linguagem para camuflar a implementa√ß√£o real. Esta caracter√≠stica, associada ao fato de que JavaScript n√£o √© fortemente tipado, permite que objetos tenham propriedades e m√©todos inseridos ou removidos dinamicamente, em tempo de execu√ß√£o.</p>

<p><strong>Mesmo no modo estrito, podemos adicionar e remover propriedades</strong>. Note que isso n√£o √© muito bom para performance. Assim como acontece com os tipos de vari√°veis, se evitarmos mudar o objeto ap√≥s sua cria√ß√£o, o compilador n√£o consegue efetuar otimiza√ß√µes para tipos espec√≠ficos.</p>
<p>Adicionalmente, JavaScript possui o operador <code class='javascript'>delete</code> para remover propriedades, que √© lento. Preferencialmente atribu√≠mos o valor <code class='javascript'>null</code> para a propriedade que desejamos remover. A vers√£o ES5 adicionou um m√©todo chamado <code class='javascript'>Object.seal</code>, que previne modifica√ß√£o din√¢mica do objeto.</p>

<div class='codeblock'>
<p>adic√£o e remo√ß√£o din√¢mica de propriedades</p>
<code class='javascript'
>'use strict';

let escravoDeJo = {
	jogar: function() {
		//
	}
};

escravoDeJo.jogar = null; // tira a propriedade - use o valor null ao inv√©s de delete
escravoDeJo.som = 'zig zig za'; // bota a propriedade

console.log(escravoDeJo); // note a mudan√ßa das propriedades

Object.seal(escravoDeJo); // "corpo fechado" - previne mudan√ßas no objeto

// Lan√ßa exce√ß√£o. N√£o √© poss√≠vel mudar um objeto selado
escravoDeJo.fazer = function() {
	//
}</code
>
</div>

<p>Lembra que eu disse que JavaScript n√£o possui classes de verdade, certo? Veja as consequ√™ncias disso nesse peda√ßo de c√≥digo.</p>

<div class='codeblock'>
<p>adic√£o e remo√ß√£o din√¢mica de propriedades</p>
<code class='javascript'
>'use strict';

class Estranha {
	seraQueTemMesmo() {
		console.log('tem!');
	}
}

const estranho = new Estranha();
const diferente = new Estranha();

diferente.seraQueTemMesmo = null; // v√°lido, mesmo com const. ver explica√ß√£o abaixo

estranho.seraQueTemMesmo(); // Ok
diferente.seraQueTemMesmo(); // Erro! O objeto diferente n√£o possui esse m√©todo</code
>
</div>

<p>U√©? Objetos da mesma classe podem ser diferentes? E <code class='javascript'>const</code> n√£o salvou o dia e botou um pouco de ordem nisso? Infelizmente a primeira resposta √© sim, e a segunda √© n√£o. Ao contr√°rio de outras linguagens, que n√£o permitem que um objeto declarado com <code class='javascript'>const</code> mude de maneira nenhuma, JavaScript apenas pro√≠be que a constante referencia um objeto diferente do inicial.</p>

<p><strong>Se n√£o tomarmos cuidado, nunca podemos garantir que dois objetos de uma mesma classe sejam parecidos.</strong> Por√©m, nem tudo est√° perdido, uma vez que possu√≠mos um m√©todo que √© capaz de fazer o que voc√™ deseja, chamado <code>Object.freeze</code>.</p>

<div class='codeblock'>
<p>adic√£o e remo√ß√£o din√¢mica de propriedades</p>
<code class='javascript'
>'use strict';

class Estranha {
	constructor() {
		Object.defineProperty(this, propriedade, {
			value: 1,
			writable: true
		});
	}
	seraQueTemMesmo() {
		console.log('tem!');
	}
}

const estranho = new Estranha();
const diferente = new Estranha();

estranho = new Estranha(); // Erro! n√£o √© poss√≠vel atribuir um novo valor √† const

<strong>Object.freeze(estranho);</strong>
<strong>Object.freeze(diferente);</strong>

<strong>diferente.seraQueTemMesmo = null;</strong> <strong>// Erro! N√£o √© poss√≠vel modificar um objeto congelado</strong>

<strong>estranho.propriedade = 2;</strong> <strong>// Erro! N√£o √© poss√≠vel modificar um objeto congelado</strong>

estranho.seraQueTemMesmo(); // Ok se chegasse aqui
diferente.seraQueTemMesmo(); // Ok se chegasse aqui</code
>
</div>

<p>Caso congelar um objeto seja uma medida muito extrema, existe um intermedi√°rio, que apenas proibe a altera√ß√£o dos m√©todos, mas n√£o das propriedades, chamado <code class='javascript'>Object.seal</code>.</p>

<div class='codeblock'>
<p>adic√£o e remo√ß√£o din√¢mica de propriedades</p>
<code class='javascript'
>'use strict';

class Estranha {
	<strong>constructor() {</strong>
		Object.defineProperty(this, propriedade, {
			value: 1,
			writable: true
		});
		<strong>Object.seal(this);</strong>
	<strong>}</strong>
	seraQueTemMesmo() {
		console.log('tem!');
	}
}

const estranho = new Estranha();
const diferente = new Estranha();

<strong>diferente.propriedade = 2;</strong> <strong>// Ok, seal permite modificar propriedades</strong>

<strong>diferente.seraQueTemMesmo = null;</strong> <strong>// Erro, seal n√£o deixa redefinir m√©todos</strong>

estranho.seraQueTemMesmo(); // Ok se chegasse aqui
diferente.seraQueTemMesmo(); // Ok se chegasse aqui</code
>
</div>

<p></p>

<p>Para acomodar toda esta flexibilidade, JavaScript possui mais uma diferen√ßa, desta vez em rela√ß√£o √† palavra-chave <code class='javascript'>this</code>. Se podemos inserir fun√ß√µes dinamicamente nos objetos, o que acontece quando uma destas fun√ß√µes utiliza <code class='javascript'>this</code>?</p>

<div class='codeblock'>
<p>significado de this</p>
<code class='javascript'
>'use strict';

const modeloCumprimentar = function() {
	console.log('Ol√°, menu nome √© ' + this.nome); // WTF is this?
}

const diretorSuspense = {
	nome: 'Alfred';
};

const diretorAlternativo = {
	nome: 'Tim';
};

diretorSuspense.cumprimentar = modeloCumprimentar;
diretorAlternativo.cumprimentar = modeloCumprimentar;

diretorSuspense.cumprimentar(); // mostra Ol√°, menu nome √© Alfred
diretorAlternativo.cumprimentar(); // mostra Ol√°, menu nome √© Tim</code
>
</div>

<p><strong>Resumindo, <code class='javascript'>this</code> em JavaScript muda de significado de acordo com o contexto.</strong> Mais precisamente, <code class='javascript'>this</code> aponta sempre para o objeto que est√° executando a fun√ß√£o atualmente. Isso traz mais problemas do que vantagens geralmente. Isto permite que as fun√ß√µes funcionem um pouco como <em>traits</em> presentes em outras linguagens, que permitem compor um objeto sem usar heran√ßa diretamente.</p>

<p>M√©todos que podem receber uma fun√ß√£o como par√¢metro, tamb√©m aceitam m√©todos de objetos. Nesses casos, o significado de <code class='javascript'>this</code> sempre ir√° mudar. M√©todos nativos como <code class='javascript'>setTimeout</code> e <code class='javascript'>addEventListener</code> possuem esse comportamento. Vejamos um outro exemplo disso:</p>

<div class='codeblock'>
<p>mudan√ßas indesejadas do contexto de execu√ß√£o, this</p>
<code class='javascript'
>'use strict';

let frutas = [
	{ nome: 'banana', peso: 100 },
	{ nome: 'ma√ß√£', peso: 80 },
	{ nome: 'abacaxi', peso: 3500 } // um abacaxi enorme!
];

<strong>let ordenador = {</strong>

	ordenarPor: 'nome',

	<strong>ordenar: function(arrayOriginal) {</strong>
		<strong>arrayOriginal.sort(this.comparador);</strong> <strong>// sort muda o contexto de execu√ß√£o</strong>
	<strong>},</strong>

	<strong>comparador: function(a, b) {</strong>

		<strong>// this aponta para o qu√™ aqui?? Possivelmente para window.</strong>
		// note tamb√©m o uso da nota√ß√£o [] para acessar campos dinamicamente

		if (typeof a[<strong>this</strong>.ordenarPor] === 'number'
			&amp;&amp; typeof b[<strong>this</strong>.ordenarPor] === 'number'
			) {

			return a[<strong>this</strong>.ordenarPor] - b[<strong>this</strong>.ordenarPor];
		}

		if (a[<strong>this</strong>.ordenarPor] &gt; b[<strong>this</strong>.ordenarPor]) {
			return 1;
		} else if (a[<strong>this</strong>.ordenarPor] &lt; b[<strong>this</strong>.ordenarPor]) {
			return -1;
		} else if (a[<strong>this</strong>.ordenarPor] == b[<strong>this</strong>.ordenarPor]) {
			return 0;
		}

	<strong>}</strong>

<strong>};</strong>

ordenador.ordenarPor = 'nome';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

ordenador.ordenarPor = 'peso';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

// PS: logar a array inteira de uma vez pode causar confus√£o
// pois a ordem mostrada dos campos vai ser sempre o estado final da refer√™ncia
// por isso usamos for nos valores</code
>
</div>

<p>A refer√™ncia <code class='javascript'>this</code> parece apontar para o objeto <code class='javascript'>ordenador</code>, mas isso n√£o √© sempre verdade. Quando passamos o m√©todo para <code class='javascript'>arrayOriginal.sort</code>, nosso comparador vai executar num contexto diferente. Assim o <code class='javascript'>this</code> referenciado n√£o √© o que esper√°vamos. Tentamos usar a propriedade <code class='javascript'>ordenarPor</code> que n√£o est√° mais acess√≠vel e isso causa uma exce√ß√£o.</p>

<h3 id='bindthis'>Deixando as coisas mais previs√≠veis</h3>

<p>N√£o estamos desamparados para resolver os problemas de mudan√ßa de contexto (am√©m!). De fato, <strong>as fun√ß√µes em JavaScript possuem diversos m√©todos para controlar essa mudan√ßa.</strong> Vamos ver a seguir dois deles.</p>


<p>Lembrando que em JavaScript fun√ß√µes s√£o objetos, em navegadores recentes as fun√ß√µes possuem um m√©todo chamado <code class='javascript'>bind</code>, que retorna uma <strong>c√≥pia da fun√ß√£o com o <code class='javascript'>this</code> fixo.</strong></p>

<div class='codeblock'>
<p>controlando contexto com bind</p>
<code class='javascript'
>'use strict';

arrayOriginal.sort(this.comparador<strong>.bind(this)</strong>); <strong>// ES3, s√≥ IE9+ suporta</strong></code
>
</div>

<p>Para navegadores mais antigos temos outras duas alternativas. A concentualmente mais simples √© utilizar <code class='javascript'>jQuery.proxy</code>, que funciona de <strong>maneira similar ao <code class='javascript'>bind</code>.</strong></p>

<div class='codeblock'>
<p>controlando contexto com jQuery.proxy</p>
<code class='javascript'
>'use strict';

arrayOriginal.sort(<strong>jQuery.proxy(</strong>this.comparador, <strong>this)</strong>); <strong>// todos os navegadores</strong></code
>
</div>

<p>Note que <code class='javascript'>jQuery.proxy</code> permite passar par√¢metros para a fun√ß√£o na seguinte forma:</p>

<div class='codeblock'>
<p>passando par√¢metros com jQuery.proxy</p>
<code class='javascript'
>'use strict';

jQuery.proxy(this.comparador, this, var1, var2, var3);</code
>
</div>

<p>Internamente <code class='javascript'>jQuery.proxy</code> utiliza um outro m√©todo pertencente √†s fun√ß√µes, que tamb√©m altera o valor de <code class='javascript'>this</code>, chamado <code class='javascript'>apply</code>. Na verdade, n√£o √© dif√≠cil fazermos uma vers√£o simplificada de <code class='javascript'>bind</code>, ou <code class='javascript'>jQuery.proxy</code> com <code class='javascript'>apply</code>, evitando ser necess√°rio uma biblioteca inteira apenas para essa funcionalidade.</p>

<p>A terceira alternativa √© a mais manual e complexa. Possui por√©m a vantagem de cobrir todos os casos que o <code class='javascript'>bind</code> nativo cobre. Ela utiliza o conceito de <a href='#closures'>closures</a>.</p>

<h3>Revisitando nosso abacaxi</h3>

<p>Esta solu√ß√£o do nosso problema consiste em  <strong>simplesmente n√£o utilizar a palavra <code class='javascript'>this</code>.</strong> Apenas a palavra <code class='javascript'>this</code> muda de significado, se conseguirmos <strong>referenciar nosso objeto original por outro nome,</strong> como demonstramos com <a href='#closures'>aliases</a> e a <code class='javascript'>cabineTelefonica</code>, podemos acess√°-lo sempre que precisarmos sem ter medo de uma crise de identidade. Para fazermos isso usamos uma <em>closure</em>. A primeira forma de utiliz√°-la, √© fazendo-a conter a fun√ß√£o completa de compara√ß√£o.</p>


<div class='codeblock'>
<p>resolvendo mudan√ßas de contexto com closures</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

let frutas = [
	{ nome: 'banana', peso: 100 },
	{ nome: 'ma√ß√£', peso: 80 },
	{ nome: 'abacaxi', peso: 3500 } // um abacaxi enorme!
];

let ordenador = {

	ordenarPor: 'nome',

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	// init ir√° executar a closure, que salva a refer√™ncia para this com um nome diferente
	// este nome n√£o sofre do mesmo mal que this, e aponta sempre para a mesma refer√™ncia
	init: function() {
		this.comparador = this.closureComparador(this);
	},

	ordenar: function(arrayOriginal) {
		arrayOriginal.sort(this.comparador);
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	closureComparador: function (contexto) {

		return function(a, b) {

			// contexto sempre apontar√° para o objeto ordenador

			if (typeof a[contexto.ordenarPor] === 'number'
				&amp;&amp; typeof b[contexto.ordenarPor] === 'number'
				) {

				return a[contexto.ordenarPor] - b[contexto.ordenarPor];
			}

			if (a[contexto.ordenarPor] &gt; b[contexto.ordenarPor]) {
				return 1;
			} else if (a[contexto.ordenarPor] &lt; b[contexto.ordenarPor]) {
				return -1;
			} else if (a[contexto.ordenarPor] == b[contexto.ordenarPor]) {
				return 0;
			}

		}

	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	comparador: null

};

ordenador.init();

ordenador.ordenarPor = 'nome';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

ordenador.ordenarPor = 'peso';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

// PS: logar a array inteira de uma vez pode causar confus√£o
// pois a ordem mostrada dos campos vai ser sempre o estado final da refer√™ncia
// por isso usamos for nos valores</code
>
</div>

<p>Note que precisamos ser bastante cuidadosos para sempre escrever <code class='javascript'>contexto</code> ao inv√©s de <code class='javascript'>this</code>. Existe uma <strong>segunda forma dessa solu√ß√£o,</strong> que utiliza a closure para simplesmente passar o contexto correto ao m√©todo executado.</p>

<div class='codeblock'>
<p>resolvendo mudan√ßas de contexto com closures - solu√ß√£o alternativa</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

let frutas = [
	{ nome: 'banana', peso: 100 },
	{ nome: 'ma√ß√£', peso: 80 },
	{ nome: 'abacaxi', peso: 3500 } // um abacaxi enorme!
];

let ordenador = {

	ordenarPor: 'nome',

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	// init ir√° executar a closure, que salva a refer√™ncia para this com um nome diferente
	// este nome n√£o sofre do mesmo mal que this, e aponta sempre para a mesma refer√™ncia
	init: function() {
		this.comparador = this.closureComparador(this);
	},

	ordenar: function(arrayOriginal) {
		arrayOriginal.sort(this.comparador);
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	closureComparador: function (contexto) {
		return function(a, b) {

			// ao inv√©s de escrever o corpo da fun√ß√£o diretamente aqui, como no outro exemplo
			// simplesmente chamamos a fun√ß√£o comparar definida no objeto
			// como comparar est√° sendo chamada indiretamente dentro da closure, atrav√©s de "contexto"
			// o "this" dentro de "comparar" apontar√° para "contexto", que √© o objeto ordenador, como queremos
			// ao contr√°rio do problema original, onde "comparar" era chamada diretamente atrav√©s de array.sort
			// e portanto seu "this" apontava para window
			return contexto.comparar(a, b);

		}
	},

	comparador: null,

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

	comparar: function(a, b) {

		// a closure se encarrega de executar este m√©todo com o contexto correto
		// por isso podemos utilizar this sem preocupa√ß√µes

		if (typeof a[this.ordenarPor] === 'number'
			&amp;&amp; typeof b[this.ordenarPor] === 'number'
			) {

			return a[this.ordenarPor] - b[this.ordenarPor];
		}

		if (a[this.ordenarPor] &gt; b[this.ordenarPor]) {
			return 1;
		} else if (a[this.ordenarPor] &lt; b[this.ordenarPor]) {
			return -1;
		} else if (a[this.ordenarPor] == b[this.ordenarPor]) {
			return 0;
		}

	}

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

};

ordenador.init();

ordenador.ordenarPor = 'nome';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!! USE BIND SE POSS√çVEL.</strong>

ordenador.ordenarPor = 'peso';
ordenador.ordenar(frutas);
for (let fruta of frutas) {
	console.log(fruta);
}

// PS: logar a array inteira de uma vez pode causar confus√£o
// pois a ordem mostrada dos campos vai ser sempre o estado final da refer√™ncia
// por isso usamos for nos valores</code
>
</div>

<p>Vale a pena refor√ßar que, <strong>a diferen√ßa entre o problema original e esta √∫ltima solu√ß√£o,</strong> √© que no c√≥digo original, pass√°vamos uma <strong>refer√™ncia direta</strong> para o m√©todo do objeto, fazendo com que ele fosse <strong>chamado diretamente,</strong> ao passo que nesta √∫ltima solu√ß√£o, passamos uma <strong>refer√™ncia indireta</strong> ao m√©todo, fazendo com que ele seja <strong>chamado atrav√©s do objeto ao qual pertence.</strong></p>

</section>



<section>

<h2 id='heranca'>√â tanta heran√ßa que vou ficar rico <span>de conhecimento ;)</span></h2>

<p>JavaScript suporta pelo menos 3 maneiras diferentes de criarmos uma hierarquia com heran√ßas.</p>

<h3>Heran√ßa com pouca classe</h3>

<p>J√° vimos que heran√ßa em JavaScript √© <strong>baseada em prot√≥tipos.</strong> Um objeto herda diretamente de outro objeto. Embora possamos declarar uma heran√ßa como se estiv√©ssemos usando classes, n√£o √© o que efetivamente acontece por baixo dos panos. Se nos atermos ao uso b√°sico dos objetos, n√£o quebraremos a ilus√£o de estarmos trabalhando com classes. Para saber efetivamente em que momentos esta <a href='#herancaprototipo'>ilus√£o √© quebrada</a>, continue lendo mais abaixo.</p>

<div class='codeblock'>
<p>heran√ßa com polimorfismo</p>
<code class='javascript'
>'use strict';

class ObjetoPai {

	constructor() {
		Object.defineProperty(this, 'propriedade', {value: []});
		this.propriedade.push(valor);
	}

	metodo() {
		console.log(this.propriedade);
	}

}

// heran√ßa
class ObjetoFilho extends ObjetoPai {

	constructor() {
		super();
		Object.seal(this);
	}

	// sobrescrita do m√©todo
	metodo() {
		super.metodo();
	}

}

// construtores
objetoPai = new ObjetoPai(3);
objetoFilho = new ObjetoFilho(3);

objetoPai.propriedade.push('pai');
objetoFilho.propriedade.push('filho');

objetoPai.metodo();
objetoFilho.metodo();</code
>
</div>

<h3 id='legacyheranca'>Heran√ßa antiga com Object.create</h3>

<p>Utilizamos o m√©todo <code class='javascript'>Object.create</code>. J√° vimos isso rapidamente quando definimos um objeto com getters e setters utilizando descritores de propriedades. Vamos ver agora um exemplo com polimorfismo. Se precisarmos acessar o objeto base de dentro do objeto filho, chamamos o m√©todo <code class='javascript'>Object.getPrototypeOf</code>, que retorna um objeto acima da cadeia de heran√ßa.</p>

<p>Note que estamos tratando de <strong>objetos concretos</strong>, e n√£o de defini√ß√µes de objetos como s√£o as classes em outras linguagens. Isso significa que, quando acessarmos o objeto base, estaremos <strong>acessando</strong> n√£o s√≥ as defini√ß√µes de m√©todos mas tamb√©m os <strong>valores das propriedades dele.</strong> Devemos portanto tomar o cuidado de, ao chamar estes m√©todos base, indicar que queremos <strong>execut√°-los no contexto do objeto filho.</strong></p>

<p>Outro cuidado que devemos tomar, √© o de atribuir valores aos objetos num m√©todo separado, que o inicializa. Se atribuirmos valores diretamente na defini√ß√£o do objeto, e estes valores forem tipos de refer√™ncia como arrays, eles ser√£o compartilhados pelos subobjetos ao inv√©s de cada um ter sua pr√≥pria c√≥pia.</p>

<div class='codeblock'>
<p>heran√ßa com polimorfismo</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

var objetoPai = {

	init: function() {
		this.propriedade = []; // inicializar valores das propriedades s√≥ aqui! Muito importante!
		this.propriedade.push(valor);
	},

	metodo: function() {
		console.log(this.propriedade);
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	propriedade: null

};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// heran√ßa
var objetoFilho = Object.create(objetoPai);

// sobrescrita do m√©todo
objetoFilho.metodo = function() {
	Object.getPrototypeOf(this).metodo.call(this);
}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

objetoPai.init(3);
objetoFilho.init(3);

objetoPai.propriedade.push('pai');
objetoFilho.propriedade.push('filho');

objetoPai.metodo();
objetoFilho.metodo();</code
>
</div>

<p>Se n√£o precisarmos de compatibilidade com navegadores antigos, podemos usar descritores de propriedade, que nos d√£o mais controle sobre a defini√ß√£o do objeto.</p>

<div class='codeblock'>
<p>heran√ßa com polimorfismo ES5</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

var objetoPai = Object.create(Object.prototype, {

	init: {
		value: function() {
			this.propriedade = []; // inicializar valores das propriedades s√≥ aqui! Muito importante!
			this.propriedade.push(valor);
		}
	},

	metodo: {
		value: function() {
			console.log(this.propriedade);
		},
		writable: true
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	propriedade: {
		value: null,
		writable: true
	}

});

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// heran√ßa
var objetoFilho = Object.create(objetoPai, {

	// sobrescrita do m√©todo
	metodo: {
		value: function() {
			Object.getPrototypeOf(this).metodo.call(this);
		}
	}


});

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

objetoPai.init(3);
objetoFilho.init(3);

objetoPai.propriedade.push('pai');
objetoFilho.propriedade.push('filho');

objetoPai.metodo();
objetoFilho.metodo();</code
>
</div>

<h3 id='deprecatedheranca'>Heran√ßa arcaica com function</h3>

<p>Mostro tamb√©m um exemplo de heran√ßa com a sintaxe antiga. Note que a sintaxe √© mais confusa e <strong>propensa a erros</strong>, pois possui <strong>etapas manuais</strong> que devem ser lembradas toda a vez. Al√©m disso, existem as quest√µes comentadas anteriormente sobre misturar defini√ß√µes de coisas no construtor e no prot√≥tipo, e dar a ilus√£o que JavaScript possui classes, o que n√£o √© verdade.</p>

<div class='codeblock'>
<p>heran√ßa com polimorfismo com sintaxe antiga, n√£o use!</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

function ObjetoPai(valor) {
	// definir e inicializar valores aqui
	this.propriedade = [];
	this.propriedade.push(valor);
}

ObjetoPai.prototype.metodo = function() {
	console.log(this.propriedade);
};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// heran√ßa
function ObjetoFilho() {
	ObjetoPai.apply(this, Array.prototype.slice.call(arguments)); // "super()"
}
ObjetoFilho.prototype = new ObjetoPai(); // especificar manualmente qual o prot√≥tipo para herdar
ObjetoFilho.prototype.constructor = ObjetoFilho; // sobrescrever manualmente o construtor

// sobrescrita do m√©todo
ObjetoFilho.prototype.metodo = function() {
	ObjetoPai.prototype.metodo.call(this); // nome do objeto base √© hardcoded e n√£o muda automaticamente de acordo com a heran√ßa
};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

var objetoPai = new ObjetoPai('pai');
var objetoFilho = new ObjetoFilho('filho');

objetoPai.metodo();
objetoFilho.metodo();</code
>
</div>

<p>Vamos ver um exemplo mais completo.</p>

<div class='codeblock'>
<p>polimorfismo, exemplo completo</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define o objeto base
var ampulheta = {

	init: function(tempo) {
		// define os valores padr√£o das propriedades
		this.tempoTotal = tempo;
		this.tempoAtual = this.tempoTotal;
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	contar: function() {
		if (this.tempoAtual &gt; 0) {
			this.tempoAtual--;
		}
	},

	girar: function() {
		this.tempoAtual = this.tempoTotal - this.tempoAtual;
	},

	<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

	tempoTotal: null,

	tempoAtual: null

};

// heran√ßa
var ampulhetaAutomatica = Object.create(ampulheta); // "ampulhetaAutomatica extends ampulheta"

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define os m√©todos do objeto derivado
ampulhetaAutomatica.contar = function() {

	if (this.tempoAtual &lt;= 0) {
		this.girar();
	} else {

		// chamar o m√©todo da maneira abaixo o executaria no contexto do objeto pai, ampulheta
		// Object.getPrototypeOf(this).contar();

		// por isso usando o m√©todo call da fun√ß√£o para mudar o contexto novamente para ampulhetaAutom√°tica
		Object.getPrototypeOf(this).contar.call(this);

	}

}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

ampulheta.init(3);
ampulhetaAutomatica.init(3);

ampulheta.contar(); // 2
ampulheta.contar(); // 1
ampulheta.contar(); // 0
ampulheta.girar(); // 3

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

ampulhetaAutomatica.contar(); // 2
ampulhetaAutomatica.contar(); // 1
ampulhetaAutomatica.contar(); // 0
ampulhetaAutomatica.contar(); // 3</code
>
</div>

<p>Mostrar properties</p>

<div class='codeblock'>
<p>polimorfismo, exemplo completo com sintaxe antiga, n√£o use!</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define o objeto base
function Ampulheta(tempo) {
	// define as propriedades e valores padr√£o
	this.tempoTotal = tempo;
	this.tempoAtual = this.tempoTotal;
}

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define os m√©todos do objeto base

Ampulheta.prototype.contar = function() {
	if (this.tempoAtual &gt; 0) {
		this.tempoAtual--;
	}
};

Ampulheta.prototype.girar = function() {
	this.tempoAtual = this.tempoTotal - this.tempoAtual;
};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define o objeto derivado
function AmpulhetaAutomatica() {
	Ampulheta.apply(this, Array.prototype.slice.call(arguments)); // "super()"
}

// heran√ßa
AmpulhetaAutomatica.prototype = new Ampulheta(); // "AmpulhetaAutomatica extends Ampulheta"
AmpulhetaAutomatica.prototype.constructor = AmpulhetaAutomatica; // "conserta" o construtor

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// define os m√©todos do objeto derivado
AmpulhetaAutomatica.prototype.contar = function() {
	if (this.tempoAtual &lt;= 0) {
		this.girar();
	} else {

		// chamar o m√©todo da maneira abaixo o executaria no contexto do objeto pai, ampulheta
		// Ampulheta.prototype.contar();

		// por isso usando o m√©todo call da fun√ß√£o para mudar o contexto novamente para ampulhetaAutomatica
		Ampulheta.prototype.contar.call(this);
	}
};

<strong>// N√ÉO COPIE!!! SINTAXE ANTIGA!!!!</strong>

// simula√ß√£o de sintaxe de outras linguagens
var contador = new Ampulheta(3);
var contadorAutomatico = new AmpulhetaAutomatica(3);

contador.contar(); // 2
contador.contar(); // 1
contador.contar(); // 0
contador.girar();  // 3

contadorAutomatico.contar(); // 2
contadorAutomatico.contar(); // 1
contadorAutomatico.contar(); // 0
contadorAutomatico.contar(); // 3</code
>
</div>

<h3 id='herancaprototipo'>Beware, here there be dragons</h3>

<p>Vale lembrar tamb√©m que as v√°rias formas de declarar objetos e heran√ßas descritas anteriormente podem coexistir ao mesmo tempo, sem necessariamente gerarem cadeias de heran√ßa 100% id√™nticas. Algumas utilizam fun√ß√µes objetos, outras objetos puros. Vou me ater √† √∫ltima maneira de heran√ßa, mais moderna e que parece ser a mais compacta, e mais parecida com a de outras linguagens, e portanto, mais propensa a erros de analogia.</p>

<p>Seja Javascript n√£o possui classes verdadeiras, o que ent√£o √© criado quando digitamos <code class='javascript'>class</code>? Uma fun√ß√£o. E como toda fun√ß√£o em JavaScript √© um objeto din√¢mico, √© poss√≠vel fazer, deliberadamente ou inadvertidamente toda sorte de coisas malucas.</p>

<div class='codeblock'>
<p>hic sunt dracones</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! APENAS PARA DEMONSTRA√á√ÉO!!!!</strong>

class Ha {
	constructor() {
		// se n√£o retornarmos nada explicitamente
		// this √© retornado implicitamente
		return 'outra coisa';
	}
}

const ha = new Ha(); // string "outra coisa" ao inv√©s de "inst√¢ncia" de Ha

class Bla {
	static fazer() { /**/ }
}

console.log(Bla); // tipo function

// adicionar propriedades est√°ticas dinamicamente √† "classe" (fun√ß√£o)
Bla.propriedade = 2;
Bla.propriedadeCompartilhada = { tipo: 'refer√™ncia' };


<strong>// N√ÉO COPIE!!! APENAS PARA DEMONSTRA√á√ÉO!!!!</strong>


// remover m√©todos est√°ticos dinamicamente
Bla.fazer = null;

// misturar maneiras diferentes de heran√ßas
let blo = Object.create(Bla);


<strong>// N√ÉO COPIE!!! APENAS PARA DEMONSTRA√á√ÉO!!!!</strong>


console.log(blo.propriedade); // 2. Era est√°tica mas virou de inst√¢ncia
console.log(blo.propriedadeCompartilhada); // { tipo: 'refer√™ncia' }. Era est√°tica mas virou de inst√¢ncia

// refer√™ncia √© a mesma da propriedade est√°tica
blo.propriedadeCompartilhada.tipo = 'mudou';
console.log(Bla.propriedadeCompartilhada); // { tipo: 'mudou' }

// Heran√ßa maldita ;)</code
>
</div>

<h3 id='proxyNativo'>Controle de visibilidade com Proxy Nativo</h3>

<p>Todas as op√ß√µes de declara√ß√£o de objetos que vimos at√© agora possuem apenas propriedades e m√©todos p√∫blicos, sem a o possibilidade de um controle mais preciso de sua visibilidade. JavaScript <strong>n√£o possui uma maneira</strong> de criar tais permiss√µes de acesso atrav√©s de palavras-chave como <code class='generic'><span class='keyword'>private</span></code>, <code class='generic'><span class='keyword'>protected</span></code> e <code class='generic'><span class='keyword'>public</span></code>, e portanto precisamos recorrer a padr√µes de projeto para conseguir o que queremos. <strong>Nenhuma das solu√ß√µes poss√≠veis √© capaz de satifazer completamente a falta dessa funcionalidade.</strong></p>

<p>A partir da vers√£o ES6 da linguagem, temos acesso √† <em>proxies</em> nativos, que tornam a tarefa de controle de visibilidade um pouco menos dif√≠cil, permitindo uma melhor mistura entre visibilidade, heran√ßa e uso de mem√≥ria do que √© poss√≠vel atrav√©s de outras maneiras. Ainda assim, deixam muito a desejar, uma vez que n√£o foram criados com isso em mente. Seu motivo de exist√™ncia parece ser a de efeitos colaterais como logs e notifica√ß√µes.</p>

<p><em>Proxies</em> nativos s√£o capazes de interceptar chamadas de m√©todos, acesso √† propriedades, e a√ß√µes atrav√©s dos operadores <code class='javascript'>new</code>, <code class='javascript'>delete</code>, <code class='javascript'>in</code>, e m√©todos de <code class='javascript'>Object</code> como <code class='javascript'>Object.getPrototypeOf</code>, <code class='javascript'>Object.create</code>, etc. N√£o vou abordar a <a rel='external nofollow' href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy'>lista completa de capacidades</a>, apenas as pertinentes ao controle de visibilidade.</p>

<p>Estes <em>proxies</em> necessitam de um objeto que especifica o comportamento da intercep√ß√£o para cada caso. Para simular campos protegidos e privados, temos que interceptar o acesso √†s propriedades e m√©todos, atrav√©s dos m√©todos <code class='javascript'>get</code> e <code class='javascript'>set</code> da defini√ß√£o do <code class='javascript'>Proxy</code>. Por enquanto vou esconder alguns detalhes da implementa√ß√£o (mais especificamente <code class='javascript'>_hasAccess</code>) pra digerirmos tudo aos poucos.</p>

<div class='codeblock'>
<p>padr√£o proxy</p>
<code class='javascript'
>'use strict';

const _hasAccess = (alvo, propriedade) =&gt; { /* omitido por enquanto, vamos aos poucos ;) */ };

// define o comportamento do proxy
const proxyHandler = {

	/** intercepta leitura dos valores de propriedades e m√©todos */
	get(alvo, propriedade, receiver) {

		// se existe
		if (!(propriedade in alvo)) {
			throw new Error('N√£o existe ou √© privado');
		}

		// se √© vis√≠vel
		if (!_hasAccess(alvo, propriedade)) {
			throw new Error('N√£o existe ou √© privado');
		}

		return Reflect.get(alvo, propriedade, receiver);// Reflect.get encaminha a opera√ß√£o para o alvo
	},

	/** intercepta escrita dos valores de propriedades */
	set(alvo, propriedade, valor, receiver) {

		// se √© vis√≠vel
		if (!_hasAccess(alvo, propriedade)) {
			throw new Error('N√£o existe ou √© privado');
		}

		return Reflect.set(alvo, propriedade, valor, receiver); // Reflect.set encaminha a opera√ß√£o para o alvo
	}

};

// define a classe
class Cupcake {
	constructor() {
		this.cobertura = null;
	}
}

// cria uma inst√¢ncia
const cupcake = new Cupcake();
const cupcakeProxy = new Proxy(cupcake, proxyHandler);
cupcakeProxy.cobertura = 'doce de leite com cereja'; // vai ser interceptado por proxyHandler.set
console.log(cupcakeProxy.cobertura); // vai ser interceptado por proxyHandler.get</code
>
</div>

<p>O comportamento de <code class='javascript'>get</code> e <code class='javascript'>set</code> √© <strong>determinado por algumas invariantes</strong> definidas na <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy/handler' real='external nofollow'>especifica√ß√£o</a> ES6, na qual o JavaScript √© baseado. Essas invariantes garantem que o objeto <code class='javascript'>Proxy</code> seja consistente com o objeto interceptado, podendo substitu√≠-lo de maneira transparente. Infelizmente como efeito colateral, a flexibilidade do <code class='javascript'>Proxy</code> √© reduzida. Por exemplo, <strong>devemos obrigatoriamente mostrar todas as propriedades n√£o configur√°veis.</strong> Se selarmos o objeto com <code class='javascript'>Object.seal</code>, todas as propriedades se tornar√£o n√£o configur√°veis como consequ√™ncia, e portanto devemos mostr√°-las. Tamb√©m devemos retornar o mesmo valor que o objeto retornaria para propriedades somente leitura n√£o configur√°veis, e por a√≠ vai.</p>

<p>Vamos passar para a implementa√ß√£o de <code class='javascript'>_hasAccess</code>.</p>

<div class='codeblock'>
<p>padr√£o proxy</p>
<code class='javascript'
>'use strict';

const _hasAccess = (alvo, propriedade) =&gt; {
	if (propriedade.toString().startsWith('_')) {
		return false;
	}
	return true;
}</code
>
</div>

<p>Nesse caso, <strong>optei</strong> por identificar o controle de visibilidade atrav√©s de uma <strong>conven√ß√£o de nomes</strong> das propriedades. Notem que esta <strong>n√£o √© a √∫nica alternativa para identifica√ß√£o do controle de visibilidade,</strong> embora talvez seja a mais simples. Sinta-se √† vontade para bolar sua pr√≥pria alternativa.</p>

<p>Se as propriedades come√ßarem pelo caractere <q>_</q> (<em>underscore</em>), o <code class='javascript'>Proxy</code> impedir√° seu acesso. Por√©m, ele n√£o funciona t√£o intuitivamente quanto poderia. Vamos ver alguns dos poss√≠veis casos.</p>

<div class='codeblock'>
<p>problemas de proxy</p>
<code class='javascript'
>'use strict';

// define o comportamento do proxy
const proxyHandler = { /* omitido pra ficar mais curto */ };

// define a classe
class Cupcake {

	constructor() {
		Object.defineProperties(this, {
			_cobertura, {value: null, writable: true}, // privado, pois come√ßa com _
			_recheioCk, {value: null, writable: true} // privado, pois come√ßa com _
		});
	}

	<strong>// getters e setters  impl√≠citos</strong>
	<strong class='small'>get cobertura() { return this._cobertura; }</strong>
	set cobertura(valor) { this._cobertura = valor; }
	get recheio() { return this._recheioCk; }
	set _recheio(valor) { this._recheioCk = valor; } // privado, pois come√ßa com _

	<strong>// m√©todos</strong>
	<strong class='small'>usarCobertura() { console.log(this._cobertura); }</strong>

}

// cria uma inst√¢ncia
const cupcake = new Cupcake();
const cupcakeProxy = new Proxy(cupcake, proxyHandler);

// getters e setters impl√≠citos
// seus acessos s√£o interceptados pelo proxy
// mas os acesso feitos dentro do corpo deles n√£o √© vigiado
cupcakeProxy.cobertura = 'creme com suspiro';
<strong>console.log(cupcakeProxy.cobertura);</strong> <strong>// ok. this._cobertura √© acess√≠vel dentro do getter impl√≠cito</strong>
console.log(cupcakeProxy.recheio);
cupcake._recheio = 'creme'; // erro, set _recheio √© private como esperado

// chamada de m√©todo normal
// proxy age diferente nesse caso, interceptando os acessos dentro do corpo do m√©todo tamb√©m
<strong>cupcakeProxy.usarCobertura();</strong> <strong>// erro! n√£o consegue acessar this._cobertura de dentro do m√©todo!</strong></code
>
</div>

<p>Devido √† essa inconsist√™ncia no comportamento do <code class='javascript'>Proxy</code>, temos que acessar algumas coisas atrav√©s do objeto original. Infelizmente a especifica√ß√£o torna isso muito dif√≠cil propositalmente. N√£o existe maneira de saber quem est√° acessando as propriedades. Sendo assim, precisamos dar um jeito de manter o objeto original √† m√£o.</p>

<div class='codeblock'>
<p>encapsulamento com proxies</p>
<code class='javascript'
>'use strict';

// define o comportamento do proxy
const proxyHandler = { /* omitido pra ficar mais curto */ };

// define a classe
class Cupcake {

	constructor() {
		Object.defineProperties(<strong>this</strong>, { <strong>// o construtor deve continuar usando this</strong>
			_cobertura, {value: null, writable: true}, // privado, pois come√ßa com _
			_recheioCk, {value: null, writable: true} // privado, pois come√ßa com _
		});
	}

	<strong>// getters e setters  impl√≠citos</strong>
	get cobertura() { return <strong class='small'>self</strong>._cobertura; }
	set cobertura(valor) { self._cobertura = valor; }
	get recheio() { return self._recheioCk; }
	set _recheio(valor) { self._recheioCk = valor; } // privado, pois come√ßa com _

	<strong>// m√©todos</strong>
	usarCobertura() { console.log(<strong>self</strong>._cobertura); }

}

// cria uma inst√¢ncia
<strong>const self = new Cupcake();</strong>
const cupcakeProxy = new Proxy(self, proxyHandler);

// getters e setters impl√≠citos
// seus acessos s√£o interceptados pelo proxy
// mas os acesso feitos dentro do corpo deles n√£o √© vigiado
cupcakeProxy.cobertura = 'creme com suspiro';
<strong>console.log(cupcakeProxy.cobertura);</strong> <strong>// ok, usa self internamente, que √© a refer√™ncia original sem proxy</strong>
console.log(cupcakeProxy.recheio);
cupcake._recheio = 'creme'; // erro, set _recheio √© private como esperado

// chamada de m√©todo normal
// proxy age diferente nesse caso, interceptando os acessos dentro do corpo do m√©todo tamb√©m
<strong>cupcakeProxy.usarCobertura();</strong> <strong>// ok, usa self internamente, que √© a refer√™ncia original sem proxy</strong></code
>
</div>

<p>Resta ainda facilitarmos o uso desse padr√£o. Fazendo alguns malabarismos com um <code class='javascript'>Proxy</code> a mais, permitimos que os objetos sejam instanciados de maneira transparente. O resultado final √© bastante dif√≠cil de compreender para iniciantes em JavaScript, pois utiliza recursos idiom√°ticos da linguagem. Felizmente seu uso √© bem mais simples.</p>

<div class='codeblock'>
<p>encapsulamento com proxies e factory</p>
<code class='javascript'
>'use strict';

// define o comportamento do proxy
const proxyHandler = { /* omitido pra ficar mais curto */ };

const proxyFactory = (Classe, proxyHandler) => {

	// este proxy extra serve apenas para permitir que instanciemos
	// nosso objeto e o proxy juntos de maneira transparente, com o operador new
	const proxy = new Proxy(class {}, {

		/** intercepta a constru√ß√£o de novos objetos */
		construct(alvo, parametros) {

			// salva o objeto original como self na closure do construtor
			const self = new Classe();

			// faz o contrutor retornar o proxy do objeto ao inv√©s do objeto original
			const proxy = new Proxy(self, proxyHandler);
			return proxy;

		}

	});

	return proxy;

};

// define a classe tendo o cuidado de usar self, com exce√ß√£o do construtor
// note que n√£o √© poss√≠vel instanci√°-la diretamente, pois self s√≥ existir√°
// quando passarmos ela pela proxyFactory
class CupcakeDefinicao {
	constructor() { this._recheio = null; }
	usarRecheio() { console.log(self._recheio); }
}

// define classes filhas, seguindo os mesmos cuidados
class CupcakeCobertoDefinicao extends CupcakeDefinicao {
	constructor() {
		super();
		this._cobertura = null;
	}
	usarCobertura() { console.log(self._cobertura); }
}

// criar helpers para instanciar as classes com proxy
// s√£o estes helpers que expomos para uso geral
const Cupcake = proxyFactory(CupcakeDefinicao, proxyHandler);
const CupcakeCoberto = proxyFactory(CupcakeCobertoDefinicao, proxyHandler);

// instancia e usa as classes de maneira f√°cil e transparente
// pelo menos essa parte √© simples

const cupcakeDeChocolate = new Cupcake();
cupcakeDeChocolate.usarRecheio();

const cupcakeFlorestaNegra = new CupcakeCoberto();
cupcakeFlorestaNegra.usarRecheio();
cupcakeFlorestaNegra.usarCobertura();</code
>
</div>

<p>N√£o sei quanto a voc√™, mas at√© algu√©m aparecer com uma maneira mais simples de controlar a visibilidade com <code class='javascript'>Proxy</code>, eu vou continuar deixando tudo p√∫blico...</p>

<h3>Object.observe</h3>

<p>Caso voc√™ escute por a√≠ sobre <code class='javascript'>Object.observe</code> nativo, saiba que era uma adi√ß√£o na <abbr>API</abbr> que o Google estava fazendo <em>lobbing</em> a favor por causa de seu<em>framework</em> Angular, mas que foi embora mesmo antes de entrar oficialmente. Sua funcionalidade pode ser <a href='https://github.com/anywhichway/proxy-observe' rel=external nofollow>replicada usando proxies</a>.</p>

<!--
<h3 id='proxyManual'>Controle de visibilidade com Proxy N√ÉO nativo</h3>

<p>Embora o <code class='javascript'>Proxy</code> nativo seja mais transparente do que uma alternativa <q>manual</q>, escrita em JavaScript, a alternativa posterior nos d√° a vantagem de podermos decidir sobre as funcionalidades presentes em sua implementa√ß√£o. Isso nos permite por exemplo que o corpo dos m√©todos de nosso objeto n√£o seja interceptado pelo proxy.</p>

<div class='codeblock'>
<p>encapsulamento com proxy e factory</p>
<code class='javascript'
>'use strict';

// TODO
class ProxyVisibilidade {
	constructor(Classe) {
		// copiar os m√©todos p√∫blicos
		// acessar as propriedades p√∫blicas atrav√©s de getters e setters
	}
}
</code
>
</div>
-->

<h3>Controle de visibilidade com closures</h3>

<p>A classe <code class='javascript'>Proxy</code> pode nos ajudar com o controle de visibilidade das propriedades. Para casos mais simples, ou para ambientes onde ela n√£o est√° dispon√≠vel, podemos usar <em>closures</em> para simular esta funcionalidade, como vimos em <q>tirando coisas do escopo</q>. Primeiro <strong>criamos um escopo</strong> usando <abbr>AMD</abbr>, ou uma fun√ß√£o an√¥nima autoexecut√°vel, ou uma fun√ß√£o construtora, e <q>vazamos</q> desse escopo a parte que queremos usar como interface de nosso objeto. Este objeto ser√° usado de maneira transparente, sem ningu√©m precisar saber que sua funcionalidade est√° fragmentada internamente. O exemplo abaixo mostra o essencial deste procedimento.</p>

<div class='codeblock'>
<p>encapsulamento com proxy e factory</p>
<code class='javascript'
>'use strict';

<strong>// estilo AMD</strong>
<strong class='small'>define('objeto', () => {</strong>

	const publico = {
		// acessar privado aqui dentro
	};

	const privado = {
		// se necess√°rio, pode acessar publico
	};

	<strong>return publico;</strong> <strong>// exp√µe apenas a interface p√∫blica</strong>

<strong>});</strong>

<strong>// ou estilo fun√ß√£o an√¥nima autoexecut√°vel</strong>
<strong class='small'>const objeto = (() => {</strong>

	const publico = {
		// acessar privado aqui dentro
	};

	const privado = {
		// se necess√°rio, pode acessar publico
	};

	<strong>return publico;</strong> <strong>// exp√µe apenas a interface p√∫blica</strong>

<strong>})();</strong></code
>
</div>

<p>Um exemplo mais completo.</p>

<div class='codeblock'>
<p>encapsulamento com closures</p>
<code class='javascript'
>'use strict';

const matador = (function() {

	const publico = {

		matarACobra() {
			privado.matar();
		},

		get pau() {
			return privado.pau;
		}

	};

	const privado = {

		matar: function() {
			this.pau = 'quebrou';
		},

		pau: '√© feito de madeira!'

	};

	return publico;

})();

matador.matarACobra();
console.log(matador.pau); // mostra o pau ;)</code
>
</div>

<p><strong>Este padr√£o n√£o √© compat√≠vel com heran√ßa,</strong> pois a <em>closure</em> √© compartilhada com todos os objetos do mesmo tipo e seus subobjetos.</p>

<div class='codeblock'>
<p>encapsulamento com closures e factory</p>
<code class='javascript'
>'use strict';

<strong>// N√ÉO COPIE!!! APENAS PARA DEMONSTRA√á√ÉO!!!!</strong>

const matador = algumMetodoQueUsaClosurePraSimularPrivate();

// n√£o vai fazer o qu√™ voc√™ espera!
const matador1 = Object.create(matador);
const matador2 = Object.create(matador);

matador1.matarACobra();
console.log(matador2.pau); // erro, pois matarACobra alterou a propriedade dos dois matadores</code
>
</div>

<p>√â poss√≠vel criar <strong>c√≥pias da closure</strong> usando um padr√£o <em>factory</em>. Embora consigamos centralizar a defini√ß√£o da parte <em>private</em>, perdemos o benef√≠cio de economizarmos mem√≥ria mantendo refer√™ncias dos m√©todos.</p>

<div class='codeblock'>
<p>encapsulamento com closures e factory</p>
<code class='javascript'
>'use strict';

const matadorFactory = () => {

	const publico = {

		matarACobra() {
			privado.metodoInterno();
		},

		get pau() {
			return privado.propriedadeInterna;
		}

	};

	const privado = {

		metodoInterno: function() {
			console.log('m√©todo interno');
		},

		propriedadeInterna: '√© feito de madeira!'

	};

	return publico;

};


const matador1 = matadorFactory();
const matador2 = matadorFactory();
matador1.matarACobra();
console.log(matador2.pau); // ok</code
>
</div>

</section>



<section>

<h2 id='async'>Async <span>Yoda as coisas ordenando pode estar</span></h2>

<p>C√≥digo ass√≠ncrono, ou <em>async</em>, √© uma maneira de evitar esperas longas em chamadas de fun√ß√µes que podem demorar muito para retornarem. Sendo mais t√©cnico, evita que determinadas fun√ß√µes bloqueiem a execu√ß√£o da <em>thread</em> em que est√£o rodando. Especialmente √∫til em JavaScript onde o conceito de <em>threads</em> (atrav√©s de <em>web workers</em>) √© relativamente novo, e a maioria do c√≥digo ainda tende a ser executado na <em>thread</em> da interface gr√°fica. O exemplo mais comum disso talvez sejam fun√ß√µes que executam requisi√ß√µes http. C√≥digo ass√≠ncrono permite que o processador fique livre para executar outras instru√ß√µes como computar as intera√ß√µes do usu√°rio, enquanto espera o retorno da requisi√ß√£o por exemplo.</p>

<p>Muito importante para a compreens√£o do <em>async</em> em JavaScript √© o conceito de <a href='https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop' rel='external nofollow'><em>event loop</em></a>. Ele se trata de uma fila de execu√ß√£o de blocos de c√≥digo. O que define a divis√£o entre um bloco e outro √© o n√≠vel de empilhamento das fun√ß√µes executadas. Quando chamamos uma fun√ß√£o dentro de outra, esta segunda fun√ß√£o √© empilhada em cima da primeira. Quando sua execu√ß√£o termina, ela √© desempilhada, e o controle da execu√ß√£o volta √† primeira fun√ß√£o da pilha. Quando esta fun√ß√£o por sua vez, termina a execu√ß√£o, todas as fun√ß√µes s√£o desempilhadas e o bloco de c√≥digo chega ao fim. <strong>O modelo de execu√ß√£o de JavaScript garante que um bloco de c√≥digo n√£o pode ser interrompido antes de chegar ao fim, eliminando erros de concorr√™ncia.</strong> O que as fun√ß√µes ass√≠ncronas fazem √© executar determinadas linhas <strong>entre os blocos de c√≥digo</strong> de maneiras variadas.</p>

<p>Outra caracter√≠stica das fun√ß√µes <em>async</em> √© que elas tendem a mudar o contexto de execu√ß√£o para a <code class='javascript'>window</code>, e portanto cuidados adicionais devem ser tomados no uso de <code class='javascript'>this</code>.</p>

<p>Vamos ver algumas formas de c√≥digo ass√≠ncrono.</p>

<h3 id='eventos'>Eventos</h3>

<p>J√° andamos flertando com eventos em diversos de nossos exemplos. Agora temos conhecimento suficiente para os vermos mais detalhadamente.</p>

<p>Eventos s√£o a implementa√ß√£o nativa do padr√£o de projeto (<em>design pattern</em>) chamado <a href='https://sourcemaking.com/design_patterns/observer'><em>Observer</em></a>. √â usada mais frequentemente na interface gr√°fica para responder √†s a√ß√µes do usu√°rio como cliques do mouse ou scroll da p√°gina, e outros eventos como o carregamento completo da p√°gina e requisi√ß√µes http. Eventos adicionam um <em>callback</em> na fila do <em>event loop</em> assim que s√£o disparados, e seus observadores s√£o notificados assim que todas as fun√ß√µes sendo atualmente executadas sejam desempilhadas.</p>

<p>Para indicar que estamos interessados num determinado evento, usamos o m√©todo <code class='javascript'>addEventListener</code>. <strong>Devemos desregistrar o evento quando n√£o estamos mais interessados</strong> nele, atrav√©s de <code class='javascript'>removeEventListener</code>, para evitar uso desnecess√°rio de mem√≥ria e tornar o coletor de lixo mais lento. IE8- utiliza um outro m√©todo n√£o padronizado para registrar eventos, e nesses casos √© necess√°rio o uso de um <em>fallback</em>.</p>

<div class='codeblock'>
<p>eventos</p>
<code class='javascript'
>'use strict';

// evento de clique num bot√£o, pode acontecer diversas vezes

const botao = document.getElementById('botao');
botao.addEventListener('click', (evento) => {
	// botao guarda esse callback e o executa apenas quando √© clicado
	// o callback de addEventListener recebe informa√ß√µes sobre o evento ocorrido
	// tais como qual a tecla pressionada, ou quem disparou o evento atrav√©s
	// do objeto evento
	evento.target.value = 'clicou'; // muda o texto do bot√£o clicado para clicou
});

// evento de conclus√£o da requisi√ß√£o http, acontece apenas uma vez

function requisicaoLoad(evento) {
	console.log(requisicao.responseText); // mostra a resposta da requisi√ß√£o
	evento.target.removeEventListener('load', requisicaoLoad); // remove o listener da requisicao e libera mem√≥ria
}

const requisicao = new XMLHttpRequest();
requisicao.addEventListener('load', requisicaoLoad); // requisicao guarda esse callback e o executa apenas quando receber uma resposta
requisicao.open('GET', 'lista.json');
requisicao.send();</code
>
</div>

<h3>setTimeout, setInterval e requestAnimationFrame</h3>

<p>Estas fun√ß√µes s√£o na verdade m√©todos do objeto <code class='javascript'>window</code> que faz parte do <abbr title='Document Object Model'>DOM</abbr>. Assim como outros m√©todos ass√≠ncronos, elas adicionam um <em>callback</em> na fila do <em>event loop</em>. O que diferencia essas fun√ß√µes <em>async</em> √© que podemos determinar um tempo de espera para a execu√ß√£o do <em>callback</em>. Ou seja, assim que o tempo determinado chegar, o ambiente de execu√ß√£o ir√° esperar que todas as fun√ß√µes sendo atualmente executadas sejam desempilhadas, e ent√£o executar√° o <em>callback</em>, ficando desbloqueado nesse meio tempo de espera.</p>

<div class='codeblock'>
<p>async e tempos de espera</p>
<code class='javascript'
>'use strict';

const time = 1000; // 1 segundo, ou 1000 milissegundos

const intervalId = setInterval(() => {
	// vai executa aproximadamente a cada 1 segundo
	// cancela com clearInterval(intervalId);
}, time);

const timeoutId = setTimeout((evento) => {
	// vai executar uma √∫nica vez em aproximadamente 1 segundo
	// cancela com clearTimeout(timeoutId);
}, time);

setTimeout((evento) => {
	// vai executar quase que imediatamente
	// usado principalmente para prevenir bloqueios muito longos na thread
	// pois o c√≥digo entra na fila do event loop ao inv√©s de ser empilhado
}, 0);

requestAnimationFrame((timestamp) => {
	// parecido com setTimeout 0, mas
	// vai executar no pr√≥ximo quadro
});</code
>
</div>

<p><code class='javascript'>setTimeout</code> e <code class='javascript'>requestAnimationFrame</code> t√™m um outro uso secund√°rio, que √© evitar que o navegador <q>coma</q> alguns passos que ele julgar desnecess√°rios.</p>

<div class='codeblock'>
<p>animacao.css</p>
<code class='css bubaloop'
><span class='comment'>/* Indica que a mudan√ßa de cor do elemento devem ser animada */</span>
<span class='selector'>#elementoAnimado</span> <span class='punctuation'>{</span>
	<span class='property'>transition</span><span class='punctuation'>:</span> <span class='value'>color 300ms</span><span class='punctuation'>;</span>
<span class='punctuation'>}</span></code
>
</div>

<div class='codeblock'>
<p>animacao.js</p>
<code class='javascript'
>'use strict';

const div = document.getElementById('elementoAnimado');
const preto = '#000000';
const branco = '#ffffff';

div.style.color = preto; // o navegador ir√° ignorar esta linha por motivos de performance
div.style.color = branco; // pois esta linha j√° anula a anterior muito rapidamente

// infelizmente o comportamento acima impede que nossa anima√ß√£o seja executada
// a maneira de impedir essa "otimiza√ß√£o" √© indicar que queremos mudar de cor
// assim que poss√≠vel, mas n√£o imediatamente, utilizando uma das formas abaixo

div.style.color = preto;

setTimeout(() => {
	div.style.color = branco;
}, 0);

// ou

div.style.color = preto;

requestAnimationFrame((timestamp) => {
	div.style.color = branco;
});</code
>
</div>

<p>Quando desejamos criar anima√ß√µes por programa√ß√£o ou fazermos um la√ßo principal, como em jogos, √© mais apropriado utilizar a fun√ß√£o <code class='javascript'>requestAnimationFrame</code>, que est√° dispon√≠vel √† partir do IE10.</p>

<div class='codeblock'>
<p>requestAnimationFrame loop</p>
<code class='javascript'
>'use strict';

// executa a fun√ß√£o a cada quadro que o navegador mostrar
// o mais comum √© cham√°-la numa taxa de 60Hz, ou 16,66ms
// mais isso varia de acordo com o monitor, placa de v√≠deo, etc.
gameLoop(timestamp) {
	// executar a l√≥gica do quadro aqui
	requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);</code
>
</div>

<h3 id='promise'>Promises nativas</h3>

<p>Surgindo em diversas linguagens nos √∫ltimos tempos, JavaScript tamb√©m tem uma implementa√ß√£o nativa de <em>Promises</em>, que j√° eram dispon√≠veis atrav√©s de bibliotecas como <a href='https://github.com/kriskowal/q'>Q</a> (usada no Angular) e <a href='https://github.com/tildeio/rsvp.js/'>RSVP</a> (usada no Ember). <em>Promises</em> em JavaScript adicionam um <em>callback</em> ao <em>event loop</em> assim que s√£o cumpridas.</p>

<div class='codeblock'>
<p>sintaxe nativa de promises</p>
<code class='javascript'
>'use strict';

function algumaCoisaAsync() {

	const promessa = new Promise((resolve, reject) => {
		// fazer alguma coisa demorada e se sucesso:
		resolve(algumValorOpcional);
		// ou se erro
		reject('motivo');
	});

	return promessa;

}

algumaCoisaAsync()
	.then((algumValorOpcional) => {
		// executar algo depois da opera√ß√£o async
	});</code
>
</div>

<p>O prop√≥sito de fazer promessas, ao contr√°rio do que dizem as m√°s l√≠nguas, n√£o √© quebr√°-las, mas sim tornar a execu√ß√£o do seu c√≥digo ass√≠ncrono mais linear. Eventos previstos para disparar apenas uma √∫nica vez s√£o bons candidatos para a convers√£o em promessas.</p>

<p>O que antigamente seria escrito como:</p>

<div class='codeblock'>
<p>requisi√ß√£o xml http cl√°ssica com eventos e callbacks</p>
<code class='javascript'
>'use strict';

function transferComplete(evento) {
	// fazer algo e ent√£o
	evento.target.removeEventListener('load', transferComplete);
}

function transferFailed(evento) {
	// fazer algo e ent√£o
	evento.target.removeEventListener('load', transferComplete);
}

let requisicao = new XMLHttpRequest();
requisicao.addEventListener('load', transferComplete);
requisicao.addEventListener('error', transferFailed);
requisicao.open('GET', 'lista.json');
requisicao.send();</code
>
</div>

<p>Agora pode ser escrito como:</p>

<div class='codeblock'>
<p>requisi√ß√£o xml http com promises</p>
<code class='javascript'
>'use strict';

requisicao('GET', 'lista.json')
	.then(
		resposta =&gt; console.log(resposta),
			erro =&gt; console.log(erro)
		);</code
>
</div>

<p>Desde que voc√™ escreva um <a href='http://www.html5rocks.com/en/tutorials/es6/promises/#toc-promisifying-xmlhttprequest' rel='external nofollow'><em>wrapper</em> bonitinho</a> ao redor das chamadas para as requisi√ß√µes.</p>

<p>Concordo que o exemplo acima n√£o √© muito impressionante. A real for√ßa das promessas vem do amor S2. Opa, n√£o n√£o, quero dizer, a real for√ßa das promessas pode ser vista quando temos que encadear ou executar em "paralelo" v√°rias chamadas ass√≠ncronas. Digo "paralelo" porque paralelismo em JavaScript √© um caso √† parte. N√£o vai achar que funciona igual que no C que o seu av√¥ usou pra programar o <a href='https://en.wikipedia.org/wiki/Pong#/media/File:Pong.png' rel='external nofollow'>Pong original</a>, n√©? Vamos por enquanto s√≥ ver exemplos pr√°ticos ao que diz respeito √†s promessas.</p>

<p>Digamos que voc√™ queira o endere√ßo e fuso hor√°rio de um local qualquer. Uma abordagem ing√™nua poderia gerar isso:</p>

<div class='codeblock'>
<p>macarr√£o de requisi√ß√µes e callbacks</p>
<code class='javascript'
>'use strict';

// passo 2
function requisitar(endereco, callback) {
	let requisicao = new XMLHttpRequest();
	requisicao.addEventListener('load', callback);
	requisicao.open('GET', endereco);
	requisicao.send();
}

// passo 3
function localizacaoLoaded(resposta) {
	requisitar('geocode', geocodeLoaded);
	requisitar('fusoHorario', fusoHorarioLoaded);
}

// passos 4 e 5

function geocodeLoaded(resposta) {
	resultados.endereco = resposta;
	resultados.semaforo++;
	pronto();
}

function fusoHorarioLoaded(resposta) {
	resultados.fusoHorario = resposta;
	resultados.semaforo++;
	pronto();
}

// passo 7
function pronto() {
	if (resultados.semaforo === 2) {
		finalmente();
	}
}

// passo 8 (final)
function finalmente() {
	// quer ao sugo, marinara ou alho e √≥leo?
}

// passo 6
var resultados = {
	semaforo = 0,
	endereco: null,
	fusoHorario = null
};

// passo 1
requisitar('localizacao', localizacaoLoaded);</code
>
</div>

<p>Claro que poder√≠amos organizar a l√≥gica acima de diversas maneiras, evitando vari√°veis globais, etc. Por√©m, notem como promessas fornecem uma solu√ß√£o flex√≠vel para o problema em quest√£o, e tamb√©m reaproveit√°vel para outros padr√µes de execu√ß√£o ass√≠ncronos.</p>

<div class='codeblock'>
<p>requisi√ß√µes organizadas com promises</p>
<code class='javascript'
>'use strict';

requisicao('localizacao')
	.then((resposta) =&gt; {
		const coordenadas = `?lat=${resposta.latitude}&amp;lng=${resposta.longitude}`;
		// executa duas requisi√ß√µes em paralelo, ap√≥s a
		// requisi√ß√£o original ter conclu√≠do
		return Promise.all([
			requisicao('geocode' + coordenadas),
			requisicao('fusoHorario' + coordenadas)
		]);
	})
	.then((respostas) =&gt; {
		const endereco = respostas[0];
		const fusoHorario = respostas[1];
		// exercite sua criatividade aqui ;)
	});</code
>
</div>

<p>Bem melhor n√£o √©? O procedimento necess√°rio para encadear v√°rias a√ß√µes ass√≠ncronas √© retornar uma nova promessa dentro do then da promessa anterior. No nosso exemplo, Promise.all faz exatamente isso, retorna uma nova promessa que ser√° cumprida assim que todas as requisi√ß√µes completarem. Maios ou menos como uma <a href='https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/CyclicBarrier.html' rel='external nofollow'>barreira c√≠clica</a>, s√≥ que com promessas ao inv√©s de <em>threads</em>.</p>

<p>N√£o por acaso, um tempo atr√°s li uma conversa (no mesmo link acima do wrapper bonitinho) de que promessas poderiam ser usadas justamente para padronizar v√°rias APIs ass√≠ncronas que foram sendo inclusas na linguagem ao longo dos tempos, tais como queries em IndexedDBs, requisi√ß√µes http, acesso √† arquivos, etc. √â pagar pra ver.</p>

<h3 id='deferred'>Deferreds</h3>

<p>Promises requerem que voc√™ j√° saiba como v√£o resolv√™-las, logo que elas s√£o criadas. Se voc√™ n√£o souber, pode implementar um objeto <em>deferred</em>, que permite postergar esta decis√£o.</p>

<div class='codeblock'>
<p>deferreds</p>
<code class='javascript'
>'use strict';

class Deferred {

	constructor() {

		Object.defineProperties(this, {
			_promise: {writable: true, value: null},
			_resolve: {writable: true, value: null},
			_reject: {writable: true, value: null}
		});

		Object.seal(this);

		this._promise = new Promise(((resolve, reject) =&gt; {
			this._resolve = resolve;
			this._reject = reject;
		}).bind(this));

	}

	resolve(value) {
		return this._resolve(value);
	}

	reject(reason) {
		return this._reject(reason);
	}

	then(callbackAsync) {
		return this._promise.then(callbackAsync);
	}

};

// promises sabem como ser√£o resolvidas no momento da cria√ß√£o obrigatoriamente
const promise = new Promise((resolve, reject) => {
	// se nao definirmos aqui, a promessa nunca ser√° cumprida
	setTimeout(() => {
		resolve();
	}, 1000);
});

// deferreds podem ter seu modo de resolu√ß√£o determinado depois de sua cria√ß√£o
// criamos o objeto sem indicar mais nada
const deferred = new Deferred();

// ent√£o podemos pass√°-lo para m√©todos
// retorn√°-lo dentro de fun√ß√µes
// armazenar em arrays
// e s√≥ depois decidir quando chamar resolve ou reject neles
setTimeout(() => {
	deferred.resolve();
}, 1000);</code
>
</div>

<h3 id='generator'>Generators</h3>

<p>Tenho sentimentos confusos quanto √† utilidade desta funcionalidade (que por si s√≥ j√° √© confusa pra c@#$%‚ò†), uma vez que o conceito de <em>generators</em> j√° existe h√° tempos em <a href='https://en.wikipedia.org/wiki/Generator_(computer_programming)' rel='external nofollow'>outras linguagens</a> (C++, C#, Java e Python s√£o exemplos) e n√£o vejo pessoas dizendo como isso revolucionou o modo como elas programam. Mas sinto que n√£o √© o que est√° tentando se fazer parecer quanto a <em>generators</em> em JavaScript. Vai entender.</p>

<p>A implementa√ß√£o nativa deste conceito deveria facilitar a cria√ß√£o de <em>generators</em> e iterators. Mas sinceramente n√£o funciona t√£o bem para todos os casos. De fato, o caso mais simples para o qual eles foram criados parece ser o menos beneficiado pela implementa√ß√£o nativa, e as alternativas escritas utilizando objetos, <a href='https://en.wikipedia.org/wiki/Function_object' rel='external nofollow'>functors ou closures</a> s√£o bastante atraentes. O principal motivo de tanto frisson parece ser o uso n√£o t√£o √≥bvio dos <em>generators</em> para mais um modelo de execu√ß√£o ass√≠ncrona (quantos n√≥s j√° temos at√© agora? J√° perdi a conta).</p>

<p>Mas chega de falar e vamos mostrar algum c√≥digo. Gerar ou percorrer uma cole√ß√£o de itens em partes, a fim de distribuir o tempo de processamento, parece ser o prop√≥sito mais comum. Para tanto, precisamos de um meio de guardar em que peda√ßo da cole√ß√£o n√≥s paramos. Vamos comparar as poss√≠veis implementa√ß√µes.</p>

<p>Primeiro usando objetos simples para guardar o estado do processo todo.</p>

<div class='codeblock'>
<p>guardando estado entre chamadas de fun√ß√µes com objetos</p>
<code class='javascript'
>'use strict';

let colecao = {

	// propriedades
	itensPorPagina: 0,
	marcador: 0,
	pagina: null,
	valor: obterArrayMagicamente(),

	// m√©todos
	paginar: function(itensPorPagina) {
		if (this.marcador &lt; this.valor.length) {
			this.pagina =  this.valor.slice(
				this.marcador,
				this.marcador + itensPorPagina
			);
			this.marcador += itensPorPagina;
		}
		return this.pagina;
	}

};

function clickHandler() {
	colecao.paginar();
	// colecao.pagina cont√©m os resultados
	// mostrar a p√°gina
}

colecao.itensPorPagina = 10;
botaoProximo.addEventListener('click', clickHandler);</code
>
</div>

<p>Agora utilizando um estilo funcional, com closures:</p>

<div class='codeblock'>
<p>guardando estado entre chamadas de fun√ß√µes com closures</p>
<code class='javascript'
>'use strict';

function getPaginador(colecao, itensPorPagina) {

	// vari√°veis capturadas pela closure
	const total = colecao.length;
	let marcador = 0;
	let pagina = null;

	// fun√ß√£o da closure
	return function paginar() {

		if (marcador &lt; total) {
			pagina =  colecao.slice(
				marcador,
				marcador + itensPorPagina
			);
			marcador += itensPorPagina;
		}

		return pagina;

	}

}

const colecao = obterArrayMagicamente();
const paginar = getPaginador(colecao, 10);
let pagina = null;

function clickHandler() {
	pagina = paginar();
	// mostrar a p√°gina
}

botaoProximo.addEventListener('click', clickHandler);</code
>
</div>

<p>Poder√≠amos ainda criar uma implementa√ß√£o adicionando as propriedades de estado diretamente nas fun√ß√µes (uma vez que em JavaScript elas s√£o objetos din√¢micos), mas acho que voc√™ j√° deve ter pego o esp√≠rito da coisa.</p>

<p>As maneira que as fun√ß√µes generator nativas exp√µem para guardar as informa√ß√µes de que precisaremos, √© permitir sua interrup√ß√£o e retomada quando n√≥s quisermos, atrav√©s de instru√ß√µes espec√≠ficas e de um iterator. Ela pode ser escrita da seguinte maneira:</p>

<div class='codeblock'>
<p>guardando estado entre chamadas de fun√ß√µes com generators</p>
<code class='javascript'
>'use strict';

// declaramos generators com "function*"
function* paginar(colecao, itensPorPagina) {

	const total = colecao.length;
	let marcador = 0;

	while(marcador &lt; total) {

		// "yield" pausa a execu√ß√£o da fun√ß√£o
		// e permite resumi-la depois neste mesmo ponto
		// "yield" tamb√©m pode retornar um valor, assim
		// como "return", mas sem terminar a fun√ß√£o
		yield colecao.slice(marcador, marcador + itensPorPagina);

		marcador += itensPorPagina;

	}

}

let colecao = obterArrayMagicamente();
let paginador = paginar(colecao, 10);
let pagina = null;

function clickHandler() {

	// o m√©todo "next" executa a fun√ß√£o de onde parou
	// at√© encontrar uma instru√ß√£o "yield"
	pagina = paginador.next();

	// al√©m do valor retornado por "yield", "next" tamb√©m indica
	// se a fun√ß√£o terminou definitivamente com um "return"
	// e nesse caso done teria o valor true
	// ou se apenas foi interrompida com "yield", e nesse caso
	// done teria o valor false, e podemos chamar "next" novamente
	if (!pagina.done) {
		// pagina.value cont√©m os resultados
		// mostrar a p√°gina
	}

}

botaoProximo.addEventListener('click', clickHandler);</code
>
</div>

<p>Simplificando, uma fun√ß√£o normal quando chamada, recebe alguns par√¢metros e executa at√© o fim, retornando um valor. Uma fun√ß√£o <em>generator</em> nativa pode ter <q>chamadas parciais</q>, retornando resultados parciais, antes de terminar sua execu√ß√£o completa retornando um valor. Fazemos isso atrav√©s do m√©todo <code class='javascript'>next</code> do iterador que ela retorna e da palavra-chave <code class='javascript'>yield</code>.</p>

<p>Agora, porque foi utilizado o padr√£o de itera√ß√£o:</p>

<div class='codeblock'>
<p>iterador estilo JavaScript ES6</p>
<code class='javascript'
>'use strict';

do {
	resultado = iterador.next();
	if (resultado.value) { // verifica antes de usar resultado.value
		// pode usar resultado.value
	}
} while (!resultado.done)</code
>
</div>

<p>Ao inv√©s dos mais conhecidos, e que me parecem ligeiramente mais intuitivos:</p>

<div class='codeblock'>
<p>iterador estilo Java e C#</p>
<code class='javascript'
>'use strict';

while (iterator.hasNext()) {
	resultado = iterator.next(); // use resultado sem medo, ele sempre ser√° v√°lido
}

while (iterator.MoveNext()) {
	resultado = iterator.Current; // use resultado sem medo, ele sempre ser√° v√°lido
}</code
>
</div>

<p>Eu acho que n√£o vou descobrir t√£o cedo. Quero dizer, n√£o √© o iterador que terminou? Ent√£o n√£o √© ele que deveria dizer isso? Qual o motivo de colocar essa informa√ß√£o no resultado??</p>

<p>De qualquer maneira. As chamadas parciais √† fun√ß√£o <em>generator</em> tamb√©m podem receber argumentos. Fazemos isso passando um par√¢metro na chamada do <code class='javascript'>next</code>. Para manter os exemplos simples, nosso paginador at√© agora s√≥ foi capaz de avan√ßar. Vou continuar com a demonstra√ß√£o dessa funcionalidade duvidosa, adicionando a possibilidade do paginador tamb√©m voltar (tipo um revival do passado :P ), passando para <code class='javascript'>next</code> o argumento necess√°rio.</p>

<div class='codeblock'>
<p>paginador usando generators</p>
<code class='javascript'
>'use strict';

const AVANCAR = 1;
const VOLTAR  = -1;

function* paginar(colecao, itensPorPagina) {

	const total = colecao.length;
	let marcador = 0;
	let direcao = yield; // inicia "direcao" antes do loop

	while(marcador &gt;= 0 &amp;&amp; marcador &lt; total) {
		direcao = yield colecao.slice(
			marcador,
			marcador + itensPorPagina
		);
		marcador += itensPorPagina * direcao;
	}

}

let resultados = obterArrayMagicamente();
let paginador = paginar(resultados);

// prepara o paginador para iniciar direcao
paginador.next();

function clickAnteriorHandler() {
	mostrar(VOLTAR);
}

function clickProximoHandler() {
	mostrar(AVANCAR);
}

let result = null;
let pagina = null;

function mostrar(direcao) {
	result = paginador.next(direcao);
	if (!result.done) {
		pagina = result.value;
		// mostrar a p√°gina
	}
}

botaoAnterior.addEventListener('click', clickAnteriorHandler);
botaoProximo.addEventListener('click', clickProximoHandler);</code
>
</div>

<p>Se quisermos implementar nosso pr√≥prio iterador, que funcione com a sintaxe <code class='javascript'>for of</code>, nossa classe deve implementar um m√©todo especial chamado <code class='javascript'>[Symbol.iterator]</code>. Como esse m√©todo precisa ser um <em>generator</em>, usamos uma sintaxe especial para indicar isso, precedendo o nome do m√©todo com um <code class='javascript'>*</code>.</p>

<div class='codeblock'>
<p>Paginador usando Symbol.iterator</p>
<code class='javascript'
>'use strict';

class Paginador {

	constructor(colecao, itensPorPagina) {

		Object.defineProperties({
			_colecao: {value: colecao},
			_total: {value: colecao.length},
			_itensPorPagina: {value: itensPorPagina, writable: true},
			_marcador: {value: 0, writable: true}
		});

		Object.seal(this);

		this.reset();

	}

	// iterador for of
	*[Symbol.iterator]() {
		if(this._marcador &lt; this._total) {
			yield colecao.slice(
				this._marcador,
				this._marcador + this._itensPorPagina
			);
			this._marcador += this._itensPorPagina;
		}
	}

	reset() {
		this._marcador = 0;
	}

}

let colecao = obterArrayMagicamente();
let paginador = new Paginador(colecao, 10);

for (let paginas of paginador) {
	console.log(paginas);
}</code
>
</div>

<p>Como nada disso me parece novo ou incrivelmente √∫til, vou logo passar para a outra funcionalidade que comentei l√° em cima. A de que <em>generators</em> podem ser usados como mais uma alternativa de modelo de execu√ß√£o ass√≠ncrono, muito parecida com o <code class='generic'><span class='keyword'>async</span></code> e <code class='generic'><span class='keyword'>await</span></code> do C#. Essa ideia parece ser forte o suficiente a ponto de ter motivado uma <a href='https://github.com/tc39/ecmascript-asyncawait' rel='external nofollow'>nova proposta</a> ao comit√™ t√©cnico (TC39, que padroniza a especifica√ß√£o a qual o JavaScript se baseia), bem como a cria√ß√£o da biblioteca <a href='https://github.com/tj/co' rel='external nofollow'>co</a>.Uma vez que temos uma interface padronizada para identificar, pausar e resumir fun√ß√µes, podemos escrever uma fun√ß√£o de ordem superior que controle a execu√ß√£o dos <em>generators</em>.</p>

<div class='codeblock'>
<p>simulando async e await do C#</p>
<code class='javascript'
>'use strict';

// fun√ß√£o de controle + function* √© quase como async
// e yield como await
controle(function*() {
	yield metodoAsync();
	yield outroMetodo();
});</code
>
</div>

<p>Tal fun√ß√£o de controle n√£o √© t√£o simples de ser escrita, uma vez que uma implementa√ß√£o simplicista pode n√£o prover toda a fluidez de execu√ß√£o que o modelo ass√≠ncrono disponibiliza, causar pilhas de execu√ß√£o muito grandes, etc. j√° que √© necess√°rio conhecimento moderado de como funciona o modelo de execu√ß√£o do JavaScript, o vulgo event loop. Se este √© um modelo t√£o mais pr√°tico em JavaScript que do que outras alternativas eu n√£o sei dizer. Certamente preciso escrever v√°rios testes antes de decidir. Apenas gostaria que as pessoas escolhessem um modelo ass√≠ncrono e ficassem com ele, ao inv√©s de ficarem adicionando mais e mais alternativas, deixando tudo labirintoso.</p>

<h3>Web Workers (Threads)</h3>

<p>Threads em JavaScript funcionam de maneira diferente das funcionalidades equivalentes em outras linguagens. Elas n√£o compartilham mem√≥ria. A maneira de se comunicarem √© atrav√©s de troca de mensagens, que possui limita√ß√µes sobre o tipo de objeto que pode ser enviado. De fato, threads de outras linguagens se parecem mais com o que conseguimos simular com <code class='javascript'>setTimeout</code> e <code class='javascript'>setInterval</code> do que com objetos <code class='javascript'>Worker</code>. Worker threads n√£o conseguem de maneira nenhuma acessar a interface gr√°fica.</p>

<div class='codeblock'>

<p>JavaScript - main.js</p>
<code class='javascript'
>'use strict';

// cria a worker thread de uso exclusivo
// da main thread
let webWorker = new Worker('worker.js');

// web workers n√£o compartilham mem√≥ria
// apenas trocam mensagens entre si
// e n√£o podem acessar o DOM

// envia mensagens para a worker thread
webWorker.postMessage(['algum', 'valor']);
webWorker.postMessage([10, 20]);

// callback para recep√ß√£o de mensagens
// da worker thread
webWorker.onmessage = (event) => {
	console.log(event.data);
};

// mata a thread imediatamente se quiser
// webWorker.terminate();</code
>

<p>JavaScript - worker.js</p>
<code class='javascript'
>'use strict';

// callback para recep√ß√£o de mensagens
// da main thread (ui thread)
onmessage = (event) => {

	console.log(event.data[0]);
	console.log(event.data[1]);
	let result = event.data.join(' ');

	// envia mensagens para a main thread
	postMessage(result);

	// termina a thread se quiser
	// close();

};</code
>

</div>

<div class='codeblock'>

<p>JavaScript - sharedThread1.js</p>
<code class='javascript'
>'use strict';

<strong>// cria uma worker thread compartilhada</strong>
let <strong class='small'>webWorkerOp1</strong> = new <strong class='small'>SharedWorker(</strong>'worker.js'<strong class='small'>);</strong>

// envia mensagens para a worker thread compartilhada
webWorkerOp1<strong>.port</strong>.postMessage(['algum', 'valor']);
webWorkerOp1<strong>.port</strong>.postMessage([10, 20]);

// callback para recep√ß√£o de mensagens
// da worker thread
webWorkerOp1<strong>.port</strong>.onmessage = (event) => {
	console.log(event.data);
};</code
>

<p>JavaScript - sharedThread2.js</p>
<code class='javascript'
>'use strict';

// cria uma worker thread compartilhada
let <strong>webWorkerOp2</strong> = new <strong>SharedWorker(</strong>'worker.js'<strong>);</strong>

// envia mensagens para a worker thread compartilhada
webWorkerOp2<strong>.port</strong>.postMessage(['misturar', 2]);
webWorkerOp2<strong>.port</strong>.postMessage([10, 20]);

// callback para recep√ß√£o de mensagens
// da worker thread
webWorkerOp2<strong>.port</strong>.onmessage = (event) => {
	console.log(event.data);
};</code
>

<p>JavaScript - worker.js</p>
<code class='javascript'
>'use strict';

<strong>onconnect = (event) => {</strong>

	<strong>let port = event.ports[0];</strong>

	// callback para recep√ß√£o de mensagens
	// da main thread (ui thread)
	<strong>port.</strong>onmessage = (event) => {

		console.log(event.data[0]);
		console.log(event.data[1]);
		let result = event.data.join(' ');

		// envia mensagens para a main thread
		<strong>port.</strong>postMessage(result);

		// termina a thread se quiser
		// close();

	};

<strong>};</strong></code
>

</div>

</div>

</section>



<section>

<h2>Nota final</h2>

<p>Podemos verificar nosso c√≥digo com ESLint, JSHint ou JSLint, que nos d√£o dicas para melhor√°-lo.</p>

</section>

<section>

<h2>Ap√™ndice</h2>

<p>SOLU√á√ÉO 3 - Postergar execu√ß√£o na programa√ß√£o</p>

<div class='codeblock'>
<p>seosoquenaoS3.htm</p>
<code class='html'
>&lt;!DOCTYPE html&gt;
&lt;html
	xmlns='http://www.w3.org/1999/xhtml'
	lang='pt-BR'
	xml:lang='pt-br'
	&gt;
<strong>&lt;head&gt;</strong>
	&lt;title&gt;Google est√° olhando&lt;/title&gt;
	&lt;meta charset='utf-8' /&gt;
	&lt;script src='//code.jquery.com/jquery-1.10.2.min.js'&gt;&lt;/script&gt;
	<strong>&lt;script src='seosoquenaoS3.js'&gt;&lt;/script&gt;</strong>
<strong>&lt;/head&gt;</strong>
&lt;body&gt;
	<strong>&lt;h1 id='tagTitulo'&gt;</strong>Acessibilidade e SEO&lt;/h1&gt;
	<strong>&lt;p id='tagParagrafo'&gt;</strong>
		Sim pequeno gafanhoto, html tem mais de 100 tags
		diferentes al√©m de table e div.
	&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;</code
>
</div>

<div class='codeblock'>
<p>seosoquenaoS3b.js</p>
<code class='javascript'
>'use strict';

<strong>function init() {</strong>

	// pega elementos da p√°gina pela id e os torna manipul√°veis dentro do JavaScript
	var titulo = document<strong>.getElementById('tagTitulo');</strong>
	var paragrafo = document<strong>.getElementById('tagParagrafo');</strong>

	titulo.innerHTML = 'Black hat SEO';
	paragrafo.attributes.add('style', 'display: none');

<strong>}</strong>

<strong>// Espera o documento estar pronto para buscar na p√°gina</strong>
<strong class='small'>jQuery(document).ready(</strong>function(evento) {
	<strong>init();</strong>
}<strong>);</strong></code
>
</div>

<p>Como citei l√° no comecinho, jQuery ganhou fama justamente por esconder as v√°rias incompatibilidades entre os navegadores atrav√©s de sua API. Este exemplo faz a mesma coisa que o exemplo anterior, por√©m depende de uma biblioteca externa. Se isso n√£o for um problema pra vc, vai em frente. A sintaxe do jQuery √© um pouco diferente do JavaScript convencional, e ser√° abordada mais pra frente.</p>

<div class='codeblock'>
<p>seosoquenaoS3.js</p>
<code class='javascript'
>'use strict';

function init() {

	// pega elementos da p√°gina pela id e os torna manipul√°veis dentro do JavaScript
	var titulo = document.getElementById('tagTitulo');
	var paragrafo = document.getElementById('tagParagrafo');

	titulo.innerHTML = 'Black hat SEO';
	paragrafo.attributes.add('style', 'display: none');

}

// verifica se o JavaScript rodou ap√≥s o evento de carregamento completado da p√°gina
if (document.readyState === 'interactive'
	|| document.readyState === 'complete'
	|| document.readyState === 'loaded'
	) {

	init();

// se n√£o, se registra para executar no evento
} else {

	// registro do evento para navegadores legais
	if (document.addEventListener) {
		document.addEventListener('DOMContentLoaded', init);

	// registro de evento para IE8-
	} else if (window.attachEvent) {
		window.attachEvent('onload', init);
	}

}</code
>
</div>

<p>Esta solu√ß√£o √© a mais compat√≠vel. Por√©m, precisamos adicionar uma verifica√ß√£o meio grande pra tudo funcionar de acordo com o que esperamos. Note que, dependendo do momento em que o JavaScript passa a existir na p√°gina, o evento indicando que o processamento do html terminou pode j√° ter sido disparado. Existe tamb√©m a quest√£o de compatibilidade com IEs antigos. Claro que podemos refatorar esse c√≥digo e facilitar o uso deste evento. Mas aqui no ICI fazemos outra coisa. Usamos jQuery.</p>

<p>Ou usando closures.</p>

<div class='codeblock'>
<p>dropdown.js</p>
<code class='javascript'
>'use strict';

let dropdown = (function() {

	let publico = {

		init: function(idConteiner) {
			privado.idConteiner = idConteiner;
			privado.conteiner = document.getElementById(privado.idConteiner);
			privado.rotulo = privado.conteiner.querySelector('button');
			privado.lista = privado.conteiner.querySelector('ul');
			privado.rotulo.addEventListener('click', this.clickHandler.bind(this));
		},

		clickHandler: function(evento) {
			privado.visivel = !privado.visivel;
			privado.atualizar();
		}

	};

	let privado = {

		atualizar: function() {
			if (this.visible) {
				this.lista.style.display = 'block';
				return;
			}
			this.lista.style.display = 'none';
		},

		idConteiner: null,

		conteiner: null

		rotulo: null,

		lista: null,

		visivel: false

	};

	return publico;

})();</code
>
</div>

</section>


</body>
</html>